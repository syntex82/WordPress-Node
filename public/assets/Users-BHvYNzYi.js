import{r as n,j as e}from"./vendor-react-D2QycniR.js";import{x as J,ag as X,aa as B,r as g,z as o,ah as K,T as p,c as Q,j as V,ai as D,G as W,I as Z,v as ee}from"./index-4Xu9g3kZ.js";import{L as te}from"./LoadingSpinner-BUnjBwPP.js";import{C as se}from"./ConfirmDialog-B0Mg5QTV.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";const j=[{value:"SUPER_ADMIN",label:"Super Admin",description:"Full system access including security and all data"},{value:"ADMIN",label:"Admin",description:"Site administrator with full access within scope"},{value:"INSTRUCTOR",label:"Instructor",description:"Can manage own courses and students"},{value:"STUDENT",label:"Student",description:"Default signup - messages, groups, media, LMS view"}],x={addNew:{title:"Add New User",content:"Create a new user account. Assign a role to control what they can access."},edit:{title:"Edit User",content:"Modify user details like name, email, or role."},delete:{title:"Delete User",content:"Permanently remove this user account. This action cannot be undone."}},ae=["SUPER_ADMIN","ADMIN","INSTRUCTOR","STUDENT"];function N(s){const l=ae.indexOf(s);return l===-1?999:l}function ue(){var k;const s=J(),{isDemo:l,setRestrictedAction:I}=X(),{user:w}=B(),[P,O]=n.useState([]),[F,z]=n.useState(!0),[L,M]=n.useState(!1),[d,y]=n.useState(null),[a,c]=n.useState({name:"",email:"",password:"",role:"STUDENT"}),[v,S]=n.useState({isOpen:!1,userId:null}),[u,T]=n.useState(1),[h,_]=n.useState(1),[C,H]=n.useState(0),U=20,i=(w==null?void 0:w.role)||"STUDENT",q=N(i),A=i==="SUPER_ADMIN"?j:j.filter(t=>N(t.value)>=q),E=t=>i==="SUPER_ADMIN"?!0:N(i)<=N(t);n.useEffect(()=>{$()},[u]);const $=async()=>{var t,m;try{const r=await g.getAll({page:u,limit:U});O(r.data.users||[]),r.data.meta&&(_(r.data.meta.totalPages||1),H(r.data.meta.total||0))}catch(r){o.error(((m=(t=r.response)==null?void 0:t.data)==null?void 0:m.message)||"Failed to load users"),console.error("Users error:",r)}finally{z(!1)}},R=t=>{if(l){I("User management is not available in demo mode. Upgrade to manage users.");return}if(t){if(!E(t.role)){o.error(`You cannot edit users with a higher role (${t.role}) than your own (${i})`);return}y(t),c({name:t.name,email:t.email,password:"",role:t.role})}else y(null),c({name:"",email:"",password:"",role:"STUDENT"});M(!0)},b=()=>{M(!1),y(null),c({name:"",email:"",password:"",role:"STUDENT"})},Y=async t=>{var m,r;if(t.preventDefault(),!a.name||!a.email){o.error("Name and email are required");return}if(!d&&!a.password){o.error("Password is required for new users");return}try{if(d){const f={name:a.name,email:a.email,role:a.role};a.password&&(f.password=a.password),await g.update(d.id,f),o.success("User updated successfully")}else await g.create(a),o.success("User created successfully");b(),$()}catch(f){o.error(((r=(m=f.response)==null?void 0:m.data)==null?void 0:r.message)||"Failed to save user")}},G=async t=>{try{await g.delete(t),o.success("User deleted successfully"),$(),S({isOpen:!1,userId:null})}catch{o.error("Failed to delete user")}};return F?e.jsx(te,{}):e.jsxs("div",{children:[l&&e.jsxs("div",{className:`mb-6 p-4 rounded-xl border flex items-center gap-3 ${s.isDark?"bg-amber-500/10 border-amber-500/30 text-amber-400":"bg-amber-50 border-amber-200 text-amber-700"}`,children:[e.jsx(K,{size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"User Management Restricted in Demo Mode"}),e.jsx("p",{className:"text-sm opacity-80",children:"You can view users but cannot create, edit, or delete them. Upgrade to a full license to manage users."})]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:`text-3xl font-bold ${s.titleGradient}`,children:"Users"}),e.jsx(p,{title:"About Users",content:"Manage user accounts and permissions. Assign roles to control what each user can access and modify.",position:"right",variant:"help",children:e.jsx("button",{className:`p-1 ${s.icon} hover:text-blue-400`,children:e.jsx(Q,{size:18})})})]}),e.jsx(p,{title:x.addNew.title,content:x.addNew.content,position:"left",children:e.jsxs("button",{onClick:()=>R(),disabled:l,className:`flex items-center px-4 py-2 rounded-xl shadow-lg transition-all ${l?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-purple-500 text-white hover:from-purple-500 hover:to-purple-400 shadow-purple-500/20"}`,children:[e.jsx(V,{className:"mr-2",size:18}),"Add New User"]})})]}),i!=="SUPER_ADMIN"&&!l&&e.jsxs("div",{className:`mb-4 p-3 rounded-lg flex items-center gap-2 text-sm ${s.isDark?"bg-blue-500/10 border border-blue-500/20 text-blue-400":"bg-blue-50 border border-blue-100 text-blue-600"}`,children:[e.jsx(D,{size:16}),e.jsxs("span",{children:["As an ",i,", you can only view and manage users with roles at or below your level. Super Admin accounts are hidden."]})]}),e.jsx("div",{className:`backdrop-blur rounded-xl border overflow-hidden ${s.card}`,children:e.jsxs("table",{className:`min-w-full divide-y ${s.border}`,children:[e.jsx("thead",{className:s.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase ${s.textMuted}`,children:"Name"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase ${s.textMuted}`,children:"Email"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase ${s.textMuted}`,children:"Role"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase ${s.textMuted}`,children:"Joined"}),e.jsx("th",{className:`px-6 py-3 text-right text-xs font-medium uppercase ${s.textMuted}`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${s.border}`,children:P.map(t=>e.jsxs("tr",{className:s.tableRow,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm font-medium ${s.textPrimary}`,children:t.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm ${s.textMuted}`,children:t.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${t.role==="ADMIN"?s.isDark?"bg-purple-500/20 text-purple-400":"bg-purple-100 text-purple-700":t.role==="EDITOR"?s.badgeInfo:t.role==="AUTHOR"?s.badgeSuccess:s.badgeDefault}`,children:t.role})}),e.jsx("td",{className:`px-6 py-4 whitespace-nowrap text-sm ${s.textMuted}`,children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:!l&&E(t.role)?e.jsxs(e.Fragment,{children:[e.jsx(p,{title:x.edit.title,content:x.edit.content,position:"top",children:e.jsx("button",{onClick:()=>R(t),className:"text-blue-400 hover:text-blue-300 mr-3 transition-colors",children:e.jsx(W,{size:18})})}),e.jsx(p,{title:x.delete.title,content:x.delete.content,position:"top",variant:"warning",children:e.jsx("button",{onClick:()=>S({isOpen:!0,userId:t.id}),className:"text-red-400 hover:text-red-300 transition-colors",children:e.jsx(Z,{size:18})})})]}):e.jsx(p,{title:l?"Demo Mode":"Insufficient Permissions",content:l?"User management is restricted in demo mode":`You cannot edit users with role ${t.role}`,position:"top",children:e.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:e.jsx(D,{size:18})})})})]},t.id))})]})}),h>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 px-2",children:[e.jsxs("p",{className:`text-sm ${s.textMuted}`,children:["Showing ",(u-1)*U+1," to ",Math.min(u*U,C)," of ",C," users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(t=>Math.max(1,t-1)),disabled:u===1,className:`px-3 py-1.5 text-sm rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${s.buttonSecondary}`,children:"Previous"}),e.jsxs("span",{className:`px-3 py-1.5 text-sm ${s.textMuted}`,children:["Page ",u," of ",h]}),e.jsx("button",{onClick:()=>T(t=>Math.min(h,t+1)),disabled:u===h,className:`px-3 py-1.5 text-sm rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors ${s.buttonSecondary}`,children:"Next"})]})]}),L&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4",children:[e.jsx("div",{className:`fixed inset-0 backdrop-blur-sm ${s.isDark?"bg-black/70":"bg-black/50"}`,onClick:b}),e.jsxs("div",{className:`relative rounded-2xl max-w-md w-full p-6 shadow-2xl ${s.modal}`,children:[e.jsx("button",{onClick:b,className:`absolute top-4 right-4 transition-colors ${s.icon} ${s.iconHover}`,children:e.jsx(ee,{size:24})}),e.jsx("h2",{className:`text-2xl font-bold mb-6 ${s.textPrimary}`,children:d?"Edit User":"Create New User"}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${s.textMuted}`,children:"Name *"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>c({...a,name:t.target.value}),className:`w-full px-4 py-2.5 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 ${s.input}`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${s.textMuted}`,children:"Email *"}),e.jsx("input",{type:"email",value:a.email,onChange:t=>c({...a,email:t.target.value}),className:`w-full px-4 py-2.5 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 ${s.input}`,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium mb-2 ${s.textMuted}`,children:["Password ",d?"(leave blank to keep current)":"*"]}),e.jsx("input",{type:"password",value:a.password,onChange:t=>c({...a,password:t.target.value}),className:`w-full px-4 py-2.5 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 ${s.input}`,required:!d})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${s.textMuted}`,children:"Role *"}),e.jsx("select",{value:a.role,onChange:t=>c({...a,role:t.target.value}),className:`w-full px-4 py-2.5 rounded-lg focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 ${s.select}`,children:A.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("p",{className:`text-xs mt-1 ${s.textMuted}`,children:(k=j.find(t=>t.value===a.role))==null?void 0:k.description}),A.length<j.length&&e.jsxs("p",{className:`text-xs mt-1 flex items-center gap-1 ${s.textMuted}`,children:[e.jsx(D,{size:12}),"You can only assign roles at or below your level (",i,")"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:`flex-1 px-4 py-2.5 rounded-lg transition-all ${s.buttonSecondary}`,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-lg hover:from-blue-500 hover:to-blue-400 transition-all",children:d?"Update":"Create"})]})]})]})]})}),e.jsx(se,{isOpen:v.isOpen,title:"Delete User",message:"Are you sure you want to delete this user? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"danger",onConfirm:()=>v.userId&&G(v.userId),onCancel:()=>S({isOpen:!1,userId:null})})]})}export{ue as default};
