import{r as t,j as e,L as K,a as ve,d as Ne}from"./vendor-react-D2QycniR.js";import{u as te,aa as le,J as ae,C as he,a3 as ke,a4 as Ce,E as Se,I as xe,b5 as $e,K as ge,L as re,D as Fe,cg as E,z as p,v as fe,as as oe,at as Te,Y as Pe,aV as Ee,V as Me,aX as Ie,cl as Re,m as Le,ay as be,y as ye,bc as ce,b as de,cq as De,ao as me,az as ze,d as Ae,aH as ue}from"./index-DXwKa3Mi.js";import{C as Ve,P as Ue}from"./PostCard-BmLXBu5p.js";import{C as Ye}from"./CommentModal-vpSUZ_mT.js";import{E as Oe}from"./EditPostModal-BNFs2ihR.js";import{f as je}from"./vendor-utils-BWf5C302.js";import{l as He}from"./vendor-socket-CA1CrNgP.js";import"./vendor-editor-Cn7QR8gj.js";import"./MobileMediaRecorder-AX3OK7ei.js";function Be({post:i,onDelete:f,onCommentClick:r,onHashtagClick:d,onPostShared:b,isInView:o=!1}){var a,n,u;const{resolvedTheme:x}=te(),h=x==="dark",{user:w}=le(),[k,T]=t.useState(i.isLiked),[v,P]=t.useState(i.likesCount),[M,y]=t.useState(i.sharesCount),[j,A]=t.useState(!1),[S,V]=t.useState(!1),[U,I]=t.useState(!1),[R,m]=t.useState(!1);t.useEffect(()=>{T(i.isLiked),P(i.likesCount),y(i.sharesCount)},[i.id,i.isLiked,i.likesCount,i.sharesCount]);const[N,O]=t.useState(!1),[L,G]=t.useState(!0),[D,B]=t.useState(!0),$=t.useRef(null),H=t.useRef(),z=(w==null?void 0:w.id)===i.user.id,g=(a=i.media)==null?void 0:a.some(c=>c.type==="VIDEO"),W=(n=i.media)==null?void 0:n.some(c=>c.type==="IMAGE"),l=(u=i.media)==null?void 0:u[0],F=(l==null?void 0:l.type)==="VIDEO"&&l.height&&l.width&&l.height>l.width;t.useEffect(()=>{g&&$.current&&(o||($.current.pause(),O(!1)))},[o,g]),t.useEffect(()=>(D&&(H.current=setTimeout(()=>B(!1),3e3)),()=>{H.current&&clearTimeout(H.current)}),[D]);const C=async()=>{if(!U){I(!0);try{k?(await E.unlikePost(i.id),T(!1),P(c=>Math.max(0,c-1))):(await E.likePost(i.id),T(!0),P(c=>c+1),m(!0),setTimeout(()=>m(!1),1e3))}catch{p.error("Failed to update like")}finally{I(!1)}}},X=t.useCallback(()=>{k?(m(!0),setTimeout(()=>m(!1),1e3)):C()},[k]),Z=async()=>{if(confirm("Are you sure you want to delete this post?"))try{await E.deletePost(i.id),p.success("Post deleted"),f==null||f(i.id)}catch{p.error("Failed to delete post")}},q=()=>{$.current&&(N?($.current.pause(),O(!1)):($.current.play(),O(!0))),B(!0)},Q=c=>{c.stopPropagation(),$.current&&($.current.muted=!L,G(!L))},_=t.useCallback(c=>c?c.split(/(#\w+|@\w+)/g).map((Y,J)=>{var ne;if(Y.startsWith("#"))return e.jsx("button",{onClick:()=>d==null?void 0:d(Y.slice(1)),className:"text-blue-400 hover:underline font-medium",children:Y},J);if(Y.startsWith("@")){const pe=Y.slice(1),se=(ne=i.mentions)==null?void 0:ne.find(we=>{var ie;return((ie=we.username)==null?void 0:ie.toLowerCase())===pe.toLowerCase()});return se?e.jsx(K,{to:`/profile/${se.username||se.id}`,className:"text-blue-400 hover:underline font-medium",children:Y},J):e.jsx("span",{className:"text-blue-400",children:Y},J)}return e.jsx(t.Fragment,{children:Y},J)}):null,[i.mentions,d]),s=c=>c>=1e6?`${(c/1e6).toFixed(1)}M`:c>=1e3?`${(c/1e3).toFixed(1)}K`:c.toString();return e.jsxs("div",{className:`relative w-full ${F?"h-screen":"min-h-[70vh]"} snap-start snap-always
      ${h?"bg-black":"bg-gray-100"}`,children:[e.jsxs("div",{className:"absolute inset-0",onClick:g?q:X,onDoubleClick:X,children:[g&&l?e.jsx("video",{ref:$,src:l.url,loop:!0,muted:L,playsInline:!0,className:"w-full h-full object-cover",poster:l.thumbnail}):W&&l?e.jsx("img",{src:l.url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:`w-full h-full flex items-center justify-center p-8
            ${h?"bg-gradient-to-br from-gray-900 to-gray-800":"bg-gradient-to-br from-gray-100 to-gray-200"}`,children:e.jsx("p",{className:`text-2xl font-medium text-center leading-relaxed
              ${h?"text-white":"text-gray-800"}`,children:_(i.content)})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-black/30 pointer-events-none"}),R&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx(ae,{className:"w-32 h-32 text-red-500 fill-red-500 animate-ping"})}),g&&D&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:!N&&e.jsx(he,{className:"w-20 h-20 text-white/80"})})]}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:[e.jsxs(K,{to:`/profile/${i.user.username||i.user.id}`,className:"flex items-center gap-3",children:[e.jsx("img",{src:i.user.avatar||"/default-avatar.png",alt:i.user.name,className:"w-12 h-12 rounded-full border-2 border-white/50 object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold text-lg drop-shadow-lg",children:i.user.name}),e.jsxs("p",{className:"text-white/70 text-sm drop-shadow",children:["@",i.user.username," Â· ",je(new Date(i.createdAt),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsx("button",{onClick:Q,className:"p-3 rounded-full bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 transition-colors",children:L?e.jsx(ke,{className:"w-5 h-5"}):e.jsx(Ce,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>V(!S),className:"p-3 rounded-full bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 transition-colors",children:e.jsx(Se,{className:"w-5 h-5"})}),S&&e.jsxs("div",{className:`absolute right-0 top-full mt-2 w-48 rounded-xl shadow-2xl overflow-hidden z-50
                ${h?"bg-gray-800":"bg-white"}`,children:[z&&e.jsxs("button",{onClick:Z,className:"w-full px-4 py-3 flex items-center gap-3 text-red-500 hover:bg-red-500/10",children:[e.jsx(xe,{className:"w-5 h-5"})," Delete Post"]}),e.jsxs("button",{onClick:()=>{V(!1)},className:`w-full px-4 py-3 flex items-center gap-3 ${h?"hover:bg-gray-700":"hover:bg-gray-100"}`,children:[e.jsx($e,{className:"w-5 h-5"})," View Full Screen"]})]})]})]})]}),(g||W)&&i.content&&e.jsxs("div",{className:"absolute bottom-24 left-0 right-20 p-4 z-10",children:[e.jsx("p",{className:"text-white text-lg leading-relaxed drop-shadow-lg line-clamp-3",children:_(i.content)}),i.hashtags&&i.hashtags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.hashtags.map(c=>e.jsxs("button",{onClick:()=>d==null?void 0:d(c.tag),className:"text-blue-400 font-medium hover:underline",children:["#",c.tag]},c.id))})]}),e.jsxs("div",{className:"absolute right-4 bottom-24 flex flex-col items-center gap-6 z-10",children:[e.jsxs("button",{onClick:C,disabled:U,className:"flex flex-col items-center gap-1 group",children:[e.jsx("div",{className:`p-3 rounded-full transition-all duration-300
            ${k?"bg-red-500 scale-110":"bg-black/30 backdrop-blur-sm hover:bg-black/50"}`,children:e.jsx(ae,{className:`w-7 h-7 transition-all ${k?"text-white fill-white":"text-white"}`})}),e.jsx("span",{className:"text-white text-sm font-semibold drop-shadow",children:s(v)})]}),e.jsxs("button",{onClick:()=>r==null?void 0:r(i.id,i),className:"flex flex-col items-center gap-1 group",children:[e.jsx("div",{className:"p-3 rounded-full bg-black/30 backdrop-blur-sm hover:bg-black/50 transition-colors",children:e.jsx(ge,{className:"w-7 h-7 text-white"})}),e.jsx("span",{className:"text-white text-sm font-semibold drop-shadow",children:s(i.commentsCount)})]}),e.jsxs("button",{onClick:()=>b==null?void 0:b(i),className:"flex flex-col items-center gap-1 group",children:[e.jsx("div",{className:"p-3 rounded-full bg-black/30 backdrop-blur-sm hover:bg-black/50 transition-colors",children:e.jsx(re,{className:"w-7 h-7 text-white"})}),e.jsx("span",{className:"text-white text-sm font-semibold drop-shadow",children:s(M)})]}),e.jsx("button",{onClick:()=>A(!j),className:"flex flex-col items-center gap-1 group",children:e.jsx("div",{className:`p-3 rounded-full transition-all duration-300
            ${j?"bg-yellow-500 scale-110":"bg-black/30 backdrop-blur-sm hover:bg-black/50"}`,children:e.jsx(Fe,{className:`w-7 h-7 transition-all ${j?"text-white fill-white":"text-white"}`})})}),e.jsxs(K,{to:`/profile/${i.user.username||i.user.id}`,className:"relative mt-2",children:[e.jsx("img",{src:i.user.avatar||"/default-avatar.png",alt:i.user.name,className:"w-12 h-12 rounded-full border-2 border-white object-cover"}),e.jsx("div",{className:`absolute -bottom-1 left-1/2 -translate-x-1/2 w-5 h-5 bg-red-500 rounded-full
            flex items-center justify-center text-white text-xs font-bold`,children:"+"})]})]}),S&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>V(!1)})]})}const We=["â¤ï¸","ðŸ”¥","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™"];function Ge({isOpen:i,onClose:f,post:r,onCommentAdded:d}){const{resolvedTheme:b}=te(),o=b==="dark",{user:x}=le(),[h,w]=t.useState([]),[k,T]=t.useState(!1),[v,P]=t.useState(""),[M,y]=t.useState(!1),[j,A]=t.useState(!1),[S,V]=t.useState(new Set),[U,I]=t.useState(0),[R,m]=t.useState(!1),N=t.useRef(null),O=t.useRef(null),L=t.useRef(0);t.useEffect(()=>{i&&r&&G()},[i,r==null?void 0:r.id]),t.useEffect(()=>{i&&setTimeout(()=>{var l;return(l=N.current)==null?void 0:l.focus()},300)},[i]);const G=async()=>{if(r){T(!0);try{const l=await E.getComments(r.id);w(l.data.data)}catch{p.error("Failed to load comments")}finally{T(!1)}}},D=async l=>{if(l.preventDefault(),!(!v.trim()||!r||M)){y(!0);try{const F=await E.addComment(r.id,v.trim());w(C=>[F.data,...C]),P(""),d==null||d(),p.success("Comment added!")}catch{p.error("Failed to add comment")}finally{y(!1)}}},B=async l=>{if(r){y(!0);try{const F=await E.addComment(r.id,l);w(C=>[F.data,...C]),d==null||d(),A(!1)}catch{p.error("Failed to add reaction")}finally{y(!1)}}},$=l=>{V(F=>{const C=new Set(F);return C.has(l)?C.delete(l):C.add(l),C})},H=async l=>{try{await E.deleteComment(r.id,l),w(F=>F.filter(C=>C.id!==l)),p.success("Comment deleted")}catch{p.error("Failed to delete comment")}},z=l=>{L.current=l.touches[0].clientY,m(!0)},g=l=>{if(!R)return;const F=l.touches[0].clientY-L.current;F>0&&I(F)},W=()=>{m(!1),U>150&&f(),I(0)};return i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 transition-opacity duration-300",onClick:f}),e.jsxs("div",{ref:O,className:`fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl shadow-2xl transition-transform duration-300 ease-out
          ${o?"bg-gray-900":"bg-white"}`,style:{maxHeight:"75vh",transform:`translateY(${U}px)`,transition:R?"none":"transform 0.3s ease-out"},onTouchStart:z,onTouchMove:g,onTouchEnd:W,children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2 cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:`w-12 h-1.5 rounded-full ${o?"bg-gray-600":"bg-gray-300"}`})}),e.jsxs("div",{className:`flex items-center justify-between px-4 pb-3 border-b ${o?"border-gray-700":"border-gray-200"}`,children:[e.jsxs("h3",{className:`text-lg font-bold ${o?"text-white":"text-gray-900"}`,children:[(r==null?void 0:r.commentsCount)||0," Comments"]}),e.jsx("button",{onClick:f,className:`p-2 rounded-full transition-colors ${o?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(fe,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(75vh - 180px)"},children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin"})}):h.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:[e.jsx(oe,{className:`w-16 h-16 mb-4 ${o?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:`text-lg font-medium ${o?"text-gray-400":"text-gray-500"}`,children:"No comments yet"}),e.jsx("p",{className:`text-sm ${o?"text-gray-500":"text-gray-400"}`,children:"Be the first to comment!"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.map(l=>e.jsx("div",{className:`p-4 ${o?"hover:bg-gray-800/50":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(K,{to:`/profile/${l.user.username||l.user.id}`,children:e.jsx("img",{src:l.user.avatar||"/default-avatar.png",alt:l.user.name,className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{to:`/profile/${l.user.username||l.user.id}`,className:`font-semibold text-sm ${o?"text-white":"text-gray-900"}`,children:l.user.name}),e.jsx("span",{className:`text-xs ${o?"text-gray-500":"text-gray-400"}`,children:je(new Date(l.createdAt),{addSuffix:!0})})]}),e.jsx("p",{className:`mt-1 text-sm ${o?"text-gray-300":"text-gray-700"}`,children:l.content}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("button",{onClick:()=>$(l.id),className:`flex items-center gap-1 text-xs transition-colors
                            ${S.has(l.id)?"text-red-500":o?"text-gray-500 hover:text-red-400":"text-gray-400 hover:text-red-500"}`,children:[e.jsx(ae,{className:`w-4 h-4 ${S.has(l.id)?"fill-current":""}`}),e.jsx("span",{children:(l.likesCount||0)+(S.has(l.id)?1:0)})]}),e.jsx("button",{className:`text-xs ${o?"text-gray-500 hover:text-gray-400":"text-gray-400 hover:text-gray-600"}`,children:"Reply"}),(x==null?void 0:x.id)===l.user.id&&e.jsx("button",{onClick:()=>H(l.id),className:"text-xs text-red-500 hover:text-red-600",children:e.jsx(xe,{className:"w-4 h-4"})})]})]})]})},l.id))})}),j&&e.jsx("div",{className:`px-4 py-3 border-t ${o?"border-gray-700 bg-gray-800":"border-gray-200 bg-gray-50"}`,children:e.jsx("div",{className:"flex justify-around",children:We.map(l=>e.jsx("button",{onClick:()=>B(l),className:"text-3xl hover:scale-125 transition-transform active:scale-95",children:l},l))})}),e.jsx("div",{className:`p-4 border-t ${o?"border-gray-700":"border-gray-200"}`,children:e.jsxs("form",{onSubmit:D,className:"flex items-center gap-3",children:[e.jsx("img",{src:(x==null?void 0:x.avatar)||"/default-avatar.png",alt:"You",className:"w-10 h-10 rounded-full object-cover flex-shrink-0"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:N,type:"text",value:v,onChange:l=>P(l.target.value),placeholder:"Add a comment...",className:`w-full px-4 py-3 pr-20 rounded-full text-sm transition-colors
                  ${o?"bg-gray-800 text-white placeholder-gray-500 focus:bg-gray-700":"bg-gray-100 text-gray-900 placeholder-gray-500 focus:bg-gray-200"}
                  focus:outline-none focus:ring-2 focus:ring-blue-500/50`}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>A(!j),className:`p-2 rounded-full transition-colors ${o?"hover:bg-gray-700":"hover:bg-gray-200"}`,children:e.jsx(oe,{className:`w-5 h-5 ${o?"text-gray-400":"text-gray-500"}`})}),e.jsx("button",{type:"submit",disabled:!v.trim()||M,className:`p-2 rounded-full transition-all
                    ${v.trim()?"bg-blue-500 text-white hover:bg-blue-600":o?"text-gray-600":"text-gray-400"}`,children:e.jsx(Te,{className:"w-5 h-5"})})]})]})]})})]})]}):null}function Ke({isOpen:i,onClose:f,post:r,onShared:d}){var R;const{resolvedTheme:b}=te(),o=b==="dark",[x,h]=t.useState(!1),[w,k]=t.useState(!1),[T,v]=t.useState(""),[P,M]=t.useState(!1);if(!i)return null;const y=`${window.location.origin}/post/${r.id}`,j=((R=r.content)==null?void 0:R.slice(0,100))||"Check out this post!",A=async()=>{try{await navigator.clipboard.writeText(y),h(!0),p.success("Link copied!"),setTimeout(()=>h(!1),2e3)}catch{p.error("Failed to copy link")}},S=async m=>{k(!0);try{await E.sharePost(r.id),d==null||d();let N="";switch(m){case"twitter":N=`https://twitter.com/intent/tweet?text=${encodeURIComponent(j)}&url=${encodeURIComponent(y)}`;break;case"whatsapp":N=`https://wa.me/?text=${encodeURIComponent(`${j} ${y}`)}`;break;case"email":N=`mailto:?subject=${encodeURIComponent("Check out this post")}&body=${encodeURIComponent(`${j}

${y}`)}`;break}N&&window.open(N,"_blank","noopener,noreferrer"),f()}catch{p.error("Failed to share post")}finally{k(!1)}},V=async()=>{if(navigator.share)try{await navigator.share({title:"Check out this post",text:j,url:y}),await E.sharePost(r.id),d==null||d(),f()}catch(m){m.name!=="AbortError"&&p.error("Failed to share")}},U=async()=>{k(!0);try{await E.sharePost(r.id,T.trim()||void 0),d==null||d(),p.success("Shared to your timeline!"),v(""),M(!1),f()}catch{p.error("Failed to share post")}finally{k(!1)}},I=[{id:"timeline",icon:re,label:"Timeline",onClick:()=>M(!0),color:"bg-gradient-to-r from-green-500 to-emerald-600"},{id:"copy",icon:x?Me:Ie,label:x?"Copied!":"Copy Link",onClick:A,color:"bg-gray-500"},{id:"twitter",icon:Re,label:"Twitter",onClick:()=>S("twitter"),color:"bg-blue-400"},{id:"whatsapp",icon:ge,label:"WhatsApp",onClick:()=>S("whatsapp"),color:"bg-green-500"},{id:"email",icon:Le,label:"Email",onClick:()=>S("email"),color:"bg-red-500"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50",onClick:f}),e.jsxs("div",{className:`fixed bottom-0 left-0 right-0 z-50 rounded-t-3xl shadow-2xl p-6 pb-8 max-h-[90vh] overflow-y-auto
        ${o?"bg-gray-900":"bg-white"}`,children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:`w-12 h-1.5 rounded-full ${o?"bg-gray-600":"bg-gray-300"}`})}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:`text-xl font-bold ${o?"text-white":"text-gray-900"}`,children:P?"Share to Timeline":"Share Post"}),e.jsx("button",{onClick:()=>P?M(!1):f(),className:`p-2 rounded-full transition-colors ${o?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(fe,{className:"w-6 h-6"})})]}),P?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`p-4 rounded-xl mb-4 ${o?"bg-gray-800":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.user.avatar?e.jsx("img",{src:r.user.avatar,alt:"",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold",children:r.user.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("span",{className:`font-medium block ${o?"text-white":"text-gray-900"}`,children:r.user.name}),r.user.headline&&e.jsx("span",{className:`text-xs ${o?"text-gray-400":"text-gray-500"}`,children:r.user.headline})]})]}),r.content&&e.jsx("p",{className:`text-sm mb-3 ${o?"text-gray-300":"text-gray-700"}`,children:r.content.length>150?`${r.content.slice(0,150)}...`:r.content}),r.media&&r.media.length>0&&e.jsx("div",{className:"flex gap-2",children:r.media.slice(0,3).map((m,N)=>e.jsxs("div",{className:"relative w-14 h-14 rounded-lg overflow-hidden bg-gray-700",children:[m.type==="VIDEO"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m.thumbnail||m.url,alt:"",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40",children:e.jsx(Pe,{className:"w-4 h-4 text-white"})})]}):e.jsx("img",{src:m.url,alt:"",className:"w-full h-full object-cover"}),N===2&&r.media.length>3&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 text-white text-xs font-medium",children:["+",r.media.length-3]})]},m.id))})]}),e.jsx("textarea",{value:T,onChange:m=>v(m.target.value),placeholder:"Add a comment to share with your followers...",className:`w-full p-3 border rounded-xl resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent mb-4 ${o?"border-gray-700 bg-gray-800 text-white placeholder-gray-400":"border-gray-300 bg-white text-gray-900 placeholder-gray-400"}`,rows:3}),e.jsxs("button",{onClick:U,disabled:w,className:"w-full py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-medium flex items-center justify-center gap-2 hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 transition-all",children:[e.jsx(re,{className:"w-5 h-5"}),w?"Sharing...":"Share to Timeline"]})]}):e.jsxs(e.Fragment,{children:[navigator.share&&e.jsxs("button",{onClick:V,disabled:w,className:`w-full mb-6 py-4 rounded-xl font-medium flex items-center justify-center gap-3 transition-colors
                  ${o?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:[e.jsx(Ee,{className:"w-5 h-5"}),"Share via..."]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:I.map(m=>e.jsxs("button",{onClick:m.onClick,disabled:w,className:"flex flex-col items-center gap-2 group",children:[e.jsx("div",{className:`w-12 h-12 rounded-full ${m.color} flex items-center justify-center
                    group-hover:scale-110 transition-transform`,children:e.jsx(m.icon,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:`text-xs font-medium ${o?"text-gray-400":"text-gray-600"}`,children:m.label})]},m.id))}),e.jsxs("div",{className:`mt-6 p-4 rounded-xl ${o?"bg-gray-800":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.user.avatar?e.jsx("img",{src:r.user.avatar,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-sm font-bold",children:r.user.name.charAt(0)}),e.jsx("span",{className:`text-sm font-medium ${o?"text-white":"text-gray-900"}`,children:r.user.name})]}),e.jsx("p",{className:`text-sm line-clamp-2 ${o?"text-gray-300":"text-gray-700"}`,children:r.content||"No content"}),r.media&&r.media.length>0&&e.jsxs("div",{className:"flex gap-1 mt-2",children:[r.media.slice(0,4).map(m=>e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-gray-700",children:e.jsx("img",{src:m.type==="VIDEO"&&m.thumbnail||m.url,alt:"",className:"w-full h-full object-cover"})},m.id)),r.media.length>4&&e.jsxs("span",{className:`text-xs self-center ml-1 ${o?"text-gray-400":"text-gray-500"}`,children:["+",r.media.length-4]})]})]})]})]})]})}function Xe({initialPosts:i,onSwitchToGrid:f}){const{resolvedTheme:r}=te(),d=r==="dark",b=ve(),[o,x]=t.useState(i||[]),[h,w]=t.useState(!i),[k,T]=t.useState(!1),[v,P]=t.useState(!0),[M,y]=t.useState(1),[j,A]=t.useState(0),[S,V]=t.useState(new Set),[U,I]=t.useState(!1),[R,m]=t.useState(null),[N,O]=t.useState(!1),[L,G]=t.useState(null),[D,B]=t.useState(0),[$,H]=t.useState(!1),z=t.useRef(null),g=t.useRef(null),W=t.useRef(0),l=t.useCallback(async(a=!1)=>{if(a)T(!0),y(1);else if(!v||h)return;try{const n=a?1:M,u=await E.getDiscover(n,10);a?(x(u.data.data),y(2)):(x(c=>[...c,...u.data.data]),y(c=>c+1)),P(u.data.meta.hasMore)}catch{p.error("Failed to load posts")}finally{w(!1),T(!1)}},[M,v,h]);t.useEffect(()=>{i||l()},[]),t.useEffect(()=>(g.current=new IntersectionObserver(a=>{a.forEach(n=>{const u=n.target.getAttribute("data-post-id");u&&V(c=>{const ee=new Set(c);if(n.isIntersecting){ee.add(u);const Y=o.findIndex(J=>J.id===u);Y!==-1&&n.intersectionRatio>.5&&A(Y)}else ee.delete(u);return ee})})},{threshold:[0,.5,1]}),()=>{var a;return(a=g.current)==null?void 0:a.disconnect()}),[o]),t.useEffect(()=>{const a=z.current;if(!a||!g.current)return;const n=a.querySelectorAll("[data-post-id]");return n.forEach(u=>{var c;return(c=g.current)==null?void 0:c.observe(u)}),()=>{n.forEach(u=>{var c;return(c=g.current)==null?void 0:c.unobserve(u)})}},[o]),t.useEffect(()=>{j>=o.length-3&&v&&!h&&l()},[j,o.length,v,h,l]);const F=a=>{var n;((n=z.current)==null?void 0:n.scrollTop)===0&&(W.current=a.touches[0].clientY,H(!0))},C=a=>{var u;if(!$)return;const n=a.touches[0].clientY-W.current;n>0&&((u=z.current)==null?void 0:u.scrollTop)===0&&B(Math.min(n*.5,100))},X=()=>{D>60&&l(!0),B(0),H(!1)},Z=(a,n)=>{m(n),I(!0)},q=a=>{G(a),O(!0)},Q=a=>{b(`/timeline?hashtag=${a}`)},_=a=>{x(n=>n.filter(u=>u.id!==a))},s=()=>{var a;(a=z.current)==null||a.scrollTo({top:0,behavior:"smooth"})};return h&&o.length===0?e.jsx("div",{className:`h-screen flex items-center justify-center ${d?"bg-black":"bg-gray-100"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:`text-lg ${d?"text-gray-400":"text-gray-600"}`,children:"Loading feed..."})]})}):e.jsxs("div",{className:`relative h-screen ${d?"bg-black":"bg-gray-100"}`,children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 z-30 flex justify-center overflow-hidden",style:{height:D,transition:$?"none":"height 0.3s ease-out"},children:e.jsx("div",{className:`flex items-center justify-center ${D>60?"text-blue-500":d?"text-gray-400":"text-gray-500"}`,children:e.jsx(be,{className:`w-6 h-6 ${k?"animate-spin":""}`,style:{transform:`rotate(${D*3}deg)`}})})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 z-20 flex items-center justify-between",children:[e.jsx("div",{className:`px-4 py-2 rounded-full backdrop-blur-md ${d?"bg-black/50":"bg-white/50"}`,children:e.jsxs("span",{className:`text-sm font-medium ${d?"text-white":"text-gray-900"}`,children:[j+1," / ",o.length]})}),f&&e.jsx("button",{onClick:f,className:`p-3 rounded-full backdrop-blur-md transition-colors
              ${d?"bg-black/50 text-white hover:bg-black/70":"bg-white/50 text-gray-900 hover:bg-white/70"}`,children:e.jsx(ye,{className:"w-5 h-5"})})]}),e.jsxs("div",{ref:z,className:"h-full overflow-y-scroll snap-y snap-mandatory scrollbar-hide",onTouchStart:F,onTouchMove:C,onTouchEnd:X,style:{scrollSnapType:"y mandatory"},children:[o.map(a=>e.jsx("div",{"data-post-id":a.id,className:"snap-start snap-always",children:e.jsx(Be,{post:a,isInView:S.has(a.id),onDelete:_,onCommentClick:Z,onHashtagClick:Q,onPostShared:q})},a.id)),h&&o.length>0&&e.jsx("div",{className:`h-screen flex items-center justify-center snap-start ${d?"bg-black":"bg-gray-100"}`,children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"})}),!v&&o.length>0&&e.jsxs("div",{className:`h-screen flex flex-col items-center justify-center gap-4 snap-start ${d?"bg-black":"bg-gray-100"}`,children:[e.jsx("p",{className:`text-xl font-medium ${d?"text-gray-400":"text-gray-600"}`,children:"You're all caught up!"}),e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-6 py-3 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors",children:[e.jsx(ce,{className:"w-5 h-5"}),"Back to top"]})]})]}),j>2&&e.jsx("button",{onClick:s,className:`fixed bottom-24 right-4 z-20 p-4 rounded-full shadow-lg transition-all
            ${d?"bg-gray-800 text-white hover:bg-gray-700":"bg-white text-gray-900 hover:bg-gray-100"}`,children:e.jsx(ce,{className:"w-6 h-6"})}),e.jsx(Ge,{isOpen:U,onClose:()=>I(!1),post:R,onCommentAdded:()=>{R&&x(a=>a.map(n=>n.id===R.id?{...n,commentsCount:n.commentsCount+1}:n))}}),L&&e.jsx(Ke,{isOpen:N,onClose:()=>O(!1),post:L,onShared:()=>{x(a=>a.map(n=>n.id===L.id?{...n,sharesCount:n.sharesCount+1}:n))}}),e.jsx("style",{children:`
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      `})]})}function rt(){const[i,f]=Ne(),[r,d]=t.useState("following"),[b,o]=t.useState(null),[x,h]=t.useState([]),[w,k]=t.useState([]),[T,v]=t.useState([]),[P,M]=t.useState(!0),[y,j]=t.useState(!1),[A,S]=t.useState(1),[V,U]=t.useState(!0),[I,R]=t.useState(0),[m,N]=t.useState(null),[O,L]=t.useState(null),[G,D]=t.useState(null),[B,$]=t.useState("grid"),H=t.useRef(null),{token:z}=le();if(B==="immersive")return e.jsx(Xe,{initialPosts:x,onSwitchToGrid:()=>$("grid")});const g=t.useCallback(async(s=!1)=>{try{s?(M(!0),S(1),R(0)):j(!0);const a=s?1:A;let n;r==="hashtag"&&b?n=await E.getPostsByHashtag(b,a,20):r==="following"?n=await E.getFeed(a,20):n=await E.getDiscover(a,20),h(s?n.data.data:u=>[...u,...n.data.data]),U(n.data.meta.hasMore)}catch(a){console.error("Error loading posts:",a),p.error("Failed to load posts")}finally{M(!1),j(!1)}},[r,b,A]),W=async()=>{try{const s=await ue.getSuggestedUsers(5);k(s.data)}catch(s){console.error("Error loading suggested users:",s)}},l=async()=>{try{const s=await E.getTrendingHashtags(8);v(s.data)}catch(s){console.error("Error loading trending hashtags:",s)}};t.useEffect(()=>{if(!z)return;const s=He(`${window.location.protocol}//${window.location.host}/timeline`,{auth:{token:z},transports:["websocket","polling"]});return s.on("connect",()=>{console.log("Connected to timeline WebSocket")}),s.on("post:new",a=>{h(n=>(n.some(u=>u.id===a.id)||R(u=>u+1),n))}),s.on("post:liked",({postId:a,likesCount:n})=>{h(u=>u.map(c=>c.id===a?{...c,likesCount:n}:c))}),s.on("post:unliked",({postId:a,likesCount:n})=>{h(u=>u.map(c=>c.id===a?{...c,likesCount:n}:c))}),s.on("post:commented",({postId:a,commentsCount:n})=>{h(u=>u.map(c=>c.id===a?{...c,commentsCount:n}:c))}),s.on("post:shared",({originalPostId:a,sharesCount:n})=>{h(u=>u.map(c=>c.id===a?{...c,sharesCount:n}:c))}),H.current=s,()=>{s.disconnect()}},[z]),t.useEffect(()=>{const s=i.get("hashtag");s&&(o(s),d("hashtag"))},[i]),t.useEffect(()=>{g(!0),W(),l()},[r,b]);const F=()=>{S(s=>s+1),g(!1)},C=()=>{g(!0)},X=s=>{h(a=>a.filter(n=>n.id!==s))},Z=async s=>{try{await ue.followUser(s),k(a=>a.filter(n=>n.id!==s)),p.success("Now following user")}catch{p.error("Failed to follow user")}},q=s=>{o(s),d("hashtag"),f({hashtag:s})},Q=()=>{o(null),d("following"),f({})},_=()=>{g(!0)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-0 sm:px-4 py-0 sm:py-8",children:[e.jsxs("div",{className:"hidden sm:flex mb-8 px-4 sm:px-0 items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Timeline"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Share and discover posts from your network"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-sm",children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all bg-blue-500 text-white shadow-md",children:[e.jsx(ye,{className:"w-4 h-4"}),"Grid"]}),e.jsxs("button",{onClick:()=>$("immersive"),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsx(he,{className:"w-4 h-4"}),"Immersive"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-0 sm:gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"px-4 sm:px-0",children:e.jsx(Ve,{onPostCreated:C})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 sm:rounded-xl shadow-sm mb-0 sm:mb-6 sticky top-0 z-20",children:e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>{d("following"),Q()},className:`flex-1 flex items-center justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium transition-colors ${r==="following"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Following"})]}),e.jsxs("button",{onClick:()=>{d("discover"),o(null),f({})},className:`flex-1 flex items-center justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium transition-colors ${r==="discover"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Discover"})]}),r==="hashtag"&&b&&e.jsxs("div",{className:"flex-1 flex items-center justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4 text-sm font-medium text-blue-600 border-b-2 border-blue-600",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{className:"truncate max-w-[80px] sm:max-w-none",children:["#",b]}),e.jsx("button",{onClick:Q,className:"ml-1 text-gray-400 hover:text-gray-600",children:"Ã—"})]})]})}),I>0&&e.jsxs("button",{onClick:_,className:"w-full mb-0 sm:mb-4 py-3 bg-blue-50 dark:bg-blue-900/20 text-blue-600 sm:rounded-xl flex items-center justify-center gap-2 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsx(ze,{className:"w-4 h-4"}),I," new ",I===1?"post":"posts"," available"]}),e.jsx("div",{className:"hidden sm:flex justify-end mb-4",children:e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:text-blue-700",children:[e.jsx(be,{className:`w-4 h-4 ${P?"animate-spin":""}`}),"Refresh"]})}),P?e.jsx("div",{className:"space-y-0 sm:space-y-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 sm:rounded-xl p-4 sm:p-6 animate-pulse border-b sm:border-b-0 border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})]}),e.jsx("div",{className:"mt-3 h-48 sm:h-64 bg-gray-200 dark:bg-gray-700 rounded-none sm:rounded-xl"})]},s))}):x.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 sm:rounded-xl p-8 sm:p-12 text-center mx-4 sm:mx-0",children:[e.jsx(de,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2",children:r==="hashtag"&&b?`No posts with #${b}`:r==="following"?"No posts yet":"Nothing to discover"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-500 dark:text-gray-400",children:r==="hashtag"?"Be the first to post with this hashtag":r==="following"?"Follow more users or create your first post":"Check back later for trending content"})]}):e.jsxs("div",{className:"space-y-0 sm:space-y-4 divide-y sm:divide-y-0 divide-gray-200 dark:divide-gray-700",children:[x.map(s=>e.jsx(Ue,{post:s,onDelete:X,onEdit:D,onHashtagClick:q,onCommentClick:(a,n)=>{N(a),L(n)}},s.id)),V&&e.jsx("button",{onClick:F,disabled:y,className:"w-full py-4 sm:py-3 text-center text-blue-600 hover:text-blue-700 font-medium bg-white dark:bg-gray-800 sm:rounded-xl",children:y?"Loading...":"Load more"})]})]}),e.jsxs("div",{className:"hidden lg:block space-y-6",children:[T.length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-purple-500"}),"Trending Hashtags"]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map(s=>e.jsxs("button",{onClick:()=>q(s.tag),className:`px-3 py-1.5 text-sm rounded-full transition-colors ${b===s.tag?"bg-purple-600 text-white":"bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-purple-900/30"}`,children:["#",s.tag,e.jsxs("span",{className:"ml-1 text-xs opacity-70",children:["(",s.postCount,")"]})]},s.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-blue-500"}),"Suggested for you"]})}),w.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No suggestions available"}):e.jsx("div",{className:"space-y-4",children:w.map(s=>{var a;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{to:`/profile/${s.username||s.id}`,children:s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center text-white font-bold text-sm",children:((a=s.name)==null?void 0:a.charAt(0))||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(K,{to:`/profile/${s.username||s.id}`,className:"font-medium text-sm text-gray-900 dark:text-white hover:text-blue-600 truncate block",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:s.headline||`${s.followersCount} followers`})]}),e.jsx("button",{onClick:()=>Z(s.id),className:"px-3 py-1 text-xs font-medium text-blue-600 border border-blue-600 rounded-full hover:bg-blue-50 dark:hover:bg-blue-900/20",children:"Follow"})]},s.id)})})]})]})]})]}),e.jsx(Ye,{postId:m||"",post:O||void 0,isOpen:!!m,onClose:()=>{N(null),L(null)},onCommentAdded:()=>{h(s=>s.map(a=>a.id===m?{...a,commentsCount:a.commentsCount+1}:a))}}),e.jsx(Oe,{post:G,isOpen:!!G,onClose:()=>D(null),onPostUpdated:s=>{h(a=>a.map(n=>n.id===s.id?s:n))}})]})}export{rt as default};
