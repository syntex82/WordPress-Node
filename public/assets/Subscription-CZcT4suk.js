import{r as n,d as E,a as A,j as e}from"./vendor-react-D2QycniR.js";import{W as c,z as i}from"./index-JNkgy8O1.js";import{b as L,c as z,d as T,e as _,f as B,g as y,h as I,i as H}from"./index-wpyAkZLf.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";const D=async()=>(await c.get("/subscriptions/plans")).data,Y=async()=>{try{return(await c.get("/subscriptions/current")).data}catch{return null}},$=async()=>(await c.post("/subscriptions/portal")).data,q=async()=>(await c.post("/subscriptions/cancel")).data,M=async()=>(await c.post("/subscriptions/admin/seed-plans")).data,R=async()=>(await c.post("/subscriptions/admin/activate-all-plans")).data,a={success:s=>{i.success(s,{duration:3e3,position:"top-right",style:{background:"#10B981",color:"#fff"}})},error:s=>{i.error(s,{duration:4e3,position:"top-right",style:{background:"#EF4444",color:"#fff"}})},loading:s=>i.loading(s,{position:"top-right"}),dismiss:s=>{i.dismiss(s)},info:s=>{i(s,{duration:3e3,position:"top-right",icon:"ℹ️",style:{background:"#3B82F6",color:"#fff"}})},warning:s=>{i(s,{duration:3500,position:"top-right",icon:"⚠️",style:{background:"#F59E0B",color:"#fff"}})}},W="pk_live_51RjyaDFzzHwoqssW7e8C8sFpNTIOMuZ8gDf783cQdgOAfTeHna4Bqt4qHL6vsH3SjTZ9xtAMR6o5KlFmihtOkOiJ00VkqHy520",G={pro:{monthly:"prctbl_1SlFs9FzzHwoqssW6FnSSRPp",yearly:"prctbl_1SlFwxFzzHwoqssWGVxPpjJY"},business:{monthly:"prctbl_1SlFv0FzzHwoqssWOMKoUr4r",yearly:"prctbl_1SlFvzFzzHwoqssWaFG9da7G"}};function O({pricingTableId:s}){return n.useEffect(()=>{if(!document.querySelector('script[src="https://js.stripe.com/v3/pricing-table.js"]')){const o=document.createElement("script");o.src="https://js.stripe.com/v3/pricing-table.js",o.async=!0,document.head.appendChild(o)}},[]),e.jsx("div",{dangerouslySetInnerHTML:{__html:`<stripe-pricing-table pricing-table-id="${s}" publishable-key="${W}"></stripe-pricing-table>`}})}function X(){const[s,o]=n.useState(null),[f,j]=n.useState([]),[w,N]=n.useState(!0),[l,r]=n.useState(!1),[d,p]=n.useState("monthly"),[x,m]=n.useState("pro"),[b]=E(),h=A();n.useEffect(()=>{g(),b.get("session_id")&&(a.success("Subscription successful! Your plan is now active."),h("/admin/subscription",{replace:!0}))},[b,h]);const g=async()=>{try{const[t,F]=await Promise.all([Y(),D()]);o(t),j(F)}catch{a.error("Failed to load subscription data")}finally{N(!1)}},v=async()=>{r(!0);try{const{url:t}=await $();t&&(window.location.href=t)}catch{a.error("Failed to open billing portal")}finally{r(!1)}},k=async()=>{if(confirm("Are you sure you want to cancel your subscription? You will keep access until the end of your billing period.")){r(!0);try{await q(),a.success("Subscription canceled. Access continues until end of billing period."),g()}catch{a.error("Failed to cancel subscription")}finally{r(!1)}}},S=async()=>{r(!0);try{const t=await M();a.success(t.message+(t.count?` (${t.count} plans created)`:"")),g()}catch{a.error("Failed to seed plans")}finally{r(!1)}},C=async()=>{r(!0);try{const t=await R();a.success(t.message+(t.count?` (${t.count} plans activated)`:"")),g()}catch{a.error("Failed to activate plans")}finally{r(!1)}},u=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),P=t=>{switch(t){case"ACTIVE":return"bg-green-100 text-green-800";case"TRIALING":return"bg-blue-100 text-blue-800";case"PAST_DUE":return"bg-yellow-100 text-yellow-800";case"CANCELED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return w?e.jsx("div",{className:"p-6 flex items-center justify-center min-h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-8",children:"My Subscription"}),s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(L,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.plan.name}),e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${P(s.status)}`,children:s.status})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["$",s.billingCycle==="YEARLY"?s.plan.yearlyPrice:s.plan.monthlyPrice]}),e.jsxs("p",{className:"text-gray-500",children:["/",s.billingCycle.toLowerCase()]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Current Period"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:[u(s.currentPeriodStart)," - ",u(s.currentPeriodEnd)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Billing Cycle"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.billingCycle})]})]})]}),s.cancelAtPeriodEnd&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400 rounded-lg mb-6",children:[e.jsx(_,{className:"h-5 w-5"}),e.jsxs("p",{children:["Your subscription will cancel on ",u(s.currentPeriodEnd)]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:v,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50",children:[e.jsx(B,{className:"h-4 w-4"}),"Manage Billing"]}),!s.cancelAtPeriodEnd&&s.status==="ACTIVE"&&e.jsx("button",{onClick:k,disabled:l,className:"px-4 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition disabled:opacity-50",children:"Cancel Subscription"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Your Plan Includes"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:s.plan.features.map(t=>e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx(y,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"capitalize",children:t.replace(/_/g," ")})]},t))})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"You're on the Free Plan"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Upgrade to unlock more features and remove limits."})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-lg inline-flex",children:[e.jsx("button",{onClick:()=>p("monthly"),className:`px-6 py-2 rounded-md font-medium transition ${d==="monthly"?"bg-white dark:bg-gray-700 text-blue-600 shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900"}`,children:"Monthly"}),e.jsxs("button",{onClick:()=>p("yearly"),className:`px-6 py-2 rounded-md font-medium transition ${d==="yearly"?"bg-white dark:bg-gray-700 text-blue-600 shadow":"text-gray-600 dark:text-gray-400 hover:text-gray-900"}`,children:["Yearly ",e.jsx("span",{className:"text-green-500 text-sm",children:"(Save ~17%)"})]})]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs("button",{onClick:()=>m("pro"),className:`px-8 py-3 rounded-lg font-semibold transition ${x==="pro"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300"}`,children:["Pro Plan",e.jsx("span",{className:"block text-sm font-normal",children:d==="monthly"?"£29/month":"£290/year"})]}),e.jsxs("button",{onClick:()=>m("business"),className:`px-8 py-3 rounded-lg font-semibold transition ${x==="business"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300"}`,children:["Business Plan",e.jsx("span",{className:"block text-sm font-normal",children:d==="monthly"?"£99/month":"£990/year"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6",children:e.jsx(O,{pricingTableId:G[x][d]})}),f.length===0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Admin: Seed database plans for tracking"}),e.jsxs("div",{className:"flex justify-center gap-4 flex-wrap",children:[e.jsxs("button",{onClick:S,disabled:l,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50 text-sm",children:[e.jsx(H,{className:"h-4 w-4"}),l?"Creating...":"Create Plans"]}),e.jsxs("button",{onClick:C,disabled:l,className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition disabled:opacity-50 text-sm",children:[e.jsx(y,{className:"h-4 w-4"}),l?"Activating...":"Activate Plans"]})]})]})]})]})}export{X as default};
