import{a as K,r as a,j as e,L as Q}from"./vendor-react-D2QycniR.js";import{u as Z,aa as _,z as i,N as ee,a0 as te,C as se,v as ae,Y as le,X as re,ao as ie,O as oe,ai as ne,V as ce,cg as T}from"./index-JNkgy8O1.js";import{M as de}from"./MobileMediaRecorder-9ETYe9lu.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";function ge(){const C=K(),{resolvedTheme:W}=Z(),t=W==="dark",{user:A}=_(),[c,b]=a.useState("none"),[$,p]=a.useState(null),[g,f]=a.useState(null),[P,j]=a.useState(null),[S,B]=a.useState(null),[F,U]=a.useState(null),[y,H]=a.useState(""),[V,X]=a.useState(""),[v,M]=a.useState(!0),[u,w]=a.useState(0),[N,L]=a.useState(!1),[E,m]=a.useState(0),[k,O]=a.useState(!1),[G,R]=a.useState(!1),h=a.useRef(null),z=a.useRef(null),Y=a.useCallback(s=>{if(s.type!=="VIDEO"){i.error("Please record a video");return}p(s.url),j(s.url),b("recorded"),f(null),s.thumbnail&&U(s.thumbnail),R(!1);const l=document.createElement("video");l.src=s.url,l.onloadedmetadata=()=>{const r=Math.round(l.duration);w(r),r<15?(i.error("Reel must be at least 15 seconds"),d()):r>60?(i.error("Reel must be 60 seconds or less"),d()):i.success("Video recorded successfully!")}},[]),d=()=>{p(null),f(null),j(null),b("none"),w(0),O(!1)},q=a.useCallback(s=>{var x;const l=(x=s.target.files)==null?void 0:x[0];if(!l)return;if(!l.type.startsWith("video/")){i.error("Please select a video file");return}if(l.size>100*1024*1024){i.error("Video must be under 100MB");return}f(l),p(null);const r=URL.createObjectURL(l);j(r),b("uploaded");const n=document.createElement("video");n.src=r,n.onloadedmetadata=()=>{const o=Math.round(n.duration);w(o),o<15?(i.error("Reel must be at least 15 seconds"),d()):o>60&&(i.error("Reel must be 60 seconds or less"),d())}},[]);a.useCallback(s=>{var r;const l=(r=s.target.files)==null?void 0:r[0];if(l){if(!l.type.startsWith("image/")){i.error("Please select an image file");return}B(l),U(URL.createObjectURL(l))}},[]);const D=()=>{h.current&&(k?h.current.pause():h.current.play(),O(!k))},J=async()=>{var s,l;if(c==="none"||!$&&!g){i.error("Please record or upload a video");return}if(u<15){i.error("Reel must be at least 15 seconds");return}if(u>60){i.error("Reel must be 60 seconds or less");return}L(!0),m(0);try{let r=$,n=F;if(c==="uploaded"&&g){const o=new FormData;o.append("video",g),S&&o.append("thumbnail",S);const I=await T.uploadVideo(o);m(50),r=I.data.videoUrl,n=I.data.thumbnailUrl||F||void 0}else m(50);const x=V.split(/[,\s#]+/).filter(o=>o.trim()).map(o=>o.trim());await T.createReel({videoUrl:r,thumbnailUrl:n||void 0,caption:y.trim()||void 0,duration:u,isPublic:v,hashtags:x.length>0?x:void 0}),m(100),i.success("Reel created successfully!"),C("/reels")}catch(r){console.error("Error creating reel:",r),i.error(((l=(s=r.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to create reel")}finally{L(!1)}};return A?e.jsxs("div",{className:`min-h-screen ${t?"bg-slate-900":"bg-gray-50"}`,children:[e.jsx("header",{className:`sticky top-0 z-40 ${t?"bg-slate-900/95":"bg-white/95"} backdrop-blur border-b ${t?"border-slate-800":"border-gray-200"}`,children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>C(-1),className:`flex items-center gap-2 ${t?"text-slate-400 hover:text-white":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{className:`text-lg font-semibold ${t?"text-white":"text-gray-900"}`,children:"Create Reel"}),e.jsx("div",{className:"w-16"})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[P?e.jsxs("div",{className:"relative w-full max-w-[280px] aspect-[9/16] bg-black rounded-2xl overflow-hidden",children:[e.jsx("video",{ref:h,src:P,className:"w-full h-full object-cover",loop:!0,playsInline:!0,onClick:D}),e.jsx("button",{onClick:D,className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 hover:opacity-100 transition-opacity",children:k?e.jsx(te,{className:"w-12 h-12 text-white"}):e.jsx(se,{className:"w-12 h-12 text-white"})}),e.jsx("button",{onClick:d,className:"absolute top-2 right-2 p-2 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 rounded text-white text-sm",children:[u,"s"]}),c==="recorded"&&e.jsx("div",{className:"absolute top-2 left-2 px-2 py-1 bg-pink-500/80 rounded text-white text-xs font-medium",children:"Recorded"})]}):e.jsxs("div",{className:"w-full max-w-[280px] space-y-4",children:[e.jsxs("button",{onClick:()=>R(!0),className:"w-full aspect-[9/16] rounded-2xl bg-gradient-to-br from-pink-500 to-purple-600 flex flex-col items-center justify-center gap-4 hover:opacity-90 transition-opacity",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(le,{className:"w-10 h-10 text-white"})}),e.jsxs("div",{className:"text-center text-white",children:[e.jsx("p",{className:"font-semibold text-lg",children:"Record Reel"}),e.jsx("p",{className:"text-sm text-white/80",children:"15-60 seconds"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex-1 h-px ${t?"bg-slate-700":"bg-gray-300"}`}),e.jsx("span",{className:`text-sm ${t?"text-slate-500":"text-gray-500"}`,children:"or"}),e.jsx("div",{className:`flex-1 h-px ${t?"bg-slate-700":"bg-gray-300"}`})]}),e.jsxs("button",{onClick:()=>{var s;return(s=z.current)==null?void 0:s.click()},className:`w-full py-4 rounded-xl border-2 border-dashed flex items-center justify-center gap-3 transition-colors ${t?"border-slate-700 hover:border-pink-500 bg-slate-800/50 text-white":"border-gray-300 hover:border-pink-500 bg-gray-100 text-gray-900"}`,children:[e.jsx(re,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Upload Video"})]}),e.jsx("p",{className:`text-center text-xs ${t?"text-slate-500":"text-gray-500"}`,children:"MP4, MOV, WebM • 15-60 seconds • Max 100MB"})]}),e.jsx("input",{ref:z,type:"file",accept:"video/*",onChange:q,className:"hidden"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-white":"text-gray-900"}`,children:"Caption"}),e.jsx("textarea",{value:y,onChange:s=>H(s.target.value),placeholder:"Write a caption...",maxLength:2200,rows:4,className:`w-full px-4 py-3 rounded-xl border resize-none ${t?"bg-slate-800 border-slate-700 text-white placeholder-slate-500":"bg-white border-gray-300 text-gray-900"}`}),e.jsxs("p",{className:`text-xs mt-1 ${t?"text-slate-500":"text-gray-500"}`,children:[y.length,"/2200"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:`block text-sm font-medium mb-2 ${t?"text-white":"text-gray-900"}`,children:[e.jsx(ie,{className:"inline w-4 h-4 mr-1"})," Hashtags"]}),e.jsx("input",{type:"text",value:V,onChange:s=>X(s.target.value),placeholder:"dance, music, trending",className:`w-full px-4 py-3 rounded-xl border ${t?"bg-slate-800 border-slate-700 text-white placeholder-slate-500":"bg-white border-gray-300 text-gray-900"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${t?"text-white":"text-gray-900"}`,children:"Visibility"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>M(!0),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl border transition-colors ${v?"bg-pink-500 border-pink-500 text-white":t?"bg-slate-800 border-slate-700 text-slate-400":"bg-white border-gray-300 text-gray-600"}`,children:[e.jsx(oe,{className:"w-5 h-5"})," Public"]}),e.jsxs("button",{onClick:()=>M(!1),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl border transition-colors ${v?t?"bg-slate-800 border-slate-700 text-slate-400":"bg-white border-gray-300 text-gray-600":"bg-pink-500 border-pink-500 text-white"}`,children:[e.jsx(ne,{className:"w-5 h-5"})," Private"]})]})]}),N&&e.jsxs("div",{className:`p-4 rounded-xl ${t?"bg-slate-800":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm ${t?"text-white":"text-gray-900"}`,children:c==="recorded"?"Creating reel...":"Uploading..."}),e.jsxs("span",{className:`text-sm ${t?"text-slate-400":"text-gray-500"}`,children:[E,"%"]})]}),e.jsx("div",{className:`h-2 rounded-full overflow-hidden ${t?"bg-slate-700":"bg-gray-300"}`,children:e.jsx("div",{className:"h-full bg-gradient-to-r from-pink-500 to-purple-600 transition-all",style:{width:`${E}%`}})})]}),e.jsx("button",{onClick:J,disabled:c==="none"||N,className:"w-full py-4 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-semibold rounded-xl hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-5 h-5"})," Post Reel"]})})]})]})}),e.jsx(de,{isOpen:G,onClose:()=>R(!1),onMediaCaptured:Y,mode:"video"})]}):e.jsx("div",{className:`min-h-screen flex items-center justify-center ${t?"bg-slate-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-lg ${t?"text-white":"text-gray-900"}`,children:"Please log in to create reels"}),e.jsx(Q,{to:"/login",className:"mt-4 inline-block px-6 py-2 bg-pink-500 text-white rounded-full",children:"Log In"})]})})}export{ge as default};
