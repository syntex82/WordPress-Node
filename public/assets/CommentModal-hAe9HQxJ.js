import{r as i,j as e,L as H}from"./vendor-react-D2QycniR.js";import{b5 as B,v as G,a7 as Y,a8 as W,aV as X,i as J,a4 as K,C as O,a3 as _,u as Q,cg as U,z as E,J as Z,L as ee,co as te,Y as se,aq as ae,at as le}from"./index-Bpp1ZX0C.js";import{M as re}from"./MobileMediaRecorder-DvADZrOG.js";import{f as q}from"./vendor-utils-BWf5C302.js";function de({media:a,className:f="",immersive:h=!0}){const[c,g]=i.useState(null),[V,r]=i.useState({}),[b,k]=i.useState({}),p=i.useRef({});if(!a||a.length===0)return null;const j=a.length===1&&a[0].type==="VIDEO";a.length===1&&a[0].type,j&&a[0].height&&a[0].width&&a[0].height>a[0].width;const v=t=>g(t),$=()=>g(null),I=()=>{c!==null&&g((c+1)%a.length)},R=()=>{c!==null&&g((c-1+a.length)%a.length)},w=t=>{try{const s=new URL(t).hostname.toLowerCase();return s==="youtube.com"||s==="www.youtube.com"||s==="youtu.be"||s==="m.youtube.com"}catch{return!1}},C=t=>{try{const s=new URL(t).hostname.toLowerCase();return s==="vimeo.com"||s==="www.vimeo.com"||s==="player.vimeo.com"}catch{return!1}},o=t=>{const s=t.match(/(?:youtube\.com\/(?:watch\?v=|embed\/)|youtu\.be\/)([^&\n?#]+)/);return s?s[1]:null},P=t=>{const s=t.match(/vimeo\.com\/(\d+)/);return s?s[1]:null},M=(t,s)=>{s.stopPropagation();const n=p.current[t];n&&(n.paused?(n.play(),r(m=>({...m,[t]:!0}))):(n.pause(),r(m=>({...m,[t]:!1}))))},F=(t,s)=>{s.stopPropagation();const n=p.current[t];n&&(n.muted=!n.muted,k(m=>({...m,[t]:n.muted})))},L=t=>{const s=Math.floor(t/60),n=Math.floor(t%60);return`${s}:${n.toString().padStart(2,"0")}`},S=(t,s,n=!1)=>{const m=t.type==="VIDEO",z=t.type==="AUDIO",l=t.type==="LINK",x=t.height&&t.width&&t.height>t.width;if(l){const u=(()=>{try{return new URL(t.url).hostname}catch{return t.url}})();return e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",onClick:d=>d.stopPropagation(),className:"block w-full h-full bg-slate-800 hover:bg-slate-750 transition-colors",children:[t.thumbnail?e.jsxs("div",{className:"relative h-32 sm:h-40 w-full",children:[e.jsx("img",{src:t.thumbnail,alt:"",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"})]}):e.jsx("div",{className:"h-20 sm:h-24 w-full bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center",children:e.jsx(X,{className:"w-8 h-8 text-white/80"})}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsx("h4",{className:"font-medium text-sm sm:text-base text-white line-clamp-2 mb-1",children:t.linkTitle||u}),t.linkDescription&&e.jsx("p",{className:"text-xs sm:text-sm text-slate-400 line-clamp-2 mb-2",children:t.linkDescription}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-slate-500",children:[e.jsx(J,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"truncate",children:t.linkSiteName||u})]})]})]})}if(w(t.url)){const u=o(t.url);return e.jsx("iframe",{src:`https://www.youtube.com/embed/${u}`,className:n?"max-w-full max-h-full":"w-full h-full",style:n?{width:"80vw",height:"45vw",maxHeight:"80vh"}:{},allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})}if(C(t.url)){const u=P(t.url);return e.jsx("iframe",{src:`https://player.vimeo.com/video/${u}`,className:n?"max-w-full max-h-full":"w-full h-full",style:n?{width:"80vw",height:"45vw",maxHeight:"80vh"}:{},allowFullScreen:!0,allow:"autoplay; fullscreen; picture-in-picture"})}if(z)return e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-purple-600 to-indigo-700 flex flex-col items-center justify-center p-4 min-h-[120px]",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mb-3",children:e.jsx(K,{className:"w-8 h-8 text-white"})}),e.jsx("audio",{src:t.url,controls:!0,className:"w-full max-w-[280px]",onClick:u=>u.stopPropagation()}),t.duration&&e.jsx("span",{className:"text-white/80 text-sm mt-2",children:L(t.duration)})]});if(m){const u=h&&j&&!n;return e.jsx("div",{className:"relative w-full h-full bg-black",children:n?e.jsx("video",{src:t.url,controls:!0,playsInline:!0,className:x?"max-h-[90vh] max-w-[60vw] sm:max-w-[50vw]":"max-w-[95vw] max-h-[85vh] sm:max-w-[90vw] sm:max-h-[90vh]"}):u?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:d=>{p.current[s]=d},src:t.url,className:`w-full h-full ${x?"object-contain":"object-cover"}`,poster:t.thumbnail,playsInline:!0,muted:b[s]??!0,loop:!0,onClick:d=>M(s,d),onEnded:()=>r(d=>({...d,[s]:!1}))}),!V[s]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 cursor-pointer",onClick:d=>M(s,d),children:e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-white/90 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(O,{className:"w-8 h-8 sm:w-10 sm:h-10 text-gray-800 ml-1"})})}),e.jsx("button",{onClick:d=>F(s,d),className:"absolute bottom-3 right-3 p-2.5 bg-black/60 rounded-full text-white hover:bg-black/80 transition-colors",children:b[s]??!0?e.jsx(_,{className:"w-5 h-5"}):e.jsx(K,{className:"w-5 h-5"})}),t.duration&&e.jsx("div",{className:"absolute bottom-3 left-3 bg-black/70 text-white text-xs px-2 py-1 rounded",children:L(t.duration)})]}):e.jsxs(e.Fragment,{children:[e.jsx("video",{src:t.url,className:"w-full h-full object-cover pointer-events-none",poster:t.thumbnail}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 pointer-events-none",children:e.jsx("div",{className:"w-14 h-14 sm:w-12 sm:h-12 bg-white/90 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-7 h-7 sm:w-6 sm:h-6 text-gray-800 ml-1"})})}),t.duration&&e.jsx("div",{className:"absolute bottom-2 right-10 sm:right-2 bg-black/70 text-white text-xs px-2 py-1 rounded pointer-events-none",children:L(t.duration)})]})})}return e.jsx("img",{src:t.url,alt:t.altText||"",className:n?"max-w-[95vw] max-h-[85vh] sm:max-w-[90vw] sm:max-h-[90vh] object-contain":"w-full h-full object-cover pointer-events-none"})},A=()=>{switch(a.length){case 1:return"grid-cols-1";case 2:return"grid-cols-1 sm:grid-cols-2";case 3:return"grid-cols-1 sm:grid-cols-2";case 4:return"grid-cols-2";default:return"grid-cols-2"}},y=t=>{const s=a[t];return s.type==="AUDIO"?"aspect-[3/1] sm:aspect-[4/1]":s.type==="LINK"?"":a.length===1?s.type==="VIDEO"&&s.height&&s.width&&s.height>s.width?"aspect-[9/16] max-h-[85vh] sm:max-h-[80vh]":s.type==="VIDEO"?"aspect-[4/3] sm:aspect-video":"aspect-square sm:aspect-[4/3]":a.length===2?"aspect-[4/3] sm:aspect-square":a.length===3&&t===0?"aspect-[4/3] sm:aspect-square sm:row-span-2":"aspect-square"},T=t=>h&&j&&t.type==="VIDEO",D=t=>t.type==="AUDIO",N=t=>t.type==="LINK";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`grid ${A()} gap-0.5 sm:gap-1.5 rounded-none sm:rounded-2xl overflow-hidden ${f}`,children:a.slice(0,4).map((t,s)=>{const n=T(t)||D(t)||N(t);return e.jsxs("div",{onClick:m=>{m.stopPropagation(),n||v(s)},onTouchEnd:m=>{m.stopPropagation()},className:`relative ${n?"":"cursor-pointer"} overflow-hidden ${y(s)}
                ${a.length===3&&s===0?"col-span-full sm:col-span-1 sm:row-span-2":""}
                hover:opacity-95 transition-opacity touch-manipulation`,children:[S(t,s),s===3&&a.length>4&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center pointer-events-none",children:e.jsxs("span",{className:"text-white text-xl sm:text-2xl font-bold",children:["+",a.length-4]})}),!n&&e.jsx("div",{className:"absolute bottom-2 right-2 sm:bottom-3 sm:right-3 p-2 sm:p-2.5 bg-black/60 rounded-full pointer-events-none",children:e.jsx(B,{className:"w-4 h-4 sm:w-4 sm:h-4 text-white"})})]},t.id||s)})}),c!==null&&e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black flex items-center justify-center",onClick:$,style:{touchAction:"none"},children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),$()},className:"absolute top-4 right-4 sm:top-6 sm:right-6 p-3 text-white hover:text-white/80 z-20 bg-black/50 rounded-full touch-manipulation",children:e.jsx(G,{className:"w-7 h-7 sm:w-8 sm:h-8"})}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),R()},className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 p-3 text-white hover:text-white/80 bg-black/50 rounded-full z-20 touch-manipulation",children:e.jsx(Y,{className:"w-7 h-7 sm:w-8 sm:h-8"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),I()},className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 p-3 text-white hover:text-white/80 bg-black/50 rounded-full z-20 touch-manipulation",children:e.jsx(W,{className:"w-7 h-7 sm:w-8 sm:h-8"})})]}),e.jsx("div",{onClick:t=>t.stopPropagation(),className:"flex items-center justify-center w-full h-full p-4",children:S(a[c],c,!0)}),a.length>1&&e.jsxs("div",{className:"absolute bottom-6 sm:bottom-8 left-1/2 -translate-x-1/2 text-white text-sm sm:text-base bg-black/60 px-4 py-2 rounded-full z-20",children:[c+1," / ",a.length]})]})]})}function he({postId:a,isOpen:f,onClose:h,onCommentAdded:c,post:g}){const{resolvedTheme:V}=Q(),r=V==="dark",[b,k]=i.useState([]),[p,j]=i.useState(!0),[v,$]=i.useState(""),[I,R]=i.useState(!1),[w,C]=i.useState(null),[o,P]=i.useState(g||null),[M,F]=i.useState(!g),[L,S]=i.useState(!1),[A,y]=i.useState(!1),[T,D]=i.useState("video"),N=i.useRef(null),t=i.useRef(null);i.useEffect(()=>{f&&a&&(n(),g?(P(g),F(!1)):s())},[f,a,g]),i.useEffect(()=>{f&&N.current&&!p&&setTimeout(()=>{var l;return(l=N.current)==null?void 0:l.focus()},100)},[f,w,p]),i.useEffect(()=>(f&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=""}),[f]);const s=async()=>{try{F(!0);const l=await U.getPost(a);P(l.data)}catch(l){console.error("Failed to load post:",l)}finally{F(!1)}},n=async()=>{try{j(!0);const l=await U.getComments(a);console.log("Comments response:",l.data),k(l.data.data||[])}catch(l){console.error("Failed to load comments:",l),E.error("Failed to load comments")}finally{j(!1)}},m=async l=>{if(l.preventDefault(),!(!v.trim()||I)){R(!0);try{const x=await U.addComment(a,v.trim(),w||void 0);console.log("Add comment response:",x.data),k(w?u=>u.map(d=>d.id===w?{...d,replies:[...d.replies||[],x.data]}:d):u=>[x.data,...u]),$(""),C(null),c==null||c(),E.success("Comment added!")}catch(x){console.error("Failed to add comment:",x),E.error("Failed to add comment")}finally{R(!1)}}},z=async l=>{E.success(`${l.type.toLowerCase()} recorded! Video comments coming soon.`),y(!1)};return f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed inset-0 z-50 flex flex-col ${r?"bg-slate-900":"bg-gray-50"}`,children:[e.jsxs("div",{className:`flex-shrink-0 flex items-center gap-3 px-3 sm:px-4 py-3 border-b safe-area-inset-top ${r?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}`,children:[e.jsx("button",{onClick:h,className:`p-2 -ml-1 rounded-full transition-colors ${r?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("h3",{className:`text-lg font-semibold flex-1 ${r?"text-white":"text-gray-900"}`,children:"Comments"}),e.jsx("button",{onClick:h,className:`p-2 rounded-full ${r?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:[(M||p)&&!o?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"})}):o&&e.jsxs("div",{className:`p-4 border-b ${r?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(H,{to:`/profile/${o.user.username||o.user.id}`,children:o.user.avatar?e.jsx("img",{src:o.user.avatar,alt:o.user.name,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg",children:o.user.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(H,{to:`/profile/${o.user.username||o.user.id}`,className:`font-semibold hover:underline ${r?"text-white":"text-gray-900"}`,children:o.user.name}),o.user.headline&&e.jsx("p",{className:`text-sm line-clamp-1 ${r?"text-slate-400":"text-gray-500"}`,children:o.user.headline}),e.jsx("p",{className:`text-xs ${r?"text-slate-500":"text-gray-400"}`,children:q(new Date(o.createdAt),{addSuffix:!0})})]})]}),o.content&&e.jsx("p",{className:`whitespace-pre-wrap mb-3 ${r?"text-slate-200":"text-gray-800"}`,children:o.content}),o.media&&o.media.length>0&&e.jsx("div",{className:"rounded-xl overflow-hidden mb-3",children:o.media.map((l,x)=>e.jsxs("div",{children:[l.type==="IMAGE"&&e.jsx("img",{src:l.url,alt:l.altText||"",className:"w-full max-h-96 object-cover"}),l.type==="VIDEO"&&e.jsx("video",{src:l.url,controls:!0,className:"w-full max-h-96"})]},l.id||x))}),e.jsxs("div",{className:`flex items-center gap-6 pt-3 text-sm ${r?"text-slate-400":"text-gray-500"}`,children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(Z,{className:"w-4 h-4"})," ",o.likesCount," likes"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[b.length," comments"]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx(ee,{className:"w-4 h-4"})," ",o.sharesCount," shares"]})]})]}),e.jsx("div",{className:`px-4 py-3 border-b ${r?"border-slate-700":"border-gray-200"}`,children:e.jsx("h4",{className:`font-medium ${r?"text-slate-300":"text-gray-700"}`,children:p?"Loading comments...":`${b.length} Comment${b.length!==1?"s":""}`})}),e.jsxs("div",{className:`p-4 space-y-4 ${r?"":"bg-white"}`,children:[p?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):b.length===0?e.jsxs("div",{className:`text-center py-12 ${r?"text-slate-400":"text-gray-500"}`,children:[e.jsx("p",{className:"text-lg mb-1",children:"No comments yet"}),e.jsx("p",{className:"text-sm",children:"Be the first to share your thoughts!"})]}):b.map(l=>e.jsx(ne,{comment:l,onReply:x=>{var u;C(x),(u=N.current)==null||u.focus()},isDark:r},l.id)),e.jsx("div",{ref:t})]})]}),e.jsxs("div",{className:`flex-shrink-0 border-t safe-area-inset-bottom ${r?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}`,children:[w&&e.jsxs("div",{className:`flex items-center gap-2 px-4 pt-2 text-sm ${r?"text-slate-400":"text-gray-500"}`,children:[e.jsx(te,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Replying to comment"}),e.jsx("button",{type:"button",onClick:()=>C(null),className:"text-blue-500 hover:underline ml-auto",children:"Cancel"})]}),e.jsx("form",{onSubmit:m,className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>{D("video"),y(!0)},className:`p-2.5 rounded-full transition-colors ${r?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-500"}`,title:"Record video",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:()=>{D("audio"),y(!0)},className:`p-2.5 rounded-full transition-colors ${r?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-500"}`,title:"Record audio",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:N,value:v,onChange:l=>$(l.target.value),onFocus:()=>S(!0),onBlur:()=>S(!1),onKeyDown:l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),m(l))},placeholder:w?"Write a reply...":"Write a comment...",rows:1,style:{minHeight:"44px",maxHeight:"120px",resize:"none"},className:`w-full px-4 py-3 border rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-base leading-snug ${r?"border-slate-600 bg-slate-900 text-white placeholder-slate-400":"border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400"}`})}),e.jsx("button",{type:"submit",disabled:!v.trim()||I,className:"flex-shrink-0 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(le,{className:"w-5 h-5"})})]})})]})]}),e.jsx(re,{isOpen:A,onClose:()=>y(!1),onMediaCaptured:z,mode:T})]}):null}function ne({comment:a,onReply:f,isDark:h}){return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[a.user.avatar?e.jsx("img",{src:a.user.avatar,alt:"",className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold",children:a.user.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`rounded-lg px-3 py-2 ${h?"bg-slate-700":"bg-gray-100"}`,children:[e.jsx("p",{className:`text-sm font-semibold ${h?"text-white":"text-gray-900"}`,children:a.user.name}),e.jsx("p",{className:`text-sm ${h?"text-slate-200":"text-gray-800"}`,children:a.content})]}),e.jsxs("div",{className:`flex items-center gap-4 mt-1 text-xs ${h?"text-slate-400":"text-gray-500"}`,children:[e.jsx("span",{children:q(new Date(a.createdAt),{addSuffix:!0})}),e.jsx("button",{onClick:()=>f(a.id),className:"hover:text-blue-500",children:"Reply"})]})]})]}),a.replies&&a.replies.length>0&&e.jsx("div",{className:"ml-11 space-y-3",children:a.replies.map(c=>e.jsxs("div",{className:"flex gap-3",children:[c.user.avatar?e.jsx("img",{src:c.user.avatar,alt:"",className:"w-6 h-6 rounded-full"}):e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center text-white text-xs font-bold",children:c.user.name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`rounded-lg px-3 py-2 ${h?"bg-slate-700":"bg-gray-100"}`,children:[e.jsx("p",{className:`text-sm font-semibold ${h?"text-white":"text-gray-900"}`,children:c.user.name}),e.jsx("p",{className:`text-sm ${h?"text-slate-200":"text-gray-800"}`,children:c.content})]}),e.jsx("div",{className:`text-xs mt-1 ${h?"text-slate-400":"text-gray-500"}`,children:q(new Date(c.createdAt),{addSuffix:!0})})]})]},c.id))})]})}export{he as C,de as P};
