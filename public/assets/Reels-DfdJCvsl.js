import{d as U,r as l,j as e,L as o}from"./vendor-react-D2QycniR.js";import{u as A,aa as D,ch as j,z as g,C,v as V,j as R,ad as X,J as B,K as J,L as K,a5 as Y,a6 as q,a3 as G,a4 as O}from"./index-4Xu9g3kZ.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";function te(){const{resolvedTheme:S}=A(),m=S==="dark",[F]=U(),x=F.get("reel"),{user:L}=D(),[r,f]=l.useState([]),[i,w]=l.useState(0),[p,T]=l.useState(!0),[b,I]=l.useState(!0),[d,P]=l.useState(!0),[N,$]=l.useState(1),[y,E]=l.useState(!0),n=l.useRef(null),k=l.useRef([]),u=l.useCallback(async t=>{var a;try{const c=((a=(await j.getReels(t,10)).data)==null?void 0:a.reels)||[];if(t===1){if(f(c),x){const h=c.findIndex(H=>H.id===x);h>=0&&w(h)}}else f(h=>[...h,...c]);E(c.length===10)}catch(s){console.error("Error loading reels:",s),g.error("Failed to load reels")}finally{T(!1)}},[x]);l.useEffect(()=>{u(1)},[u]),l.useEffect(()=>{k.current.forEach((t,a)=>{t&&(a===i?(t.currentTime=0,d&&t.play().catch(()=>{})):t.pause())})},[i,d]);const M=l.useCallback(()=>{if(!n.current)return;const t=n.current.scrollTop,a=n.current.clientHeight,s=Math.round(t/a);s!==i&&s>=0&&s<r.length&&(w(s),s>=r.length-3&&y&&!p&&($(c=>c+1),u(N+1)))},[i,r.length,y,p,N,u]),z=async t=>{if(!L){g.error("Please log in to like");return}try{t.isLiked?await j.unlikeReel(t.id):await j.likeReel(t.id),f(a=>a.map(s=>s.id===t.id?{...s,isLiked:!s.isLiked,likesCount:s.likesCount+(s.isLiked?-1:1)}:s))}catch{g.error("Failed to update like")}},v=t=>{if(!n.current)return;const a=n.current.clientHeight,s=t==="up"?i-1:i+1;s>=0&&s<r.length&&n.current.scrollTo({top:s*a,behavior:"smooth"})};return r[i],p&&r.length===0?e.jsx("div",{className:`min-h-screen flex items-center justify-center ${m?"bg-slate-900":"bg-gray-50"}`,children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-pink-500 border-t-transparent rounded-full"})}):r.length===0?e.jsxs("div",{className:`min-h-screen flex flex-col items-center justify-center ${m?"bg-slate-900 text-white":"bg-gray-50 text-gray-900"}`,children:[e.jsx(C,{className:"w-16 h-16 text-slate-500 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"No Reels Yet"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Be the first to create a reel!"}),e.jsx(o,{to:"/reels/create",className:"px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full font-medium",children:"Create Reel"})]}):e.jsxs("div",{className:`fixed inset-0 z-50 ${m?"bg-black":"bg-gray-900"}`,children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 z-50 flex items-center justify-between",children:[e.jsx(o,{to:"/timeline",className:"p-2 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(V,{className:"w-6 h-6"})}),e.jsxs(o,{to:"/reels/create",className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full font-medium text-sm hover:opacity-90",children:[e.jsx(R,{className:"w-4 h-4"})," Create"]})]}),e.jsx("div",{ref:n,onScroll:M,className:"h-full overflow-y-scroll snap-y snap-mandatory scrollbar-hide",style:{scrollSnapType:"y mandatory"},children:r.map((t,a)=>e.jsxs("div",{className:"h-full w-full snap-start relative flex items-center justify-center",children:[e.jsx("video",{ref:s=>k.current[a]=s,src:t.videoUrl,poster:t.thumbnailUrl,loop:!0,muted:b,playsInline:!0,onClick:()=>P(!d),className:"h-full w-full object-contain max-w-[500px] mx-auto"}),!d&&a===i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-20 h-20 bg-black/50 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"w-10 h-10 text-white ml-1"})})}),e.jsxs("div",{className:"absolute right-4 bottom-24 flex flex-col items-center gap-6",children:[e.jsxs(o,{to:`/u/${t.user.id}`,className:"relative",children:[t.user.avatar?e.jsx("img",{src:t.user.avatar,alt:t.user.name,className:"w-12 h-12 rounded-full border-2 border-white"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center border-2 border-white",children:e.jsx(X,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-5 h-5 bg-pink-500 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"w-3 h-3 text-white"})})]}),e.jsxs("button",{onClick:()=>z(t),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${t.isLiked?"bg-pink-500":"bg-white/20"}`,children:e.jsx(B,{className:`w-6 h-6 ${t.isLiked?"text-white fill-current":"text-white"}`})}),e.jsx("span",{className:"text-white text-xs font-medium",children:t.likesCount})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(J,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-white text-xs font-medium",children:t.commentsCount})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(K,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-white text-xs font-medium",children:"Share"})]})]}),e.jsxs("div",{className:"absolute left-4 right-20 bottom-8",children:[e.jsxs(o,{to:`/u/${t.user.id}`,className:"font-semibold text-white mb-1 hover:underline",children:["@",t.user.name]}),t.caption&&e.jsx("p",{className:"text-white/90 text-sm line-clamp-2",children:t.caption})]})]},t.id))}),e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>v("up"),disabled:i===0,className:"p-2 bg-white/20 rounded-full text-white disabled:opacity-30",children:e.jsx(Y,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>v("down"),disabled:i===r.length-1,className:"p-2 bg-white/20 rounded-full text-white disabled:opacity-30",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsx("button",{onClick:()=>I(!b),className:"absolute top-4 right-4 p-3 bg-black/50 rounded-full text-white",children:b?e.jsx(G,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})})]})}export{te as default};
