import{r as l,j as s,L as g}from"./vendor-react-D2QycniR.js";import{u as O,aa as G,cf as x,z as o,b as L,cp as K,ay as q,J as B,K as Q,L as V,d as W,aH as P}from"./index-JNkgy8O1.js";import{P as X,C as Y}from"./CommentModal-B9WxGiBB.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";import"./MobileMediaRecorder-9ETYe9lu.js";function le(){const{resolvedTheme:Z}=O(),{user:_}=G(),[n,b]=l.useState("following"),[y,d]=l.useState([]),[w,j]=l.useState([]),[N,p]=l.useState(!0),[v,k]=l.useState(!1),[C,S]=l.useState(1),[$,A]=l.useState(!0),[h,F]=l.useState(null),[u,M]=l.useState(null),f=l.useCallback(async(e=!1)=>{try{e?(p(!0),S(1)):k(!0);const a=e?1:C,r=await(n==="following"?x.getFeed:x.getDiscover)(a,20);console.log("Loaded posts:",r.data.data.map(i=>{var c,m;return{id:i.id,content:(c=i.content)==null?void 0:c.substring(0,30),mediaCount:((m=i.media)==null?void 0:m.length)||0,media:i.media}})),d(e?r.data.data:i=>[...i,...r.data.data]),A(r.data.meta.hasMore)}catch(a){console.error("Error loading feed:",a),o.error("Failed to load feed")}finally{p(!1),k(!1)}},[n,C]),T=async()=>{try{const e=await P.getSuggestedUsers(5);j(e.data)}catch(e){console.error("Error loading suggested users:",e)}};l.useEffect(()=>{f(!0),T()},[n]);const U=()=>{S(e=>e+1),f(!1)},D=async e=>{try{await P.followUser(e),j(a=>a.filter(t=>t.id!==e)),o.success("Now following user")}catch{o.error("Failed to follow user")}},E=async e=>{try{await x.likePost(e),d(a=>a.map(t=>t.id===e?{...t,likesCount:t.likesCount+1,isLiked:!0}:t))}catch{try{await x.unlikePost(e),d(t=>t.map(r=>r.id===e?{...r,likesCount:Math.max(0,r.likesCount-1),isLiked:!1}:r))}catch{o.error("Failed to update like")}}},H=e=>{F(e)},R=e=>{d(a=>a.map(t=>t.id===e?{...t,commentsCount:(t.commentsCount||0)+1}:t))},z=async e=>{var a,t;try{M(e),await x.sharePost(e),d(r=>r.map(i=>i.id===e?{...i,sharesCount:(i.sharesCount||0)+1}:i)),o.success("Post shared to your timeline!")}catch(r){console.error("Share error:",r);const i=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to share post";o.error(i)}finally{M(null)}},J=e=>{const a=new Date(e),r=new Date().getTime()-a.getTime(),i=Math.floor(r/6e4),c=Math.floor(r/36e5),m=Math.floor(r/864e5);return i<1?"Just now":i<60?`${i}m ago`:c<24?`${c}h ago`:m<7?`${m}d ago`:a.toLocaleDateString()};return s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800",children:[s.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Activity Feed"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Stay updated with your network's activities"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-6",children:s.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("button",{onClick:()=>b("following"),className:`flex-1 flex items-center justify-center gap-2 px-6 py-4 text-sm font-medium transition-colors ${n==="following"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[s.jsx(L,{className:"w-4 h-4"}),"Following"]}),s.jsxs("button",{onClick:()=>b("discover"),className:`flex-1 flex items-center justify-center gap-2 px-6 py-4 text-sm font-medium transition-colors ${n==="discover"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[s.jsx(K,{className:"w-4 h-4"}),"Discover"]})]})}),s.jsx("div",{className:"flex items-center justify-end mb-4",children:s.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:text-blue-700",children:[s.jsx(q,{className:`w-4 h-4 ${N?"animate-spin":""}`}),"Refresh"]})}),N?s.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 animate-pulse",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:"w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),s.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})]})},e))}):y.length===0?s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-12 text-center",children:[s.jsx(L,{className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:n==="following"?"No posts yet":"Nothing to discover"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n==="following"?"Follow more users to see their posts here":"Check back later for trending content"})]}):s.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[y.map(e=>{var a;return s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl p-3 sm:p-6 shadow-sm hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-start gap-2.5 sm:gap-4",children:[s.jsx(g,{to:`/profile/${e.user.username||e.user.id}`,className:"flex-shrink-0",children:e.user.avatar?s.jsx("img",{src:e.user.avatar,alt:e.user.name,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm sm:text-base",children:((a=e.user.name)==null?void 0:a.charAt(0))||"?"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 mb-1 flex-wrap",children:[s.jsx(g,{to:`/profile/${e.user.username||e.user.id}`,className:"font-medium text-sm sm:text-base text-gray-900 dark:text-white hover:text-blue-600 truncate max-w-[150px] sm:max-w-none",children:e.user.name}),s.jsx("span",{className:"text-gray-400 dark:text-gray-500 hidden sm:inline",children:"â€¢"}),s.jsx("span",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:J(e.createdAt)})]}),s.jsx("p",{className:"text-sm sm:text-base text-gray-900 dark:text-white whitespace-pre-wrap mb-2 sm:mb-3",children:e.content}),e.media&&e.media.length>0&&s.jsx("div",{className:"-mx-3 sm:mx-0 mb-2 sm:mb-3",children:s.jsx(X,{media:e.media.map(t=>({id:t.id,type:t.type,url:t.url,thumbnail:t.thumbnail,altText:t.altText,width:t.width,height:t.height,duration:t.duration})),className:"sm:rounded-xl",immersive:!0})}),s.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 pt-2 sm:pt-3 border-t border-gray-200 dark:border-gray-700",children:[s.jsxs("button",{onClick:()=>E(e.id),className:`flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm transition ${e.isLiked?"text-red-500":"text-gray-500 hover:text-red-500"}`,children:[s.jsx(B,{className:`w-4 h-4 sm:w-4 sm:h-4 ${e.isLiked?"fill-current":""}`}),s.jsx("span",{children:e.likesCount||0})]}),s.jsxs("button",{onClick:()=>H(e.id),className:"flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm text-gray-500 hover:text-blue-500 transition",children:[s.jsx(Q,{className:"w-4 h-4 sm:w-4 sm:h-4"}),s.jsx("span",{children:e.commentsCount||0})]}),s.jsxs("button",{onClick:()=>z(e.id),disabled:u===e.id,className:"flex items-center gap-1 sm:gap-1.5 text-xs sm:text-sm text-gray-500 hover:text-blue-500 transition disabled:opacity-50 ml-auto sm:ml-0",children:[s.jsx(V,{className:`w-4 h-4 sm:w-4 sm:h-4 ${u===e.id?"animate-spin":""}`}),s.jsx("span",{className:"hidden sm:inline",children:u===e.id?"Sharing...":"Share"})]})]})]})]})},e.id)}),$&&s.jsx("button",{onClick:U,disabled:v,className:"w-full py-3 text-center text-blue-600 hover:text-blue-700 font-medium",children:v?"Loading...":"Load more"})]})]}),s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[s.jsx(W,{className:"w-4 h-4 text-blue-500"}),"Suggested for you"]})}),w.length===0?s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No suggestions available"}):s.jsx("div",{className:"space-y-4",children:w.map(e=>{var a;return s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(g,{to:`/profile/${e.username||e.id}`,children:e.avatar?s.jsx("img",{src:e.avatar,alt:e.name,className:"w-10 h-10 rounded-full object-cover"}):s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center text-white font-bold text-sm",children:((a=e.name)==null?void 0:a.charAt(0))||"?"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx(g,{to:`/profile/${e.username||e.id}`,className:"font-medium text-sm text-gray-900 dark:text-white hover:text-blue-600 truncate block",children:e.name}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:e.headline||`${e.followersCount} followers`})]}),s.jsx("button",{onClick:()=>D(e.id),className:"px-3 py-1 text-xs font-medium text-blue-600 border border-blue-600 rounded-full hover:bg-blue-50 dark:hover:bg-blue-900/20",children:"Follow"})]},e.id)})})]})})]})]}),h&&s.jsx(Y,{postId:h,isOpen:!!h,onClose:()=>F(null),onCommentAdded:()=>R(h)})]})}export{le as default};
