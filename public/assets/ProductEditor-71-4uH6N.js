import{h as X,a as $,r as c,j as e}from"./vendor-react-D2QycniR.js";import{c0 as U,b$ as y,aM as _,I as q,v as G,j as H,f as K}from"./index-JNkgy8O1.js";import{M as Y}from"./MediaPickerModal-ZxCpEfPe.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";const W=["XS","S","M","L","XL","XXL","XXXL"],Z=[{name:"Black",code:"#000000"},{name:"White",code:"#FFFFFF"},{name:"Navy",code:"#1E3A5F"},{name:"Red",code:"#DC2626"},{name:"Blue",code:"#2563EB"},{name:"Green",code:"#16A34A"},{name:"Gray",code:"#6B7280"},{name:"Pink",code:"#EC4899"},{name:"Purple",code:"#9333EA"},{name:"Orange",code:"#EA580C"},{name:"Yellow",code:"#EAB308"},{name:"Brown",code:"#92400E"}];function oe(){const{id:p}=X(),k=$(),h=!p,[I,w]=c.useState(!!p),[C,S]=c.useState(!1),[F,D]=c.useState([]),[E,j]=c.useState(!1),[u,P]=c.useState(!1),[n,A]=c.useState([]),[d,v]=c.useState([]),[m,b]=c.useState([]),[J,Q]=c.useState(null),[x,N]=c.useState({name:"",code:"#000000"}),[s,i]=c.useState({name:"",description:"",shortDescription:"",sku:"",price:"",salePrice:"",costPrice:"",stock:"0",lowStockThreshold:"5",status:"DRAFT",type:"PHYSICAL",categoryId:"",images:[],tags:""});c.useEffect(()=>{V(),!h&&p&&T(p)},[p]);const V=async()=>{try{const{data:t}=await U.getAll();D(t)}catch(t){console.error("Failed to load categories:",t)}},T=async t=>{var l;try{w(!0);const{data:a}=await y.getById(t);i({name:a.name,description:a.description||"",shortDescription:a.shortDescription||"",sku:a.sku||"",price:String(a.price),salePrice:a.salePrice?String(a.salePrice):"",costPrice:a.costPrice?String(a.costPrice):"",stock:String(a.stock),lowStockThreshold:String(a.lowStockThreshold),status:a.status,type:a.type,categoryId:a.categoryId||"",images:Array.isArray(a.images)?a.images:[],tags:((l=a.tags)==null?void 0:l.map(r=>r.name).join(", "))||""}),P(a.hasVariants||!1),a.variantOptions&&(A(a.variantOptions.sizes||[]),v(a.variantOptions.colors||[])),a.variants&&a.variants.length>0&&b(a.variants.map(r=>({id:r.id,name:r.name,sku:r.sku||"",size:r.size||"",color:r.color||"",colorCode:r.colorCode||"",price:r.price?String(r.price):"",stock:String(r.stock),isActive:r.isActive})))}catch(a){console.error("Failed to load product:",a)}finally{w(!1)}},z=()=>{const t=[];n.length===0&&d.length===0||(d.length===0?n.forEach(l=>{t.push({name:l,sku:"",size:l,color:"",colorCode:"",price:s.price,stock:"0",isActive:!0})}):n.length===0?d.forEach(l=>{t.push({name:l.name,sku:"",size:"",color:l.name,colorCode:l.code,price:s.price,stock:"0",isActive:!0})}):n.forEach(l=>{d.forEach(a=>{t.push({name:`${l} / ${a.name}`,sku:"",size:l,color:a.name,colorCode:a.code,price:s.price,stock:"0",isActive:!0})})}),b(t))},O=t=>{A(l=>l.includes(t)?l.filter(a=>a!==t):[...l,t])},L=t=>{v(l=>l.some(a=>a.code===t.code)?l.filter(a=>a.code!==t.code):[...l,t])},M=()=>{x.name&&x.code&&(v(t=>[...t,{...x}]),N({name:"",code:"#000000"}))},g=(t,l,a)=>{b(r=>r.map((o,f)=>f===t?{...o,[l]:a}:o))},B=t=>{b(l=>l.filter((a,r)=>r!==t))},R=async t=>{var l,a;if(t.preventDefault(),!s.name.trim()){alert("Product name is required");return}if(!s.price||isNaN(parseFloat(s.price))){alert("Valid price is required");return}try{S(!0);const r={name:s.name,description:s.description||void 0,shortDescription:s.shortDescription||void 0,sku:s.sku||void 0,price:parseFloat(s.price),salePrice:s.salePrice?parseFloat(s.salePrice):void 0,costPrice:s.costPrice?parseFloat(s.costPrice):void 0,stock:parseInt(s.stock)||0,lowStockThreshold:parseInt(s.lowStockThreshold)||5,status:s.status,type:s.type,images:s.images.length>0?s.images:void 0,featuredImage:s.images.length>0?s.images[0]:void 0,hasVariants:u,variantOptions:u?{sizes:n,colors:d}:void 0,variants:u&&m.length>0?m.map((o,f)=>({name:o.name,sku:o.sku||void 0,size:o.size||void 0,color:o.color||void 0,colorCode:o.colorCode||void 0,price:o.price?parseFloat(o.price):void 0,stock:parseInt(o.stock)||0,isActive:o.isActive,isDefault:f===0,sortOrder:f,options:{size:o.size,color:o.color,colorCode:o.colorCode}})):void 0};s.categoryId&&s.categoryId.trim()!==""&&(r.categoryId=s.categoryId),h?await y.create(r):await y.update(p,r),k("/shop/products")}catch(r){console.error("Failed to save product:",r);const o=((a=(l=r.response)==null?void 0:l.data)==null?void 0:a.message)||r.message||"Unknown error";alert(`Failed to save product: ${Array.isArray(o)?o.join(", "):o}`)}finally{S(!1)}};return I?e.jsx("div",{className:"p-6 flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-slate-700 border-t-blue-500"})}):e.jsxs("div",{className:"p-6 max-w-4xl",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent mb-6",children:h?"Add Product":"Edit Product"}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Product Name *"}),e.jsx("input",{type:"text",value:s.name,onChange:t=>i({...s,name:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Short Description"}),e.jsx("input",{type:"text",value:s.shortDescription,onChange:t=>i({...s,shortDescription:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:t=>i({...s,description:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 h-32 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Price *"}),e.jsx("input",{type:"number",step:"0.01",value:s.price,onChange:t=>i({...s,price:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Sale Price"}),e.jsx("input",{type:"number",step:"0.01",value:s.salePrice,onChange:t=>i({...s,salePrice:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Cost Price"}),e.jsx("input",{type:"number",step:"0.01",value:s.costPrice,onChange:t=>i({...s,costPrice:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4",children:["Inventory ",u&&m.length>0&&e.jsx("span",{className:"text-sm text-slate-400 font-normal",children:"(managed per variant below)"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:s.sku,onChange:t=>i({...s,sku:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:u&&m.length>0?"Base SKU (variants have own SKUs)":""})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:["Stock ",u&&m.length>0&&"(base)"]}),e.jsx("input",{type:"number",value:s.stock,onChange:t=>i({...s,stock:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",value:s.lowStockThreshold,onChange:t=>i({...s,lowStockThreshold:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"text-blue-400",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Product Variants"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:t=>P(t.target.checked),className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500/50"}),e.jsx("span",{className:"text-sm text-slate-300",children:"This product has size/color variants"})]})]}),u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Available Sizes"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:W.map(t=>e.jsx("button",{type:"button",onClick:()=>O(t),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${n.includes(t)?"bg-blue-600 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-600/50"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Available Colors"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Z.map(t=>e.jsxs("button",{type:"button",onClick:()=>L(t),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors ${d.some(l=>l.code===t.code)?"ring-2 ring-blue-500 bg-slate-700":"bg-slate-700/50 hover:bg-slate-600/50"}`,children:[e.jsx("span",{className:"w-4 h-4 rounded-full border border-slate-500",style:{backgroundColor:t.code}}),e.jsx("span",{className:"text-slate-300",children:t.name})]},t.code))}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"text",placeholder:"Custom color name",value:x.name,onChange:t=>N({...x,name:t.target.value}),className:"bg-slate-700/50 border border-slate-600/50 rounded-lg px-3 py-1.5 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"}),e.jsx("input",{type:"color",value:x.code,onChange:t=>N({...x,code:t.target.value}),className:"w-10 h-8 rounded cursor-pointer"}),e.jsx("button",{type:"button",onClick:M,className:"px-3 py-1.5 bg-slate-700/50 text-slate-300 rounded-lg text-sm hover:bg-slate-600/50",children:"Add"})]})]}),(n.length>0||d.length>0)&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/30 rounded-lg",children:[e.jsxs("div",{className:"text-sm text-slate-400",children:[n.length," sizes Ã— ",d.length||1," colors = "," ",e.jsxs("span",{className:"text-white font-medium",children:[Math.max(1,n.length)*Math.max(1,d.length)," variants"]})]}),e.jsx("button",{type:"button",onClick:z,className:"px-4 py-1.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors",children:"Generate Variants"})]}),m.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left py-2 px-2 text-slate-400 font-medium",children:"Variant"}),e.jsx("th",{className:"text-left py-2 px-2 text-slate-400 font-medium",children:"SKU"}),e.jsx("th",{className:"text-left py-2 px-2 text-slate-400 font-medium",children:"Price"}),e.jsx("th",{className:"text-left py-2 px-2 text-slate-400 font-medium",children:"Stock"}),e.jsx("th",{className:"text-center py-2 px-2 text-slate-400 font-medium",children:"Active"}),e.jsx("th",{className:"text-right py-2 px-2 text-slate-400 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:m.map((t,l)=>e.jsxs("tr",{className:"border-b border-slate-700/50",children:[e.jsx("td",{className:"py-2 px-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.colorCode&&e.jsx("span",{className:"w-4 h-4 rounded-full border border-slate-500",style:{backgroundColor:t.colorCode}}),e.jsx("span",{className:"text-white",children:t.name})]})}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("input",{type:"text",value:t.sku,onChange:a=>g(l,"sku",a.target.value),placeholder:"Auto",className:"w-24 bg-slate-700/50 border border-slate-600/50 rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500/50"})}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("input",{type:"number",step:"0.01",value:t.price,onChange:a=>g(l,"price",a.target.value),placeholder:s.price,className:"w-20 bg-slate-700/50 border border-slate-600/50 rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500/50"})}),e.jsx("td",{className:"py-2 px-2",children:e.jsx("input",{type:"number",value:t.stock,onChange:a=>g(l,"stock",a.target.value),className:"w-16 bg-slate-700/50 border border-slate-600/50 rounded px-2 py-1 text-white text-sm focus:outline-none focus:ring-1 focus:ring-blue-500/50"})}),e.jsx("td",{className:"py-2 px-2 text-center",children:e.jsx("input",{type:"checkbox",checked:t.isActive,onChange:a=>g(l,"isActive",a.target.checked),className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-blue-500"})}),e.jsx("td",{className:"py-2 px-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>B(l),className:"p-1 text-red-400 hover:text-red-300",children:e.jsx(q,{size:16})})})]},l))})]})})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Organization"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Category"}),e.jsxs("select",{value:s.categoryId,onChange:t=>i({...s,categoryId:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"",children:"No Category"}),F.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Product Type"}),e.jsxs("select",{value:s.type,onChange:t=>i({...s,type:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"PHYSICAL",children:"Physical"}),e.jsx("option",{value:"DIGITAL",children:"Digital"}),e.jsx("option",{value:"SERVICE",children:"Service"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1",children:"Status"}),e.jsxs("select",{value:s.status,onChange:t=>i({...s,status:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"DRAFT",children:"Draft"}),e.jsx("option",{value:"ACTIVE",children:"Active"}),e.jsx("option",{value:"ARCHIVED",children:"Archived"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-1",children:"Product Images"}),e.jsxs("p",{className:"text-xs text-slate-500 mb-4",children:["ðŸ“ Recommended size: ",e.jsx("span",{className:"text-blue-400 font-medium",children:"800 Ã— 600 px"})," (4:3 aspect ratio)"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-4",children:[s.images.map((t,l)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Product image ${l+1}`,className:"w-full h-32 object-cover rounded-xl border border-slate-600/50"}),e.jsx("button",{type:"button",onClick:()=>{const a=s.images.filter((r,o)=>o!==l);i({...s,images:a})},className:"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(G,{size:14})}),l===0&&e.jsx("span",{className:"absolute bottom-1 left-1 bg-blue-600 text-white text-xs px-2 py-0.5 rounded-lg",children:"Main"})]},l)),e.jsxs("button",{type:"button",onClick:()=>j(!0),className:"w-full h-32 border-2 border-dashed border-slate-600/50 rounded-xl flex flex-col items-center justify-center text-slate-400 hover:border-blue-500 hover:text-blue-400 transition-colors",children:[e.jsx(H,{size:24}),e.jsx("span",{className:"text-sm mt-1",children:"Add Image"}),e.jsx("span",{className:"text-xs opacity-75",children:"800 Ã— 600 px"})]})]}),e.jsxs("p",{className:"text-sm text-slate-500",children:[e.jsx(K,{className:"inline mr-1"}),"First image is the main product image. Drag to reorder (coming soon)."]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",disabled:C,className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 py-2 rounded-xl hover:from-blue-700 hover:to-blue-600 disabled:opacity-50 transition-colors shadow-lg shadow-blue-500/20",children:C?"Saving...":h?"Create Product":"Update Product"}),e.jsx("button",{type:"button",onClick:()=>k("/shop/products"),className:"border border-slate-600/50 text-slate-300 px-6 py-2 rounded-xl hover:bg-slate-700/50 transition-colors",children:"Cancel"})]})]}),E&&e.jsx(Y,{type:"image",onSelect:t=>{i({...s,images:[...s.images,t.path]}),j(!1)},onClose:()=>j(!1)})]})}export{oe as default};
