import{h as V,a as R,r as n,j as e,L as u}from"./vendor-react-D2QycniR.js";import{ce as f,v as q,a9 as A,C as B,F as L,k as D,V as z,a7 as Z,a8 as _,bA as G,z as H}from"./index-JNkgy8O1.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";function ee(){var v,y,N;const{courseId:i,lessonId:c}=V();R();const $=n.useRef(null),[a,I]=n.useState(null),[r,T]=n.useState(null),[l,P]=n.useState(null),[S,E]=n.useState(!0),g=n.useRef(0),[h,b]=n.useState(!1);n.useEffect(()=>{j()},[i]),n.useEffect(()=>{c&&d(c)},[c]);const j=async()=>{var s;try{const{data:t}=await f.getCourseForLearning(i);I(t.course),T(t.progress),!c&&t.progress.nextLesson?d(t.progress.nextLesson.id):!c&&((s=t.course.lessons)==null?void 0:s.length)>0&&d(t.course.lessons[0].id)}catch(t){console.error("Failed to load course:",t)}finally{E(!1)}},d=async s=>{try{const{data:t}=await f.getLesson(i,s);P(t.lesson)}catch(t){console.error("Failed to load lesson:",t)}},w=async()=>{if(l)try{await f.markLessonComplete(i,l.id),H.success("Lesson completed!"),j()}catch(s){console.error("Failed to mark complete:",s)}},O=s=>{const t=s.currentTarget,o=t.currentTime/t.duration*100;t.currentTime-g.current>=10&&(g.current=t.currentTime,f.updateProgress(i,l.id,{videoWatchedSeconds:Math.floor(t.currentTime)}).catch(console.error)),o>=90&&!x(l.id)&&w()},x=s=>{var t;return((t=r==null?void 0:r.lessons.find(o=>o.id===s))==null?void 0:t.completed)||!1},m=()=>{var s;return((s=a==null?void 0:a.lessons)==null?void 0:s.findIndex(t=>t.id===(l==null?void 0:l.id)))??-1},Q=()=>{const s=m();s>=0&&s<a.lessons.length-1&&d(a.lessons[s+1].id)},M=()=>{const s=m();s>0&&d(a.lessons[s-1].id)},U=s=>{var C,F;if(!s)return null;const{provider:t,url:o,playbackId:k}=s;if(t==="YOUTUBE"){const p=((C=o.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/))==null?void 0:C[1])||k;return e.jsx("iframe",{src:`https://www.youtube.com/embed/${p}`,className:"w-full h-full rounded-lg",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}if(t==="VIMEO"){const p=((F=o.match(/vimeo\.com\/(\d+)/))==null?void 0:F[1])||k;return e.jsx("iframe",{src:`https://player.vimeo.com/video/${p}`,className:"w-full h-full rounded-lg",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})}return e.jsx("video",{ref:$,src:o,controls:!0,className:"w-full h-full rounded-lg",onTimeUpdate:O})};return S?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-blue-500"})}):a?e.jsxs("div",{className:"min-h-screen bg-slate-900 flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:hidden flex items-center justify-between p-4 bg-slate-800 border-b border-slate-700/50",children:[e.jsx(u,{to:`/lms/course/${a.slug}`,className:"text-blue-400 text-sm hover:text-blue-300 transition-colors",children:"← Back"}),e.jsx("h2",{className:"font-bold text-sm text-white truncate flex-1 mx-4 text-center",children:a.title}),e.jsx("button",{onClick:()=>b(!h),className:"p-2 rounded-lg bg-slate-700 text-white hover:bg-slate-600 transition-colors","aria-label":"Toggle lessons menu",children:h?e.jsx(q,{size:20}):e.jsx(A,{size:20})})]}),h&&e.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/50 z-40",onClick:()=>b(!1)}),e.jsxs("aside",{className:`
        fixed lg:static inset-y-0 left-0 z-50
        w-80 max-w-[85vw] bg-slate-800 border-r border-slate-700/50 flex flex-col
        transform transition-transform duration-300 ease-in-out
        ${h?"translate-x-0":"-translate-x-full lg:translate-x-0"}
      `,children:[e.jsxs("div",{className:"p-4 border-b border-slate-700/50 hidden lg:block",children:[e.jsx(u,{to:`/lms/course/${a.slug}`,className:"text-blue-400 text-sm hover:text-blue-300 transition-colors",children:"← Back to Course"}),e.jsx("h2",{className:"font-bold text-lg mt-2 text-white",children:a.title}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-400 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[(r==null?void 0:r.percentComplete)||0,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${(r==null?void 0:r.percentComplete)||0}%`}})})]})]}),e.jsxs("div",{className:"p-4 border-b border-slate-700/50 lg:hidden",children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-400 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[(r==null?void 0:r.percentComplete)||0,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${(r==null?void 0:r.percentComplete)||0}%`}})})]}),e.jsxs("nav",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-700/50",children:"Lessons"}),(v=a.lessons)==null?void 0:v.map((s,t)=>e.jsxs("button",{onClick:()=>{d(s.id),b(!1)},className:`w-full text-left px-4 py-3 border-b border-slate-700/50 flex items-center gap-3 hover:bg-slate-700/50 transition-colors min-h-[48px] ${(l==null?void 0:l.id)===s.id?"bg-blue-500/10 border-l-4 border-l-blue-500":""}`,children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${x(s.id)?"bg-green-500 text-white":"bg-slate-700 text-slate-400"}`,children:x(s.id)?"✓":t+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate text-white",children:s.title}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.type," • ",s.estimatedMinutes||0," min"]})]})]},s.id)),(r==null?void 0:r.requiredQuizzes)&&r.requiredQuizzes.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-700/50 mt-2",children:"Required Quizzes"}),r.requiredQuizzes.map(s=>e.jsxs(u,{to:`/lms/quiz/${i}/${s.id}`,className:"w-full text-left px-4 py-3 border-b border-slate-700/50 flex items-center gap-3 hover:bg-slate-700/50 transition-colors block",children:[e.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${s.passed?"bg-green-500 text-white":"bg-orange-500 text-white"}`,children:s.passed?"✓":"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate text-white",children:s.title}),e.jsx("div",{className:"text-xs text-slate-500",children:s.passed?"Passed":"Not completed"})]})]},s.id))]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:l?e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`p-2 rounded-xl flex-shrink-0 ${l.type==="VIDEO"?"bg-purple-500/20 text-purple-400":l.type==="QUIZ"?"bg-orange-500/20 text-orange-400":"bg-blue-500/20 text-blue-400"}`,children:l.type==="VIDEO"?e.jsx(B,{}):l.type==="QUIZ"?e.jsx(L,{}):e.jsx(D,{})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white truncate",children:l.title}),e.jsxs("p",{className:"text-sm text-slate-400",children:["Lesson ",m()+1," of ",((y=a.lessons)==null?void 0:y.length)||0]})]})]}),x(l.id)&&e.jsxs("span",{className:"flex items-center gap-1 text-green-400 bg-green-500/20 px-3 py-1 rounded-full text-sm self-start sm:self-auto",children:[e.jsx(z,{})," Completed"]})]}),l.type==="VIDEO"&&l.videoAsset&&e.jsx("div",{className:"aspect-video bg-black rounded-xl mb-6 overflow-hidden",children:U(l.videoAsset)}),l.type==="QUIZ"&&l.quiz&&e.jsxs("div",{className:"bg-orange-500/10 border border-orange-500/30 rounded-xl p-6 mb-6 text-center",children:[e.jsx(L,{className:"text-4xl text-orange-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:l.quiz.title}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Test your knowledge with this quiz"}),e.jsx(u,{to:`/lms/quiz/${i}/${l.quiz.id}`,className:"inline-block bg-gradient-to-r from-orange-600 to-orange-500 text-white px-6 py-2 rounded-xl hover:from-orange-700 hover:to-orange-600 transition-colors shadow-lg shadow-orange-500/20",children:"Start Quiz"})]}),l.content&&e.jsx("div",{className:"prose prose-invert max-w-none bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-6 mb-6",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:l.content}})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3 bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4",children:[e.jsxs("div",{className:"flex justify-between sm:contents gap-2",children:[e.jsxs("button",{onClick:M,disabled:m()<=0,className:"flex items-center justify-center gap-2 px-4 py-3 sm:py-2 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-h-[48px] flex-1 sm:flex-initial",children:[e.jsx(Z,{})," ",e.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),e.jsxs("button",{onClick:Q,disabled:m()>=(((N=a.lessons)==null?void 0:N.length)||0)-1,className:"flex items-center justify-center gap-2 px-4 py-3 sm:py-2 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-h-[48px] flex-1 sm:flex-initial sm:order-last",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"})," ",e.jsx(_,{})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4",children:[!x(l.id)&&e.jsxs("button",{onClick:w,className:"flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-green-500 text-white px-6 py-3 sm:py-2 rounded-xl hover:from-green-700 hover:to-green-600 transition-colors shadow-lg shadow-green-500/20 min-h-[48px]",children:[e.jsx(z,{})," Mark Complete"]}),(r==null?void 0:r.isComplete)&&a.certificateEnabled&&e.jsxs(u,{to:`/lms/certificate/${i}`,className:"flex items-center justify-center gap-2 bg-gradient-to-r from-yellow-600 to-yellow-500 text-white px-6 py-3 sm:py-2 rounded-xl hover:from-yellow-700 hover:to-yellow-600 transition-colors shadow-lg shadow-yellow-500/20 min-h-[48px]",children:[e.jsx(G,{})," Get Certificate"]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-slate-400",children:"Select a lesson to begin"})})]}):e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center text-slate-400",children:"Course not found"})}export{ee as default};
