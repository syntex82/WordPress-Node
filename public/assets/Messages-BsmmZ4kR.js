import{r as n,j as e}from"./vendor-react-D2QycniR.js";import{aa as es,aw as ss,z as o,av as p,j as ye,ak as te,Y as ae,U as ts,ax as ke,ay as as,az as ls,B as le,I as B,N as rs,an as re,aA as is,aq as G,aB as ns,V as os,v as Z,f as ds,ar as cs,as as ms,at as xs,au as us,aC as hs,aD as Ce,aE as fs,aF as Se,aG as gs,aH as ps}from"./index-4Xu9g3kZ.js";import{l as bs}from"./vendor-socket-CA1CrNgP.js";import{E as js,a as ws,T as vs}from"./emoji-picker-react.esm-B284Vdmy.js";import{M as Ns}from"./MobileMediaRecorder-BYIeHx5f.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";const Me=["from-blue-400 to-blue-600","from-purple-400 to-purple-600","from-pink-400 to-pink-600","from-emerald-400 to-emerald-600","from-orange-400 to-orange-600","from-cyan-400 to-cyan-600","from-rose-400 to-rose-600","from-indigo-400 to-indigo-600"],P=N=>{const c=N.charCodeAt(0)%Me.length;return Me[c]};function Is(){const{token:N,user:c}=es(),[F,ie]=n.useState([]),[r,y]=n.useState(null),[O,b]=n.useState([]),[j,k]=n.useState(""),[ze,De]=n.useState(!0),[Ie,ne]=n.useState(!1),[C,q]=n.useState(!1),[m,Ue]=n.useState(null),[x,W]=n.useState(!1),[w,H]=n.useState([]),[oe,Ae]=n.useState(null),[Pe,S]=n.useState(!1),[de,Y]=n.useState(""),[ce,E]=n.useState([]),[f,v]=n.useState([]),[me,xe]=n.useState(!1),[h,K]=n.useState(null),[ue,M]=n.useState(!1),[z,R]=n.useState(null),[D,J]=n.useState(!1),[g,X]=n.useState(null),[_,he]=n.useState(!1),[fe,ge]=n.useState("default"),[pe,I]=n.useState("prompt"),[Fe,U]=n.useState(!1),[Ee,Q]=n.useState("video"),be=n.useRef(null),$=n.useRef(null),T=n.useRef(null),ee=n.useRef(null),se=n.useRef(null);n.useEffect(()=>{(async()=>{const a=hs();ge(a);const l=await Ce();I(l)})();const t=ss(a=>{console.log("Permission status changed:",a),I(a)});return()=>{t()}},[]);const Re=s=>{fe==="granted"&&"Notification"in window&&new Notification("Incoming Video Call",{body:`${s} is calling you`,icon:"/favicon.ico",tag:"incoming-call",requireInteraction:!0})},$e=async()=>{const s=await fs();ge(s),s==="granted"?o.success("Notifications enabled!"):s==="denied"&&o.error("Notifications blocked. Enable them in browser settings.")},Te=async()=>{Se();const s=await gs();if(s.granted)I("granted"),o.success("Camera & microphone enabled!"),s.stream&&s.stream.getTracks().forEach(t=>t.stop());else{I("denied");const t=s.error||`Permission denied. ${ke()}`;o.error(t,{duration:6e3})}},Ve=async()=>{Se();const s=await Ce();I(s),s==="granted"?o.success("Camera & microphone are now enabled!"):s==="prompt"&&o('Click "Enable" to grant camera & microphone access')};n.useEffect(()=>{A()},[]),n.useEffect(()=>{if(N){const s=`${window.location.protocol}//${window.location.host}/messages`,t=bs(s,{auth:{token:N},transports:["websocket","polling"],path:"/socket.io",reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4});let a=!1;return t.on("connect",()=>{console.log("Connected to messages gateway",a?"(reconnected)":""),W(!0),a&&t.emit("users:request:list"),a=!0}),t.on("disconnect",l=>{console.log("Disconnected from messages gateway:",l),W(!1),l==="io server disconnect"&&t.connect()}),t.on("connect_error",l=>{console.error("WebSocket connection error:",l.message),W(!1)}),t.on("users:online:list",l=>{console.log("Received online users list:",l.users),H(l.users)}),t.on("user:online",l=>{console.log("User came online:",l.userId),H(i=>[...new Set([...i,l.userId])])}),t.on("user:offline",l=>{console.log("User went offline:",l.userId),H(i=>i.filter(d=>d!==l.userId))}),t.on("dm:message:new",l=>{b(i=>i.find(d=>d.id===l.id)?i:[...i,l]),A(),V()}),t.on("dm:typing",l=>{(r==null?void 0:r.id)===l.conversationId&&Ae(l.isTyping?l.userName:null)}),t.on("dm:read",()=>A()),t.on("dm:message:deleted",l=>{b(i=>i.filter(d=>d.id!==l.messageId))}),t.on("call:incoming",l=>{R(i=>(i==null?void 0:i.callerId)===l.callerId?i:(o.dismiss("incoming-call"),o("Incoming video call from "+l.callerName,{icon:"ðŸ“ž",duration:1e4,id:"incoming-call"}),Re(l.callerName),l))}),t.on("call:accepted",()=>{o.success("Call accepted")}),t.on("call:rejected",l=>{o.error(l.reason||"Call declined"),M(!1)}),t.on("call:ended",()=>{o("Call ended",{icon:"ðŸ“ž"}),M(!1),R(null)}),Ue(t),()=>{t.disconnect()}}},[N]),n.useEffect(()=>{r&&(Le(r.id),m==null||m.emit("dm:read",{conversationId:r.id}))},[r==null?void 0:r.id]),n.useEffect(()=>{V()},[O]);const V=()=>{var s;return(s=be.current)==null?void 0:s.scrollIntoView({behavior:"smooth"})},A=async()=>{try{const s=await p.getConversations();ie(s.data)}catch{o.error("Failed to load conversations")}finally{De(!1)}},Le=async s=>{try{ne(!0);const t=await p.getMessages(s);b(t.data)}catch{o.error("Failed to load messages")}finally{ne(!1)}},Be=s=>{var t;k(a=>a+s.emoji),J(!1),(t=$.current)==null||t.focus()};n.useEffect(()=>{const s=t=>{se.current&&!se.current.contains(t.target)&&J(!1)};return D&&document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[D]);const Ge=async()=>{var s,t,a;if(g)try{he(!0),console.log("Deleting conversation:",g.id);const l=await p.deleteConversation(g.id);console.log("Delete response:",l),o.success("Conversation deleted"),ie(i=>i.filter(d=>d.id!==g.id)),(r==null?void 0:r.id)===g.id&&(y(null),b([]))}catch(l){console.error("Delete conversation error:",((s=l.response)==null?void 0:s.data)||l.message||l),o.error(((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete conversation")}finally{he(!1),X(null)}},je=async s=>{var l;if(s.preventDefault(),!j.trim()&&f.length===0||!r||C)return;const t=j.trim(),a=[...f];k(""),v([]),q(!0),we();try{if(m&&x){m.emit("dm:send",{conversationId:r.id,content:t,media:a.length>0?a:void 0},i=>{var d;i!=null&&i.error?(o.error(i.error),k(t),v(a)):i!=null&&i.success&&(o.success("Message sent"),V()),q(!1),(d=$.current)==null||d.focus()});return}else{const i=await p.sendMessage(r.id,t,a.length>0?a:void 0);b(d=>d.find(L=>L.id===i.data.id)?d:[...d,i.data]),A(),V(),o.success("Message sent")}}catch{o.error("Failed to send message. Please try again."),k(t),v(a)}finally{q(!1),(l=$.current)==null||l.focus()}},Ze=async s=>{const t=s.target.files;if(!t||t.length===0)return;xe(!0);const a=new FormData;Array.from(t).forEach(l=>a.append("files",l));try{const l=await p.uploadMedia(a);v(i=>[...i,...l.data.media]),o.success(`${t.length} file(s) ready to send`)}catch{o.error("Failed to upload media")}finally{xe(!1),T.current&&(T.current.value="")}},Oe=s=>{v(t=>t.filter((a,l)=>l!==s))},qe=s=>{const t={url:s.url,type:s.type==="VIDEO"?"video":"audio",filename:`${s.type.toLowerCase()}-${Date.now()}.webm`,size:0,mimeType:s.type==="VIDEO"?"video/webm":"audio/webm"};v(a=>[...a,t]),U(!1),o.success(`${s.type==="VIDEO"?"Video":"Voice message"} ready to send`)},We=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",He=()=>{!m||!x||!r||(m.emit("dm:typing:start",{conversationId:r.id}),ee.current&&clearTimeout(ee.current),ee.current=setTimeout(we,2e3))},we=()=>{!m||!x||!r||m.emit("dm:typing:stop",{conversationId:r.id})},Ye=async s=>{if(r&&confirm("Delete this message?"))try{m&&x?m.emit("dm:delete",{messageId:s,conversationId:r.id}):(await p.deleteMessage(r.id,s),b(t=>t.filter(a=>a.id!==s))),o.success("Message deleted")}catch{o.error("Failed to delete message")}},Ke=async s=>{if(!s.trim()){E([]);return}try{const t=await ps.searchUsers(s,1,10);E((t.data.users||[]).filter(a=>a.id!==(c==null?void 0:c.id)))}catch{E([])}},Je=async s=>{try{const a={id:(await p.startConversation(s.id)).data.id,otherUser:s,lastMessage:null,unreadCount:0,lastMessageAt:null};y(a),S(!1),Y(""),A()}catch{o.error("Failed to start conversation")}},ve=s=>{const t=new Date(s),a=new Date;return t.toDateString()===a.toDateString()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})},Xe=s=>{const t=new Date(s),a=new Date,l=new Date(a);return l.setDate(l.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===l.toDateString()?"Yesterday":t.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"})},_e=O.reduce((s,t)=>{const a=new Date(t.createdAt).toDateString(),l=s[s.length-1];return l&&new Date(l.messages[0].createdAt).toDateString()===a?l.messages.push(t):s.push({date:a,messages:[t]}),s},[]),Ne=F.reduce((s,t)=>s+t.unreadCount,0);return e.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 overflow-hidden",children:[e.jsxs("div",{className:`${r?"hidden md:flex":"flex"} w-full md:w-80 lg:w-96 bg-slate-800/50 backdrop-blur-xl border-r border-slate-700/30 flex-col`,children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 opacity-90"}),e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"}),e.jsxs("div",{className:"relative p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white",children:"Messages"}),e.jsx("p",{className:"text-indigo-100 text-sm mt-0.5",children:"Stay connected"})]}),e.jsx("button",{onClick:()=>S(!0),className:"p-2.5 sm:p-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded-xl text-white transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg",children:e.jsx(ye,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Ne>0&&e.jsxs("div",{className:"px-3 py-1.5 bg-white/20 backdrop-blur-sm rounded-lg text-white text-sm inline-flex items-center gap-2 shadow-sm",children:[e.jsx(te,{size:14}),e.jsx("span",{className:"font-medium",children:Ne})," unread"]}),e.jsxs("div",{className:`px-2.5 py-1.5 rounded-lg text-xs font-medium inline-flex items-center gap-1.5 shadow-sm ${x?"bg-emerald-500/30 text-emerald-100 border border-emerald-400/30":"bg-amber-500/30 text-amber-100 border border-amber-400/30"}`,children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:`animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 ${x?"bg-emerald-400":"bg-amber-400"}`}),e.jsx("span",{className:`relative inline-flex rounded-full h-2 w-2 ${x?"bg-emerald-400":"bg-amber-400"}`})]}),x?"Connected":"Connecting..."]})]})]})]}),pe==="prompt"&&e.jsx("div",{className:"px-4 py-3 bg-indigo-500/10 border-b border-indigo-500/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"text-indigo-400 flex-shrink-0",size:18}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-indigo-200 text-sm",children:"Enable camera & mic for video calls"})}),e.jsx("button",{onClick:Te,className:"px-3 py-1.5 bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300 text-sm rounded-lg transition-colors",children:"Enable"})]})}),pe==="denied"&&e.jsx("div",{className:"px-4 py-3 bg-red-500/10 border-b border-red-500/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ts,{className:"text-red-400 flex-shrink-0",size:18}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-200 text-sm",children:"Camera/mic blocked - video calls disabled"}),e.jsx("p",{className:"text-red-300/60 text-xs mt-0.5",children:ke()})]}),e.jsxs("button",{onClick:Ve,className:"px-3 py-1.5 bg-red-500/20 hover:bg-red-500/30 text-red-300 text-sm rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(as,{size:14})," Retry"]})]})}),fe==="default"&&e.jsx("div",{className:"px-4 py-3 bg-amber-500/10 border-b border-amber-500/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ls,{className:"text-amber-400 flex-shrink-0",size:18}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-amber-200 text-sm",children:"Enable notifications for calls"})}),e.jsx("button",{onClick:$e,className:"px-3 py-1.5 bg-amber-500/20 hover:bg-amber-500/30 text-amber-300 text-sm rounded-lg transition-colors",children:"Enable"})]})}),e.jsx("div",{className:"p-3 sm:p-4 border-b border-slate-700/30",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2.5 sm:py-3 bg-slate-700/50 border border-slate-600/50 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:ze?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-slate-700 border-t-indigo-500"}),e.jsx("div",{className:"absolute inset-0 animate-ping rounded-full h-10 w-10 border-4 border-indigo-500/20"})]}),e.jsx("p",{className:"text-slate-400 text-sm mt-4",children:"Loading conversations..."})]}):F.length===0?e.jsxs("div",{className:"text-center py-16 px-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx(te,{className:"text-3xl text-indigo-400"})}),e.jsx("h3",{className:"text-white font-semibold text-lg mb-1",children:"No conversations yet"}),e.jsx("p",{className:"text-slate-400 text-sm mb-4",children:"Start connecting with others"}),e.jsx("button",{onClick:()=>S(!0),className:"px-5 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-medium rounded-xl hover:shadow-lg hover:shadow-indigo-500/25 transition-all duration-200 hover:scale-105 active:scale-95",children:"Start a conversation"})]}):e.jsx("div",{className:"divide-y divide-slate-700/30",children:F.map(s=>{var t;return e.jsxs("div",{onClick:()=>y(s),className:`group flex items-center gap-3 p-3 sm:p-4 cursor-pointer transition-all duration-200 ${(r==null?void 0:r.id)===s.id?"bg-indigo-500/15 border-l-4 border-l-indigo-500":"hover:bg-slate-700/30 border-l-4 border-l-transparent"}`,children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:`w-12 h-12 sm:w-14 sm:h-14 rounded-full bg-gradient-to-br ${P(s.otherUser.name)} flex items-center justify-center text-white font-semibold text-lg shadow-lg ring-2 ring-white/10`,children:s.otherUser.avatar?e.jsx("img",{src:s.otherUser.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):s.otherUser.name.charAt(0).toUpperCase()}),w.includes(s.otherUser.id)&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-emerald-500 rounded-full border-2 border-slate-800 shadow-lg shadow-emerald-500/50"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"font-semibold text-white truncate",children:s.otherUser.name}),s.lastMessage&&e.jsx("span",{className:"text-xs text-slate-500 flex-shrink-0",children:ve(s.lastMessage.createdAt)})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 mt-0.5",children:[e.jsx("p",{className:"text-sm text-slate-400 truncate",children:((t=s.lastMessage)==null?void 0:t.content)||"No messages yet"}),s.unreadCount>0&&e.jsx("span",{className:"flex-shrink-0 min-w-[20px] h-5 px-1.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-lg shadow-indigo-500/30",children:s.unreadCount})]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),X(s)},className:"p-2 text-slate-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-all flex-shrink-0",title:"Delete conversation",children:e.jsx(B,{size:16})})]},s.id)})})})]}),e.jsx("div",{className:`${r?"flex":"hidden md:flex"} flex-1 flex-col bg-slate-900/50 min-w-0 overflow-hidden`,children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800/70 backdrop-blur-xl border-b border-slate-700/30 px-4 md:px-6 py-3 md:py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("button",{onClick:()=>y(null),className:"md:hidden p-2.5 rounded-xl bg-slate-700/50 text-slate-300 hover:text-white hover:bg-slate-700 transition-all active:scale-95",children:e.jsx(rs,{size:20})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`w-11 h-11 md:w-12 md:h-12 rounded-full bg-gradient-to-br ${P(r.otherUser.name)} flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-white/10`,children:r.otherUser.avatar?e.jsx("img",{src:r.otherUser.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):r.otherUser.name.charAt(0).toUpperCase()}),w.includes(r.otherUser.id)&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 md:w-4 md:h-4 bg-emerald-500 rounded-full border-2 border-slate-800 shadow-lg shadow-emerald-500/50"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-base md:text-lg text-white",children:r.otherUser.name}),e.jsx("p",{className:"text-xs md:text-sm text-slate-400",children:w.includes(r.otherUser.id)?e.jsxs("span",{className:"text-emerald-400 inline-flex items-center gap-1",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-400"})]}),"Online"]}):"Offline"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>M(!0),disabled:!x||!w.includes(r.otherUser.id),className:`p-2.5 md:p-3 rounded-xl transition-all duration-200 ${x&&w.includes(r.otherUser.id)?"bg-gradient-to-r from-emerald-500 to-teal-600 text-white hover:shadow-lg hover:shadow-emerald-500/25 hover:scale-105 active:scale-95":"bg-slate-700/50 text-slate-500 cursor-not-allowed"}`,title:w.includes(r.otherUser.id)?"Start video call":"User is offline",children:e.jsx(re,{size:18})}),e.jsx("button",{className:"p-2.5 md:p-3 rounded-xl bg-slate-700/50 text-slate-400 hover:text-white hover:bg-slate-700 transition-all md:hidden",children:e.jsx(is,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-3 md:px-6 py-4 bg-gradient-to-b from-slate-900/50 to-slate-900 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:Ie?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-slate-700 border-t-indigo-500"}),e.jsx("div",{className:"absolute inset-0 animate-ping rounded-full h-10 w-10 border-4 border-indigo-500/20"})]}),e.jsx("p",{className:"text-slate-400 text-sm mt-4",children:"Loading messages..."})]}):O.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-3xl",children:"ðŸ‘‹"})}),e.jsx("p",{className:"text-slate-400",children:"No messages yet. Say hello!"})]}):e.jsxs("div",{className:"space-y-6",children:[_e.map((s,t)=>e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center my-6",children:e.jsx("div",{className:"px-4 py-1.5 bg-slate-800/80 backdrop-blur-sm rounded-full border border-slate-700/30 text-xs font-medium text-slate-400 shadow-sm",children:Xe(s.messages[0].createdAt)})}),e.jsx("div",{className:"space-y-3",children:s.messages.map((a,l)=>{var L;const i=a.senderId===(c==null?void 0:c.id),d=l===0||s.messages[l-1].senderId!==a.senderId;return e.jsxs("div",{className:`group/msg flex w-full ${i?"justify-end":"justify-start"} ${d?"":i?"pr-10 sm:pr-12":"pl-10 sm:pl-12"}`,children:[!i&&d&&e.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 rounded-full bg-gradient-to-br ${P(a.sender.name)} flex items-center justify-center text-white text-xs sm:text-sm font-semibold mr-2 sm:mr-3 flex-shrink-0 shadow-lg ring-2 ring-white/10`,children:a.sender.avatar?e.jsx("img",{src:a.sender.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):a.sender.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"max-w-[75%] sm:max-w-[70%] md:max-w-[65%] relative min-w-0",children:[e.jsxs("div",{className:`px-3 sm:px-4 py-2 sm:py-2.5 rounded-2xl shadow-sm ${i?"bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-600 text-white rounded-br-md shadow-indigo-500/20":"bg-slate-800/80 backdrop-blur-sm text-slate-200 border border-slate-700/30 rounded-bl-md"}`,children:[a.media&&a.media.length>0&&e.jsx("div",{className:`flex flex-wrap gap-2 ${a.content?"mb-2":""}`,children:a.media.map((u,Qe)=>e.jsx("div",{className:u.type==="audio"?"":"cursor-pointer group/media",onClick:()=>u.type!=="audio"&&K(u),children:u.type==="image"?e.jsx("img",{src:u.url,alt:u.filename,className:"max-w-[150px] sm:max-w-[200px] max-h-[150px] sm:max-h-[200px] rounded-lg object-cover group-hover/media:opacity-90 transition-opacity"}):u.type==="audio"?e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg min-w-[200px] sm:min-w-[250px] ${i?"bg-indigo-600/30":"bg-slate-700/50"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(G,{className:"text-purple-400",size:14})}),e.jsx("audio",{src:u.url,controls:!0,className:"flex-1 h-8 max-w-[180px] sm:max-w-[220px]",style:{minWidth:0}})]}):e.jsx("video",{src:u.url,className:"max-w-[150px] sm:max-w-[200px] max-h-[150px] sm:max-h-[200px] rounded-lg",controls:!0})},Qe))}),a.content&&e.jsx("p",{className:"text-sm sm:text-[15px] leading-relaxed whitespace-pre-wrap break-words",children:a.content})]}),e.jsxs("div",{className:`flex items-center gap-1 sm:gap-1.5 mt-1 ${i?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"text-[10px] sm:text-[11px] text-slate-500",children:ve(a.createdAt)}),i&&(a.isRead?e.jsx(ns,{className:"text-indigo-400",size:11}):e.jsx(os,{className:"text-slate-500",size:11})),i&&e.jsx("button",{onClick:()=>Ye(a.id),className:"ml-1 opacity-0 group-hover/msg:opacity-100 text-slate-500 hover:text-red-400 transition-all",title:"Delete message",children:e.jsx(B,{size:11})})]})]}),i&&d&&e.jsx("div",{className:`w-8 h-8 sm:w-9 sm:h-9 rounded-full bg-gradient-to-br ${P((c==null?void 0:c.name)||"")} flex items-center justify-center text-white text-xs sm:text-sm font-semibold ml-2 sm:ml-3 flex-shrink-0 shadow-lg ring-2 ring-white/10`,children:(L=c==null?void 0:c.name)==null?void 0:L.charAt(0).toUpperCase()})]},a.id)})})]},t)),e.jsx("div",{ref:be})]})}),oe&&e.jsx("div",{className:"px-4 md:px-6 py-2 bg-slate-800/70 backdrop-blur-sm border-t border-slate-700/30",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-slate-300",children:[oe," is typing..."]})]})}),e.jsxs("form",{onSubmit:je,className:"bg-slate-800/70 backdrop-blur-xl border-t border-slate-700/30 pb-safe",children:[f.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 p-3 bg-slate-700/30 border-b border-slate-700/30",children:f.map((s,t)=>e.jsxs("div",{className:"relative group",children:[s.type==="image"?e.jsx("img",{src:s.url,alt:s.filename,className:"w-14 h-14 sm:w-16 sm:h-16 object-cover rounded-lg border border-slate-600/50 shadow-lg"}):s.type==="audio"?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-purple-500/20 rounded-lg border border-purple-500/30",children:[e.jsx(G,{className:"text-purple-400",size:16}),e.jsx("span",{className:"text-purple-300 text-xs",children:"Voice message"})]}):e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 bg-slate-700 rounded-lg border border-slate-600/50 flex items-center justify-center shadow-lg",children:e.jsx(ae,{className:"text-slate-400",size:20})}),e.jsx("button",{type:"button",onClick:()=>Oe(t),className:"absolute -top-1.5 -right-1.5 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-red-600 transition-colors",children:e.jsx(Z,{size:12})}),s.type!=="audio"&&e.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-[9px] text-white text-center truncate px-0.5 rounded-b-lg backdrop-blur-sm",children:We(s.size)})]},t))}),e.jsxs("div",{className:"flex items-center gap-0.5 px-2 py-1.5 border-b border-slate-700/30 bg-slate-800/50 relative",children:[e.jsx("input",{ref:T,type:"file",accept:"image/*,video/*",multiple:!0,onChange:Ze,className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>{var s;return(s=T.current)==null?void 0:s.click()},disabled:me,className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95",title:"Attach photo/video",children:me?e.jsx("div",{className:"w-5 h-5 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"}):e.jsx(ds,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{Q("video"),U(!0)},className:"p-2 text-slate-400 hover:text-red-400 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95",title:"Record video",children:e.jsx(ae,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{Q("audio"),U(!0)},className:"p-2 text-slate-400 hover:text-purple-400 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95",title:"Record audio",children:e.jsx(G,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{Q("screen"),U(!0)},className:"p-2 text-slate-400 hover:text-blue-400 hover:bg-slate-600/50 rounded-lg transition-all hidden sm:flex items-center justify-center active:scale-95",title:"Share screen",children:e.jsx(cs,{size:20})}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50 mx-1"}),e.jsx("button",{type:"button",onClick:()=>J(!D),className:`p-2 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95 ${D?"text-yellow-400 bg-slate-600/50":"text-slate-400 hover:text-yellow-400"}`,title:"Add emoji",children:e.jsx(ms,{size:20})}),D&&e.jsx("div",{ref:se,className:"absolute bottom-12 left-0 z-50 shadow-2xl rounded-xl overflow-hidden",children:e.jsx(js,{theme:vs.DARK,onEmojiClick:Be,width:300,height:350,emojiStyle:ws.NATIVE})})]}),e.jsxs("div",{className:"flex items-end gap-2 p-2 sm:p-3",children:[e.jsx("div",{className:"flex-1 bg-slate-700/50 rounded-2xl border border-slate-600/30 overflow-hidden",children:e.jsx("textarea",{ref:$,value:j,onChange:s=>{k(s.target.value),He(),s.target.style.height="auto",s.target.style.height=Math.min(s.target.scrollHeight,120)+"px"},onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),(j.trim()||f.length>0)&&je(s))},placeholder:"Type your message...",className:"w-full bg-transparent px-4 py-3 text-white placeholder-slate-400 focus:outline-none text-[15px] resize-none min-h-[44px] max-h-[120px]",disabled:C,rows:1})}),e.jsx("button",{type:"submit",disabled:!j.trim()&&f.length===0||C,className:`p-3 rounded-xl transition-all duration-200 min-w-[48px] min-h-[48px] flex items-center justify-center flex-shrink-0 ${(j.trim()||f.length>0)&&!C?"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:scale-105 active:scale-95":"bg-slate-600/50 text-slate-500"}`,children:C?e.jsx("div",{className:"w-[18px] h-[18px] border-2 border-white/50 border-t-white rounded-full animate-spin"}):e.jsx(xs,{size:18})})]})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-6",children:[e.jsx("div",{className:"w-28 h-28 bg-gradient-to-br from-indigo-500/20 via-purple-500/20 to-pink-500/20 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl",children:e.jsx(te,{className:"text-5xl text-indigo-400"})}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white mb-2",children:"Your Messages"}),e.jsx("p",{className:"text-slate-400 mb-8 max-w-sm mx-auto",children:"Select a conversation to continue chatting or start a new one"}),e.jsxs("button",{onClick:()=>S(!0),className:"px-8 py-3.5 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white rounded-xl font-medium hover:shadow-xl hover:shadow-indigo-500/25 transition-all duration-300 hover:scale-105 active:scale-95 inline-flex items-center gap-2",children:[e.jsx(ye,{size:20})," New Message"]})]})})}),Pe&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",children:e.jsxs("div",{className:"bg-slate-800/95 backdrop-blur-xl rounded-t-3xl sm:rounded-2xl shadow-2xl border border-slate-700/30 w-full sm:max-w-md overflow-hidden animate-in slide-in-from-bottom sm:slide-in-from-bottom-0 sm:zoom-in-95 duration-300",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500"}),e.jsxs("div",{className:"relative p-4 sm:p-5 text-white flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"New Message"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"Start a conversation"})]}),e.jsx("button",{onClick:()=>{S(!1),Y(""),E([])},className:"p-2.5 hover:bg-white/20 rounded-xl transition-colors",children:e.jsx(Z,{size:20})})]})]}),e.jsxs("div",{className:"p-4 sm:p-5",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(le,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Search users...",value:de,onChange:s=>{Y(s.target.value),Ke(s.target.value)},className:"w-full pl-11 pr-4 py-3 bg-slate-700/50 border border-slate-600/30 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all",autoFocus:!0})]}),e.jsxs("div",{className:"max-h-64 sm:max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:[ce.length===0&&de&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-700/50 rounded-xl flex items-center justify-center mx-auto mb-3",children:e.jsx(le,{className:"text-slate-400",size:20})}),e.jsx("p",{className:"text-slate-400",children:"No users found"})]}),ce.map(s=>e.jsxs("div",{onClick:()=>Je(s),className:"flex items-center gap-3 p-3 hover:bg-slate-700/50 rounded-xl cursor-pointer transition-all duration-200 active:scale-[0.98]",children:[e.jsx("div",{className:`w-11 h-11 rounded-full bg-gradient-to-br ${P(s.name)} flex items-center justify-center text-white font-semibold shadow-lg ring-2 ring-white/10`,children:s.avatar?e.jsx("img",{src:s.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-white truncate",children:s.name}),e.jsx("p",{className:"text-sm text-slate-400 truncate",children:s.email})]})]},s.id))]})]})]})}),h&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:()=>K(null),children:[e.jsx("button",{onClick:()=>K(null),className:"absolute top-4 right-4 p-3 text-white hover:bg-white/10 rounded-xl z-10 transition-colors",children:e.jsx(Z,{size:24})}),e.jsxs("div",{className:"max-w-[90vw] max-h-[90vh]",onClick:s=>s.stopPropagation(),children:[h.type==="image"?e.jsx("img",{src:h.url,alt:h.filename,className:"max-w-full max-h-[85vh] object-contain rounded-xl shadow-2xl"}):h.type==="audio"?e.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(G,{className:"text-purple-400",size:32})}),e.jsx("audio",{src:h.url,controls:!0,className:"w-64"})]}):e.jsx("video",{src:h.url,className:"max-w-full max-h-[85vh] rounded-xl shadow-2xl",controls:!0,autoPlay:!0}),e.jsx("p",{className:"text-center text-white/60 mt-3 text-sm",children:h.filename})]})]}),ue&&r&&c&&m&&e.jsx(us,{socket:m,currentUser:{id:c.id,name:c.name||"",avatar:null},remoteUser:r.otherUser,conversationId:r.id,isIncoming:!!z,onClose:()=>{M(!1),R(null)}}),z&&!ue&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800/95 backdrop-blur-xl rounded-3xl shadow-2xl border border-slate-700/30 p-8 text-center max-w-sm w-full",children:[e.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 animate-ping opacity-30"}),e.jsx("div",{className:"relative w-full h-full rounded-full bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-2xl shadow-emerald-500/30",children:e.jsx(re,{className:"text-white",size:36})})]}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Incoming Video Call"}),e.jsxs("p",{className:"text-slate-400 mb-8",children:[z.callerName," is calling..."]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsxs("button",{onClick:()=>{m==null||m.emit("call:reject",{callerId:z.callerId}),R(null)},className:"px-6 py-3.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl hover:shadow-lg hover:shadow-red-500/25 transition-all duration-200 hover:scale-105 active:scale-95 flex items-center gap-2 font-medium",children:[e.jsx(Z,{size:20})," Decline"]}),e.jsxs("button",{onClick:()=>{const s=F.find(t=>t.otherUser.id===z.callerId);s&&y(s),M(!0)},className:"px-6 py-3.5 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl hover:shadow-lg hover:shadow-emerald-500/25 transition-all duration-200 hover:scale-105 active:scale-95 flex items-center gap-2 font-medium",children:[e.jsx(re,{size:20})," Accept"]})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-end sm:items-center justify-center z-50 p-0 sm:p-4",children:e.jsxs("div",{className:"bg-slate-800/95 backdrop-blur-xl rounded-t-3xl sm:rounded-2xl shadow-2xl border border-slate-700/30 p-6 sm:p-8 w-full sm:max-w-sm",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-red-500/20 to-rose-500/20 flex items-center justify-center shadow-lg",children:e.jsx(B,{className:"text-red-400",size:28})}),e.jsx("h2",{className:"text-xl font-bold text-white text-center mb-2",children:"Delete Conversation?"}),e.jsxs("p",{className:"text-slate-400 text-center mb-6 text-sm sm:text-base",children:["Are you sure you want to delete your conversation with ",e.jsx("span",{className:"text-white font-semibold",children:g.otherUser.name}),"? This will permanently delete all messages."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>X(null),disabled:_,className:"flex-1 px-4 py-3.5 bg-slate-700/50 text-white rounded-xl hover:bg-slate-700 transition-all duration-200 font-medium active:scale-95",children:"Cancel"}),e.jsx("button",{onClick:Ge,disabled:_,className:"flex-1 px-4 py-3.5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-xl hover:shadow-lg hover:shadow-red-500/25 transition-all duration-200 flex items-center justify-center gap-2 font-medium active:scale-95",children:_?e.jsx("div",{className:"w-5 h-5 border-2 border-white/50 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:18})," Delete"]})})]})]})}),e.jsx(Ns,{isOpen:Fe,onClose:()=>U(!1),onMediaCaptured:qe,mode:Ee})]})}export{Is as default};
