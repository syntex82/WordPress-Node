import{r as n,c as V,j as e}from"./vendor-react-D2QycniR.js";import{z as F,v as D,Y as B,ar as O,aq as T,ay as H,a4 as ce,C as le,a0 as de,X as ue,V as me,ab as he}from"./index-DXwKa3Mi.js";function fe({isOpen:N,onClose:X,onMediaCaptured:W,mode:r="video"}){const[a,v]=n.useState("idle"),[Y,k]=n.useState(0),[w,_]=n.useState("environment"),[L,$]=n.useState(!1),[G,M]=n.useState(0),[l,A]=n.useState(null),[J,P]=n.useState(0),[p,d]=n.useState("checking"),[K,h]=n.useState(null),x=n.useRef(null),f=n.useRef(null),c=n.useRef(null),E=n.useRef([]),u=n.useRef(null),j=n.useRef(null),g=n.useRef(null),b=n.useRef(null),y=(s="medium")=>{if("vibrate"in navigator){const t={light:10,medium:25,heavy:50};navigator.vibrate(t[s])}},S=n.useCallback(s=>{try{g.current=new AudioContext;const t=g.current.createMediaStreamSource(s);j.current=g.current.createAnalyser(),j.current.fftSize=256,t.connect(j.current);const i=()=>{if(!j.current)return;const o=new Uint8Array(j.current.frequencyBinCount);j.current.getByteFrequencyData(o);const R=o.reduce((C,z)=>C+z)/o.length;P(R/255),b.current=requestAnimationFrame(i)};i()}catch{console.warn("Audio monitoring not available")}},[]),I=n.useCallback(async()=>{if(d("checking"),h(null),r==="screen"){d("prompt");return}try{if(navigator.permissions){const s=r==="video"?await navigator.permissions.query({name:"camera"}):null,t=await navigator.permissions.query({name:"microphone"}),i=(s==null?void 0:s.state)||"granted",o=(t==null?void 0:t.state)||"prompt";if(i==="denied"||o==="denied"){d("denied"),h(i==="denied"&&o==="denied"?"Camera and microphone access denied":i==="denied"?"Camera access denied":"Microphone access denied");return}if(i==="granted"&&(r==="audio"||o==="granted")){d("granted");return}}d("prompt")}catch{d("prompt")}},[r]),q=n.useCallback(async()=>{var s;d("checking"),h(null);try{let t;if(r==="screen"){t=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},frameRate:{ideal:30,max:60}},audio:!0});try{(await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}})).getAudioTracks().forEach(o=>t.addTrack(o))}catch(i){console.warn("Could not get microphone for screen recording:",i)}}else if(r==="video"){const i={video:{facingMode:w,width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},aspectRatio:{ideal:1.7777777777777777}},audio:!0};t=await navigator.mediaDevices.getUserMedia(i)}else t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}});c.current=t,d("granted"),x.current&&(r==="video"||r==="screen")&&(x.current.srcObject=t,x.current.play()),r==="audio"&&S(t),r==="screen"&&((s=t.getVideoTracks()[0])==null||s.addEventListener("ended",()=>{m(),F("Screen sharing stopped")}))}catch(t){if(console.error("Failed to access media devices:",t),t.name==="NotAllowedError"||t.name==="PermissionDeniedError")d("denied"),h(r==="screen"?"Screen sharing was cancelled or denied.":"Permission denied. Please allow access in your browser settings.");else if(t.name==="NotFoundError"||t.name==="DevicesNotFoundError")d("denied"),h(r==="video"?"No camera found on this device.":"No microphone found.");else if(t.name==="NotReadableError"||t.name==="TrackStartError")d("denied"),h("Camera/microphone is already in use by another app.");else if(t.name==="AbortError"){m();return}else d("denied"),h(r==="screen"?"Unable to capture screen. Please try again.":"Unable to access camera/microphone. Please check permissions.")}},[r,w,S]),U=n.useCallback(async()=>{if(p==="granted"&&r!=="screen"&&!(c.current&&r==="audio"))try{c.current&&c.current.getTracks().forEach(i=>i.stop());const s=r==="video"?{video:{facingMode:w,width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},aspectRatio:{ideal:16/9}},audio:!0}:{audio:{echoCancellation:!0,noiseSuppression:!0}},t=await navigator.mediaDevices.getUserMedia(s);c.current=t,x.current&&r==="video"&&(x.current.srcObject=t,x.current.play()),r==="audio"&&S(t)}catch(s){console.error("Failed to access media devices:",s),F.error("Unable to access camera/microphone.")}},[r,w,S,p]);n.useEffect(()=>{N?I():(d("checking"),h(null))},[N,I]),n.useEffect(()=>()=>{c.current&&c.current.getTracks().forEach(s=>s.stop()),u.current&&clearInterval(u.current),l&&URL.revokeObjectURL(l),b.current&&cancelAnimationFrame(b.current),g.current&&g.current.close()},[l]);const Q=async()=>{y("light"),c.current&&c.current.getTracks().forEach(s=>s.stop()),_(s=>s==="user"?"environment":"user")};n.useEffect(()=>{N&&(r==="video"||r==="audio")&&U()},[w,N,r,U]);const Z=()=>{if(!c.current)return;y("medium"),E.current=[];const s=r==="video"||r==="screen",t=s?MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?"video/webm;codecs=vp9":MediaRecorder.isTypeSupported("video/webm")?"video/webm":"video/mp4":MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4",i=new MediaRecorder(c.current,{mimeType:t,videoBitsPerSecond:s?25e5:void 0,audioBitsPerSecond:128e3});f.current=i,i.ondataavailable=o=>{o.data.size>0&&E.current.push(o.data)},i.onstop=()=>{const o=new Blob(E.current,{type:t}),R=URL.createObjectURL(o);A(R),v("preview"),b.current&&cancelAnimationFrame(b.current)},i.start(1e3),v("recording"),k(0),u.current=setInterval(()=>{k(o=>o+1)},1e3)},ee=()=>{f.current&&(y("light"),a==="recording"?(f.current.pause(),v("paused"),u.current&&clearInterval(u.current)):(f.current.resume(),v("recording"),u.current=setInterval(()=>k(s=>s+1),1e3)))},re=()=>{y("heavy"),u.current&&clearInterval(u.current),f.current&&f.current.state!=="inactive"&&f.current.stop(),c.current&&c.current.getTracks().forEach(s=>s.stop())},te=s=>{const t=Math.floor(s/60),i=s%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},se=()=>{y("light"),l&&URL.revokeObjectURL(l),A(null),v("idle"),k(0),P(0),U()},ae=async()=>{if(l){y("medium"),$(!0),M(0);try{const t=await(await fetch(l)).blob(),o=`${r}-${Date.now()}.webm`,R=new File([t],o,{type:t.type}),C=await he.upload(R,oe=>{M(oe)}),z=C.data.url||C.data.path;W({type:r==="audio"?"AUDIO":"VIDEO",url:z});const ne=r==="video"?"Video":r==="screen"?"Screen recording":"Audio";F.success(`${ne} saved successfully!`),m()}catch(s){console.error("Upload failed:",s),F.error("Failed to save recording. Please try again.")}finally{$(!1),M(0)}}},m=()=>{c.current&&c.current.getTracks().forEach(s=>s.stop()),u.current&&clearInterval(u.current),l&&URL.revokeObjectURL(l),b.current&&cancelAnimationFrame(b.current),g.current&&g.current.close(),A(null),v("idle"),k(0),P(0),X()};if(!N)return null;const ie=Array.from({length:40},(s,t)=>{const i=Math.sin(t/40*Math.PI)*.5+.5,o=a==="recording"?i*(.3+J*.7+Math.sin(Date.now()/100+t)*.2):i*.3;return Math.max(.1,Math.min(1,o))});return p==="checking"||p==="prompt"||p==="denied"?V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-xl",onClick:m}),e.jsxs("div",{className:"relative w-full h-full sm:w-[90vw] sm:h-auto sm:max-w-md sm:rounded-3xl overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 sm:shadow-2xl sm:border sm:border-slate-700/50 flex flex-col items-center justify-center p-6 sm:p-8",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 p-3 rounded-2xl bg-white/10 hover:bg-white/20 text-white transition-all",children:e.jsx(D,{size:20})}),p==="checking"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-slate-700 border-t-purple-500 animate-spin mb-6"}),e.jsx("p",{className:"text-white text-lg",children:"Checking permissions..."})]}):p==="denied"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-red-500/20 flex items-center justify-center mb-6",children:e.jsx(D,{className:"w-12 h-12 text-red-400"})}),e.jsx("h3",{className:"text-white text-xl font-bold mb-3 text-center",children:"Permission Denied"}),e.jsx("p",{className:"text-slate-400 text-center mb-6 max-w-xs",children:K||"Camera and microphone access is required to record."}),e.jsx("p",{className:"text-slate-500 text-sm text-center mb-6",children:"Please enable permissions in your browser settings and try again."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"px-6 py-3 rounded-xl bg-slate-700 text-white font-medium hover:bg-slate-600 transition-all",children:"Cancel"}),e.jsx("button",{onClick:q,className:"px-6 py-3 rounded-xl bg-purple-600 text-white font-medium hover:bg-purple-500 transition-all",children:"Try Again"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-purple-500/30 to-pink-500/30 flex items-center justify-center mb-6",children:r==="video"?e.jsx(B,{className:"w-12 h-12 text-purple-400"}):r==="screen"?e.jsx(O,{className:"w-12 h-12 text-purple-400"}):e.jsx(T,{className:"w-12 h-12 text-purple-400"})}),e.jsx("h3",{className:"text-white text-xl font-bold mb-3 text-center",children:r==="video"?"Camera & Microphone Access":r==="screen"?"Screen Sharing":"Microphone Access"}),e.jsx("p",{className:"text-slate-400 text-center mb-8 max-w-xs",children:r==="video"?"Allow access to your camera and microphone to record videos.":r==="screen"?"Select a window, tab, or your entire screen to share.":"Allow access to your microphone to record audio."}),e.jsx("button",{onClick:q,className:"w-full max-w-xs px-8 py-4 rounded-2xl bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold text-lg hover:from-purple-500 hover:to-pink-500 transition-all transform hover:scale-[1.02] active:scale-[0.98] shadow-lg shadow-purple-500/25",children:r==="screen"?"Share Screen":"Allow Access"}),e.jsx("button",{onClick:m,className:"mt-4 px-6 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"})]})]})]}),document.body):V.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-xl",onClick:a==="idle"?m:void 0}),e.jsxs("div",{className:"relative w-full h-full sm:w-[90vw] sm:h-[85vh] sm:max-w-4xl sm:max-h-[700px] sm:rounded-3xl overflow-hidden bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 sm:shadow-2xl sm:border sm:border-slate-700/50 flex flex-col",children:[e.jsxs("div",{className:"relative z-20 flex items-center justify-between p-4 sm:p-5 bg-gradient-to-b from-black/60 to-transparent",children:[e.jsx("button",{onClick:m,"aria-label":"Close recorder",className:"p-3 sm:p-3.5 rounded-2xl bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white min-w-[48px] min-h-[48px] flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95",children:e.jsx(D,{size:22})}),a!=="idle"&&e.jsxs("div",{className:"flex items-center gap-3 px-5 py-2.5 rounded-2xl bg-black/40 backdrop-blur-sm border border-white/10",children:[a==="recording"&&e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-red-500"})]}),a==="paused"&&e.jsx("div",{className:"w-3 h-3 rounded-sm bg-yellow-500"}),e.jsx("span",{className:"text-white font-mono text-lg font-medium tracking-wider",children:te(Y)})]}),r==="video"&&(a==="idle"||a==="recording")&&e.jsx("button",{onClick:Q,"aria-label":"Switch camera",className:"p-3 sm:p-3.5 rounded-2xl bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white min-w-[48px] min-h-[48px] flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95 hover:rotate-180",children:e.jsx(H,{size:22})}),(r==="audio"||r==="screen"||a==="preview")&&e.jsx("div",{className:"w-12"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center relative overflow-hidden",children:r==="video"||r==="screen"?a==="preview"&&l?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black p-4",children:e.jsx("video",{src:l,controls:!0,autoPlay:!0,loop:!0,className:"w-auto h-auto max-w-full max-h-full rounded-lg sm:rounded-2xl",style:{objectFit:"contain"}})}):e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("video",{ref:x,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover",style:{transform:r==="video"&&w==="user"?"scaleX(-1)":"none"}}),e.jsx("div",{className:"absolute inset-0 pointer-events-none bg-gradient-to-t from-black/30 via-transparent to-transparent"}),a==="recording"&&e.jsx("div",{className:`absolute inset-4 sm:inset-8 border-2 ${r==="screen"?"border-blue-500/50":"border-red-500/50"} rounded-2xl pointer-events-none animate-pulse`})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center gap-8 p-8 w-full",children:[e.jsxs("div",{className:"relative",children:[a==="recording"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 opacity-20 animate-ping",style:{animationDuration:"1.5s"}}),e.jsx("div",{className:"absolute -inset-4 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 opacity-10 animate-ping",style:{animationDuration:"2s"}})]}),e.jsx("div",{className:`relative w-28 h-28 sm:w-36 sm:h-36 rounded-full flex items-center justify-center transition-all duration-500 ${a==="recording"?"bg-gradient-to-br from-red-500 to-pink-600 shadow-lg shadow-red-500/50":a==="preview"?"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/50":"bg-gradient-to-br from-slate-700 to-slate-800"}`,children:a==="preview"?e.jsx(ce,{size:48,className:"text-white"}):e.jsx(T,{size:48,className:"text-white"})})]}),e.jsx("div",{className:"flex items-end justify-center gap-1 h-20 sm:h-24 w-full max-w-md px-4",children:ie.map((s,t)=>e.jsx("div",{className:`w-1.5 sm:w-2 rounded-full transition-all duration-100 ${a==="recording"?"bg-gradient-to-t from-purple-500 to-pink-400":a==="preview"?"bg-gradient-to-t from-green-500 to-emerald-400":"bg-slate-600"}`,style:{height:`${s*100}%`,opacity:a==="idle"?.5:1}},t))}),a==="preview"&&l&&e.jsx("div",{className:"w-full max-w-sm",children:e.jsx("audio",{src:l,controls:!0,className:"w-full h-12 rounded-xl",style:{filter:"invert(1) hue-rotate(180deg)"}})}),e.jsx("p",{className:"text-slate-400 text-sm font-medium uppercase tracking-widest",children:a==="recording"?"Recording Audio...":a==="paused"?"Paused":a==="preview"?"Preview Recording":"Ready to Record"})]})}),e.jsxs("div",{className:"relative z-20 p-6 sm:p-8 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:[e.jsxs("div",{className:"flex items-center justify-center gap-6 sm:gap-8",children:[a==="idle"&&e.jsxs("button",{onClick:Z,"aria-label":"Start recording",className:"group relative w-20 h-20 sm:w-24 sm:h-24 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-105 active:scale-95",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-white/80 group-hover:border-white transition-colors"}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-red-500 to-red-600 shadow-lg shadow-red-500/50 group-hover:shadow-red-500/70 transition-shadow"})]}),(a==="recording"||a==="paused")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ee,"aria-label":a==="paused"?"Resume":"Pause",className:"p-4 sm:p-5 rounded-2xl bg-white/15 hover:bg-white/25 backdrop-blur-sm text-white min-w-[56px] min-h-[56px] sm:min-w-[64px] sm:min-h-[64px] flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95 border border-white/10",children:a==="paused"?e.jsx(le,{size:28}):e.jsx(de,{size:28})}),e.jsxs("button",{onClick:re,"aria-label":"Stop recording",className:"group relative w-20 h-20 sm:w-24 sm:h-24 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-105 active:scale-95",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-white/80 group-hover:border-white transition-colors"}),e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gradient-to-br from-red-500 to-red-600 shadow-lg shadow-red-500/50"})]})]}),a==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:se,"aria-label":"Retry",className:"p-4 sm:p-5 rounded-2xl bg-white/15 hover:bg-white/25 backdrop-blur-sm text-white min-w-[56px] min-h-[56px] sm:min-w-[64px] sm:min-h-[64px] flex items-center justify-center transition-all duration-200 hover:scale-105 active:scale-95 border border-white/10",children:e.jsx(H,{size:28})}),e.jsxs("button",{onClick:ae,disabled:L,"aria-label":"Save recording",className:"group relative w-20 h-20 sm:w-24 sm:h-24 rounded-full flex items-center justify-center transition-all duration-300 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-green-400/80 group-hover:border-green-400 transition-colors"}),e.jsx("div",{className:"w-14 h-14 sm:w-16 sm:h-16 rounded-full bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/50 group-hover:shadow-green-500/70 flex items-center justify-center transition-shadow",children:L?e.jsxs("div",{className:"relative w-8 h-8",children:[e.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 36 36",children:[e.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"white",strokeOpacity:"0.3",strokeWidth:"3"}),e.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"white",strokeWidth:"3",strokeDasharray:`${G} 100`,strokeLinecap:"round"})]}),e.jsx(ue,{className:"absolute inset-0 m-auto text-white",size:16})]}):e.jsx(me,{size:32,className:"text-white"})})]})]})]}),e.jsx("div",{className:"flex justify-center mt-5",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-white/5 border border-white/10",children:[r==="video"?e.jsx(B,{size:16,className:"text-slate-400"}):r==="screen"?e.jsx(O,{size:16,className:"text-slate-400"}):e.jsx(T,{size:16,className:"text-slate-400"}),e.jsx("span",{className:"text-slate-400 text-sm font-medium",children:r==="video"?"Video":r==="screen"?"Screen Recording":"Audio"})]})})]})]})]}),document.body)}export{fe as M};
