import{r,j as e,h as Je,L as ve}from"./vendor-react-D2QycniR.js";import{aa as Ce,Y as z,v as le,b as A,an as Ye,z as m,aj as M,N as we,ao as ae,ap as Ne,ak as He,aq as B,V as Ke,I as Xe,f as _e,ar as qe,as as Qe,at as et,B as tt,au as st,av as at,n as lt,al as rt}from"./index-Bpp1ZX0C.js";import{l as ye}from"./vendor-socket-CA1CrNgP.js";import{E as it,a as nt,T as ot}from"./emoji-picker-react.esm-B284Vdmy.js";import{M as dt}from"./MobileMediaRecorder-DvADZrOG.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";function ct({groupId:o,groupName:u,socket:c,members:i=[],onlineUsers:F=[],onCallUser:S,onClose:v}){const{user:x}=Ce(),[E,f]=r.useState([]);r.useEffect(()=>{const d=i.filter(w=>w.id!==(x==null?void 0:x.id)).map(w=>({...w,isOnline:F.includes(w.id)}));f(d)},[i,F,x==null?void 0:x.id]);const b=d=>{S&&S(d),c!=null&&c.connected&&c.emit("call:initiate",{targetUserId:d,groupId:o}),v()};return e.jsxs("div",{className:"fixed z-50 bottom-4 right-4 w-[350px] max-w-[95vw] bg-gray-900 shadow-2xl rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-indigo-600 to-purple-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-white",size:20}),e.jsx("span",{className:"text-white font-medium",children:"Video Call"})]}),e.jsx("button",{onClick:v,className:"p-1.5 rounded-full bg-white/20 hover:bg-white/30 text-white",children:e.jsx(le,{size:18})})]}),e.jsx("div",{className:"px-4 py-3 bg-blue-500/20 border-b border-blue-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(A,{className:"text-blue-400 mt-0.5",size:16}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-200 text-sm font-medium",children:"1-on-1 Video Calls"}),e.jsxs("p",{className:"text-blue-300/70 text-xs",children:["Select a member from ",u," to start a private video call"]})]})]})}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:E.length===0?e.jsxs("div",{className:"p-6 text-center text-gray-400",children:[e.jsx(A,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No other members in this group"})]}):e.jsx("div",{className:"divide-y divide-gray-800",children:E.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-gray-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[d.avatar?e.jsx("img",{src:d.avatar,alt:d.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-medium",children:d.name.charAt(0).toUpperCase()}),d.isOnline&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-gray-900"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm font-medium",children:d.name}),e.jsx("p",{className:`text-xs ${d.isOnline?"text-green-400":"text-gray-500"}`,children:d.isOnline?"Online":"Offline"})]})]}),e.jsx("button",{onClick:()=>b(d.id),disabled:!d.isOnline,className:`p-2.5 rounded-full transition-all ${d.isOnline?"bg-green-500 hover:bg-green-600 text-white":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,title:d.isOnline?`Call ${d.name}`:"User is offline",children:e.jsx(Ye,{size:16})})]},d.id))})}),e.jsx("div",{className:"p-3 bg-gray-800/50 border-t border-gray-700",children:e.jsx("p",{className:"text-gray-400 text-xs text-center",children:"Only online members can receive calls"})})]})}const ke=["from-blue-400 to-blue-600","from-purple-400 to-purple-600","from-pink-400 to-pink-600","from-emerald-400 to-emerald-600","from-orange-400 to-orange-600","from-cyan-400 to-cyan-600","from-rose-400 to-rose-600","from-indigo-400 to-indigo-600"],P=o=>{const u=o.charCodeAt(0)%ke.length;return ke[u]},Se=o=>{switch(o){case"OWNER":return{icon:rt,color:"text-yellow-400",bg:"bg-yellow-500/20",label:"Owner"};case"MODERATOR":return{icon:lt,color:"text-blue-400",bg:"bg-blue-500/20",label:"Mod"};default:return null}};function bt(){var be;const{id:o}=Je(),{token:u,user:c}=Ce(),[i,F]=r.useState(null),[S,v]=r.useState([]),[x,E]=r.useState([]),[f,b]=r.useState(""),[d,w]=r.useState(!0),[D,G]=r.useState(!1),[Z,Me]=r.useState(!0),[W,re]=r.useState([]),[L,C]=r.useState([]),[h,ze]=r.useState(null),[p,J]=r.useState(!1),[Y,De]=r.useState(""),[N,y]=r.useState([]),[ie,ne]=r.useState(!1),[j,H]=r.useState(null),[I,K]=r.useState(!1),[oe,R]=r.useState(!1),[T,de]=r.useState(null),[X,_]=r.useState(null),[O,ce]=r.useState(null),[Ie,$]=r.useState(!1),[$e,q]=r.useState("video"),me=r.useRef(null),U=r.useRef(null),V=r.useRef(null),Q=r.useRef(null),ee=r.useRef(null);r.useEffect(()=>{o&&(te(),ue(),he())},[o]),r.useEffect(()=>{if(i!=null&&i.isMember&&u){const t=`${window.location.protocol}//${window.location.host}/groups`,s=ye(t,{auth:{token:u},transports:["websocket","polling"],path:"/socket.io",reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return s.on("connect",()=>{console.log("Connected to groups gateway"),J(!0),s.emit("group:join",{groupId:o},a=>{a.onlineUsers&&C(a.onlineUsers)})}),s.on("disconnect",()=>{console.log("Disconnected from groups gateway"),J(!1)}),s.on("connect_error",a=>{console.error("WebSocket connection error:",a.message),J(!1)}),s.on("group:message:new",a=>{v(l=>[...l,a]),xe()}),s.on("users:online:list",a=>{console.log("Received online users list:",a.users),C(a.users)}),s.on("group:user:online",a=>{C(l=>[...new Set([...l,a.userId])])}),s.on("user:online",a=>{C(l=>[...new Set([...l,a.userId])])}),s.on("group:user:offline",a=>{C(l=>l.filter(n=>n!==a.userId))}),s.on("user:offline",a=>{C(l=>l.filter(n=>n!==a.userId))}),s.on("group:typing",a=>{a.isTyping?re(l=>[...new Set([...l,a.userName])]):re(l=>l.filter(n=>n!==a.userName))}),s.on("group:message:deleted",a=>{v(l=>l.filter(n=>n.id!==a.messageId))}),s.on("group:video:started",a=>{console.log("Video call started by:",a.startedBy.name),_({roomUrl:a.roomUrl,startedBy:a.startedBy}),m.success(`${a.startedBy.name} started a video call`)}),s.on("group:video:ended",()=>{_(null)}),ze(s),()=>{s.emit("group:leave",{groupId:o}),s.disconnect()}}},[i==null?void 0:i.isMember,u,o]),r.useEffect(()=>{xe()},[S]),r.useEffect(()=>{if(u&&(i!=null&&i.isMember)){const t=`${window.location.protocol}//${window.location.host}/messages`,s=ye(t,{auth:{token:u},transports:["websocket","polling"],path:"/socket.io",reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return s.on("connect",()=>{console.log("Messages socket connected for video calls")}),ce(s),()=>{s.disconnect(),ce(null)}}},[u,i==null?void 0:i.isMember]);const xe=()=>{var t;(t=me.current)==null||t.scrollIntoView({behavior:"smooth"})},te=async()=>{try{const t=await M.getById(o);F(t.data)}catch{m.error("Failed to load group")}},ue=async()=>{try{w(!0);const t=await M.getMessages(o);v(t.data||[])}catch{}finally{w(!1)}},he=async()=>{try{const t=await M.getMembers(o);E(t.data||[])}catch{}},Ae=t=>{var s;b(a=>a+t.emoji),K(!1),(s=U.current)==null||s.focus()};r.useEffect(()=>{const t=s=>{ee.current&&!ee.current.contains(s.target)&&K(!1)};return I&&document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[I]);const pe=async t=>{var l;if(t.preventDefault(),!f.trim()&&N.length===0||!o||D)return;const s=f.trim(),a=[...N];b(""),y([]),G(!0),ge();try{if(h&&p){h.emit("group:message:send",{groupId:o,content:s,media:a.length>0?a:void 0},n=>{var k;n!=null&&n.error?(m.error(n.error),b(s),y(a)):n!=null&&n.success&&m.success("Message sent"),G(!1),(k=U.current)==null||k.focus()});return}else m.error("Not connected to chat. Please refresh the page."),b(s),y(a)}catch{m.error("Failed to send message. Please try again."),b(s),y(a)}finally{G(!1),(l=U.current)==null||l.focus()}},Fe=async t=>{const s=t.target.files;if(!s||s.length===0)return;ne(!0);const a=new FormData;Array.from(s).forEach(l=>a.append("files",l));try{const l=await at.uploadMedia(a);y(n=>[...n,...l.data.media]),m.success(`${s.length} file(s) ready to send`)}catch{m.error("Failed to upload media")}finally{ne(!1),V.current&&(V.current.value="")}},Ee=t=>{y(s=>s.filter((a,l)=>l!==t))},Le=t=>{const s={url:t.url,type:t.type==="VIDEO"?"video":"audio",filename:`${t.type.toLowerCase()}-${Date.now()}.webm`,size:0,mimeType:t.type==="VIDEO"?"video/webm":"audio/webm"};y(a=>[...a,s]),$(!1),m.success(`${t.type==="VIDEO"?"Video":"Voice message"} ready to send`)},Re=t=>t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB",Te=()=>{!h||!p||(h.emit("group:typing:start",{groupId:o}),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>ge(),2e3))},ge=()=>{!h||!p||h.emit("group:typing:stop",{groupId:o})},Oe=async t=>{if(o&&confirm("Delete this message?"))try{h&&p?h.emit("group:message:delete",{groupId:o,messageId:t}):(await M.deleteMessage(o,t),v(s=>s.filter(a=>a.id!==t))),m.success("Message deleted")}catch{m.error("Failed to delete message")}},Ue=async()=>{var t,s;try{await M.join(o),m.success("Welcome to the group!"),te(),ue(),he()}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to join group")}},Ve=async()=>{var t,s;if(confirm("Are you sure you want to leave this group?"))try{await M.leave(o),m.success("You left the group"),te()}catch(a){m.error(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to leave group")}},Be=t=>{const s=new Date(t),a=new Date;return s.toDateString()===a.toDateString()?s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s.toLocaleDateString([],{month:"short",day:"numeric"})+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},Pe=t=>{const s=new Date(t),a=new Date,l=new Date(a);return l.setDate(l.getDate()-1),s.toDateString()===a.toDateString()?"Today":s.toDateString()===l.toDateString()?"Yesterday":s.toLocaleDateString([],{weekday:"long",month:"long",day:"numeric"})},Ge=S.reduce((t,s)=>{const a=new Date(s.createdAt).toDateString(),l=t[t.length-1];return l&&new Date(l.messages[0].createdAt).toDateString()===a?l.messages.push(s):t.push({date:a,messages:[s]}),t},[]),fe=x.filter(t=>t.user.name.toLowerCase().includes(Y.toLowerCase())||t.user.email.toLowerCase().includes(Y.toLowerCase())),se=x.filter(t=>L.includes(t.user.id)).length;return i?i.isMember?e.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-800/70 backdrop-blur-xl border-b border-slate-700/30 px-3 sm:px-6 py-3 sm:py-4 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0 flex-1",children:[e.jsx(ve,{to:"/groups",className:"p-2.5 hover:bg-slate-700/50 rounded-xl text-slate-400 hover:text-white transition-all duration-200 flex-shrink-0",children:e.jsx(we,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e.jsxs("div",{className:"w-11 h-11 sm:w-12 sm:h-12 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-xl flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-white/10 flex-shrink-0",children:[e.jsx(ae,{size:18,className:"sm:hidden"}),e.jsx(ae,{size:20,className:"hidden sm:block"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[e.jsx("h2",{className:"font-bold text-base sm:text-lg text-white truncate max-w-[120px] sm:max-w-none",children:i.name}),e.jsxs("div",{className:`px-2 sm:px-2.5 py-0.5 sm:py-1 rounded-lg text-[10px] sm:text-xs inline-flex items-center gap-1.5 flex-shrink-0 backdrop-blur-sm ${p?"bg-emerald-500/20 text-emerald-300 border border-emerald-500/20":"bg-amber-500/20 text-amber-300 border border-amber-500/20"}`,children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${p?"bg-emerald-400":"bg-amber-400 animate-pulse"}`}),e.jsx("span",{className:"hidden xs:inline",children:p?"Live":"Connecting..."})]})]}),e.jsxs("p",{className:"text-xs sm:text-sm text-slate-400 truncate mt-0.5",children:[se," online · ",x.length," members"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>R(!0),disabled:!p,className:`p-2.5 sm:p-3 rounded-xl transition-all duration-200 ${p?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:shadow-lg hover:shadow-emerald-500/25 hover:scale-105 active:scale-95":"bg-slate-700/50 text-slate-500 cursor-not-allowed"}`,title:"Start group video call",children:[e.jsx(z,{size:18,className:"sm:hidden"}),e.jsx(z,{size:20,className:"hidden sm:block"})]}),e.jsxs("button",{onClick:()=>Me(!Z),className:`p-2.5 sm:p-3 rounded-xl transition-all duration-200 ${Z?"bg-indigo-500/20 text-indigo-400 border border-indigo-500/20":"hover:bg-slate-700/50 text-slate-400 hover:text-white"}`,children:[e.jsx(A,{size:18,className:"sm:hidden"}),e.jsx(A,{size:20,className:"hidden sm:block"})]}),e.jsxs("button",{onClick:Ve,className:"p-2.5 sm:p-3 hover:bg-red-500/20 text-slate-400 hover:text-red-400 rounded-xl transition-all duration-200",children:[e.jsx(Ne,{size:18,className:"sm:hidden"}),e.jsx(Ne,{size:20,className:"hidden sm:block"})]})]})]}),X&&!oe&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 px-4 py-3 flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg animate-pulse",children:e.jsx(z,{className:"text-white",size:18})}),e.jsx("span",{className:"text-white font-medium text-sm sm:text-base",children:X.startedBy.id===(c==null?void 0:c.id)?"You started a video call":`${X.startedBy.name} started a video call`})]}),e.jsx("button",{onClick:()=>R(!0),className:"px-4 py-2 bg-white text-emerald-700 font-semibold rounded-xl hover:bg-emerald-50 transition-all duration-200 hover:scale-105 active:scale-95 shadow-lg",children:"Join Call"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden px-3 sm:px-6 py-3 sm:py-4 bg-gradient-to-b from-slate-900/50 to-slate-900",children:d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-indigo-500"}),e.jsx("div",{className:"absolute inset-0 animate-ping rounded-full h-12 w-12 border-4 border-indigo-500/20"})]}),e.jsx("p",{className:"text-slate-400 text-sm mt-4",children:"Loading messages..."})]}):S.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-2xl flex items-center justify-center mb-4 shadow-lg",children:e.jsx(He,{className:"text-3xl sm:text-4xl text-indigo-400"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-white mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-400",children:"Be the first to start the conversation!"})]}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[Ge.map((t,s)=>e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center my-4 sm:my-6",children:e.jsx("div",{className:"px-4 sm:px-5 py-1.5 sm:py-2 bg-slate-800/70 backdrop-blur-sm rounded-full border border-slate-700/30 text-[10px] sm:text-xs font-medium text-slate-400 shadow-lg",children:Pe(t.messages[0].createdAt)})}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:t.messages.map((a,l)=>{var je;const n=a.sender.id===(c==null?void 0:c.id),k=l===0||t.messages[l-1].sender.id!==a.sender.id,Ze=n||((je=i==null?void 0:i.owner)==null?void 0:je.id)===(c==null?void 0:c.id);return e.jsxs("div",{className:`group/msg flex w-full ${n?"justify-end":"justify-start"} ${k?"":n?"pr-10 sm:pr-12":"pl-10 sm:pl-12"}`,children:[!n&&k&&e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br ${P(a.sender.name)} flex items-center justify-center text-white text-xs sm:text-sm font-semibold mr-2 sm:mr-3 flex-shrink-0 shadow-lg ring-2 ring-white/10`,children:a.sender.avatar?e.jsx("img",{src:a.sender.avatar,alt:"",className:"w-full h-full rounded-xl object-cover"}):a.sender.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:`max-w-[75%] sm:max-w-[65%] min-w-0 ${n?"items-end":"items-start"}`,children:[!n&&k&&e.jsx("p",{className:"text-[10px] sm:text-xs font-semibold text-slate-400 mb-1 sm:mb-1.5 ml-1",children:a.sender.name}),e.jsxs("div",{className:`px-3.5 sm:px-4 py-2.5 sm:py-3 rounded-2xl shadow-lg ${n?"bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 text-white rounded-br-md":"bg-slate-800/80 backdrop-blur-sm text-slate-200 border border-slate-700/30 rounded-bl-md"}`,children:[a.media&&a.media.length>0&&e.jsx("div",{className:`flex flex-wrap gap-1.5 sm:gap-2 ${a.content?"mb-2 sm:mb-2.5":""}`,children:a.media.map((g,We)=>e.jsx("div",{className:g.type==="audio"?"":"cursor-pointer group/media",onClick:()=>g.type!=="audio"&&H(g),children:g.type==="image"?e.jsx("img",{src:g.url,alt:g.filename,className:"max-w-[140px] max-h-[140px] sm:max-w-[200px] sm:max-h-[200px] rounded-xl object-cover group-hover/media:opacity-90 transition-all duration-200 shadow-lg"}):g.type==="audio"?e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg min-w-[200px] sm:min-w-[250px] ${n?"bg-indigo-600/30":"bg-slate-700/50"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(B,{className:"text-purple-400",size:14})}),e.jsx("audio",{src:g.url,controls:!0,className:"flex-1 h-8 max-w-[180px] sm:max-w-[220px]",style:{minWidth:0}})]}):e.jsx("video",{src:g.url,className:"max-w-[140px] max-h-[140px] sm:max-w-[200px] sm:max-h-[200px] rounded-xl shadow-lg",controls:!0})},We))}),a.content&&e.jsx("p",{className:"text-[13px] sm:text-[15px] leading-relaxed whitespace-pre-wrap break-words",children:a.content})]}),e.jsxs("div",{className:`flex items-center gap-1.5 mt-1 sm:mt-1.5 ${n?"justify-end":"justify-start"}`,children:[e.jsx("span",{className:"text-[10px] sm:text-[11px] text-slate-500",children:Be(a.createdAt)}),n&&e.jsx(Ke,{className:"text-indigo-400",size:10}),Ze&&e.jsx("button",{onClick:()=>Oe(a.id),className:"ml-1 opacity-0 group-hover/msg:opacity-100 sm:opacity-0 active:opacity-100 text-slate-500 hover:text-red-400 transition-all duration-200 p-1 -m-1 hover:bg-red-500/10 rounded",title:"Delete message",children:e.jsx(Xe,{size:12})})]})]}),n&&k&&e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br ${P(a.sender.name)} flex items-center justify-center text-white text-xs sm:text-sm font-semibold ml-2 sm:ml-3 flex-shrink-0 shadow-lg ring-2 ring-white/10`,children:a.sender.avatar?e.jsx("img",{src:a.sender.avatar,alt:"",className:"w-full h-full rounded-xl object-cover"}):a.sender.name.charAt(0).toUpperCase()})]},a.id)})})]},s)),e.jsx("div",{ref:me})]})}),W.length>0&&e.jsx("div",{className:"px-4 sm:px-6 py-2 sm:py-2.5 bg-slate-800/70 backdrop-blur-sm border-t border-slate-700/30",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm text-slate-400",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-1.5 h-1.5 sm:w-2 sm:h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"truncate text-slate-300",children:[W.join(", ")," ",W.length===1?"is":"are"," typing..."]})]})}),e.jsxs("form",{onSubmit:pe,className:"bg-slate-800/70 backdrop-blur-xl border-t border-slate-700/30 pb-safe flex-shrink-0",children:[N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 p-3 bg-slate-700/30 border-b border-slate-700/30",children:N.map((t,s)=>e.jsxs("div",{className:"relative group",children:[t.type==="image"?e.jsx("img",{src:t.url,alt:t.filename,className:"w-12 h-12 sm:w-14 sm:h-14 object-cover rounded-lg border border-slate-600/50 shadow-lg"}):t.type==="audio"?e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-purple-500/20 rounded-lg border border-purple-500/30",children:[e.jsx(B,{className:"text-purple-400",size:16}),e.jsx("span",{className:"text-purple-300 text-xs",children:"Voice message"})]}):e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-slate-700 rounded-lg border border-slate-600/50 flex items-center justify-center shadow-lg",children:e.jsx(z,{className:"text-slate-400",size:18})}),e.jsx("button",{type:"button",onClick:()=>Ee(s),className:"absolute -top-1.5 -right-1.5 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-red-600 transition-colors",children:e.jsx(le,{size:12})}),t.type!=="audio"&&e.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/70 text-[8px] text-white text-center truncate px-0.5 rounded-b-lg backdrop-blur-sm",children:Re(t.size)})]},s))}),e.jsxs("div",{className:"flex items-center gap-0.5 px-2 py-1.5 border-b border-slate-700/30 bg-slate-800/50 relative",children:[e.jsx("input",{ref:V,type:"file",accept:"image/*,video/*",multiple:!0,onChange:Fe,className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>{var t;return(t=V.current)==null?void 0:t.click()},disabled:ie,className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95",title:"Attach photo/video",children:ie?e.jsx("div",{className:"w-5 h-5 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"}):e.jsx(_e,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{q("video"),$(!0)},className:"p-2 text-slate-400 hover:text-red-400 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95",title:"Record video",children:e.jsx(z,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{q("audio"),$(!0)},className:"p-2 text-slate-400 hover:text-purple-400 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95",title:"Record audio",children:e.jsx(B,{size:20})}),e.jsx("button",{type:"button",onClick:()=>{q("screen"),$(!0)},className:"p-2 text-slate-400 hover:text-blue-400 hover:bg-slate-600/50 rounded-lg transition-all hidden sm:flex items-center justify-center active:scale-95",title:"Share screen",children:e.jsx(qe,{size:20})}),e.jsx("div",{className:"w-px h-5 bg-slate-600/50 mx-1"}),e.jsx("button",{type:"button",onClick:()=>K(!I),className:`p-2 hover:bg-slate-600/50 rounded-lg transition-all flex items-center justify-center active:scale-95 ${I?"text-yellow-400 bg-slate-600/50":"text-slate-400 hover:text-yellow-400"}`,title:"Add emoji",children:e.jsx(Qe,{size:20})}),I&&e.jsx("div",{ref:ee,className:"absolute bottom-12 left-0 z-50 shadow-2xl rounded-xl overflow-hidden",children:e.jsx(it,{theme:ot.DARK,onEmojiClick:Ae,width:280,height:320,emojiStyle:nt.NATIVE})})]}),e.jsxs("div",{className:"flex items-end gap-2 p-2 sm:p-3",children:[e.jsx("div",{className:"flex-1 bg-slate-700/50 rounded-2xl border border-slate-600/30 overflow-hidden",children:e.jsx("textarea",{ref:U,value:f,onChange:t=>{b(t.target.value),Te(),t.target.style.height="auto",t.target.style.height=Math.min(t.target.scrollHeight,100)+"px"},onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),(f.trim()||N.length>0)&&pe(t))},placeholder:"Type your message...",className:"w-full bg-transparent px-4 py-2.5 text-white placeholder-slate-400 focus:outline-none text-[15px] resize-none min-h-[40px] max-h-[100px]",disabled:D,rows:1})}),e.jsx("button",{type:"submit",disabled:!f.trim()&&N.length===0||D,className:`p-2.5 sm:p-3 rounded-xl transition-all duration-200 min-w-[44px] min-h-[44px] flex items-center justify-center flex-shrink-0 ${(f.trim()||N.length>0)&&!D?"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:scale-105 active:scale-95":"bg-slate-600/50 text-slate-500"}`,children:D?e.jsx("div",{className:"w-[18px] h-[18px] border-2 border-white/50 border-t-white rounded-full animate-spin"}):e.jsx(et,{size:18})})]})]})]}),Z&&e.jsxs("div",{className:"hidden md:flex w-72 lg:w-80 bg-slate-800/70 backdrop-blur-xl border-l border-slate-700/30 flex-col",children:[e.jsxs("div",{className:"p-4 lg:p-5 border-b border-slate-700/30",children:[e.jsxs("h3",{className:"font-bold text-white mb-3 lg:mb-4 text-sm lg:text-base",children:["Members (",x.length,")"]}),e.jsxs("div",{className:"relative",children:[e.jsx(tt,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search members...",value:Y,onChange:t=>De(t.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-slate-700/50 border border-slate-600/30 rounded-xl text-sm text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500/50 transition-all"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent",children:[e.jsxs("div",{className:"p-3 lg:p-4",children:[e.jsxs("p",{className:"text-[10px] lg:text-xs font-semibold text-emerald-400 uppercase tracking-wider mb-3 px-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-pulse"}),"Online — ",se]}),fe.filter(t=>L.includes(t.user.id)).map(t=>{const s=Se(t.role);return e.jsxs("div",{className:"flex items-center gap-3 p-2.5 lg:p-3 rounded-xl hover:bg-slate-700/50 transition-all duration-200 cursor-pointer group",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:`w-9 h-9 lg:w-10 lg:h-10 rounded-xl bg-gradient-to-br ${P(t.user.name)} flex items-center justify-center text-white text-xs lg:text-sm font-semibold shadow-lg ring-2 ring-white/10 group-hover:ring-white/20 transition-all`,children:t.user.avatar?e.jsx("img",{src:t.user.avatar,alt:"",className:"w-full h-full rounded-xl object-cover"}):t.user.name.charAt(0).toUpperCase()}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-500 rounded-full border-2 border-slate-800 shadow-lg"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:t.user.name}),s&&e.jsx("span",{className:`px-1.5 py-0.5 ${s.bg} ${s.color} rounded-md text-[9px] lg:text-[10px] font-semibold flex-shrink-0`,children:s.label})]}),e.jsx("p",{className:"text-[10px] lg:text-xs text-slate-400 truncate",children:t.user.email})]})]},t.id)})]}),e.jsxs("div",{className:"p-3 lg:p-4 border-t border-slate-700/30",children:[e.jsxs("p",{className:"text-[10px] lg:text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3 px-2",children:["Offline — ",x.length-se]}),fe.filter(t=>!L.includes(t.user.id)).map(t=>{const s=Se(t.role);return e.jsxs("div",{className:"flex items-center gap-3 p-2.5 lg:p-3 rounded-xl hover:bg-slate-700/50 transition-all duration-200 cursor-pointer opacity-50 hover:opacity-70",children:[e.jsx("div",{className:"relative flex-shrink-0",children:e.jsx("div",{className:`w-9 h-9 lg:w-10 lg:h-10 rounded-xl bg-gradient-to-br ${P(t.user.name)} flex items-center justify-center text-white text-xs lg:text-sm font-semibold shadow-lg`,children:t.user.avatar?e.jsx("img",{src:t.user.avatar,alt:"",className:"w-full h-full rounded-xl object-cover"}):t.user.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:t.user.name}),s&&e.jsx("span",{className:`px-1.5 py-0.5 ${s.bg} ${s.color} rounded-md text-[9px] lg:text-[10px] font-semibold flex-shrink-0`,children:s.label})]}),e.jsx("p",{className:"text-[10px] lg:text-xs text-slate-400 truncate",children:t.user.email})]})]},t.id)})]})]})]}),j&&e.jsxs("div",{className:"fixed inset-0 bg-black/95 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:()=>H(null),children:[e.jsx("button",{onClick:()=>H(null),className:"absolute top-4 right-4 p-3 text-white hover:bg-white/10 rounded-xl z-10 transition-colors",children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"max-w-[90vw] max-h-[90vh]",onClick:t=>t.stopPropagation(),children:[j.type==="image"?e.jsx("img",{src:j.url,alt:j.filename,className:"max-w-full max-h-[85vh] object-contain rounded-xl shadow-2xl"}):j.type==="audio"?e.jsxs("div",{className:"bg-slate-800 rounded-xl p-8 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(B,{className:"text-purple-400",size:32})}),e.jsx("audio",{src:j.url,controls:!0,className:"w-64"})]}):e.jsx("video",{src:j.url,className:"max-w-full max-h-[85vh] rounded-xl shadow-2xl",controls:!0,autoPlay:!0}),e.jsx("p",{className:"text-center text-white/60 mt-3 text-sm",children:j.filename})]})]}),oe&&!T&&i&&c&&e.jsx(ct,{groupId:i.id,groupName:i.name,userName:c.name||"User",socket:h,members:x.map(t=>({id:t.user.id,name:t.user.name,avatar:t.user.avatar})),onlineUsers:L,onCallUser:t=>{const s=x.find(a=>a.user.id===t);s&&de({id:s.user.id,name:s.user.name,avatar:s.user.avatar})},onClose:()=>{R(!1),_(null)}}),T&&(O==null?void 0:O.connected)&&c&&e.jsx(st,{socket:O,currentUser:{id:c.id,name:c.name||"User",avatar:c.avatar||null},remoteUser:T,conversationId:`group-call-${i==null?void 0:i.id}-${T.id}`,isIncoming:!1,onClose:()=>{de(null),R(!1)}}),e.jsx(dt,{isOpen:Ie,onClose:()=>$(!1),onMediaCaptured:Le,mode:$e})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 flex items-center justify-center p-4 sm:p-6",children:e.jsxs("div",{className:"bg-slate-800/40 backdrop-blur-xl rounded-3xl shadow-2xl border border-slate-700/30 w-full max-w-md overflow-hidden",children:[e.jsxs("div",{className:"h-36 sm:h-40 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMiIvPjwvZz48L2c+PC9zdmc+')] opacity-50"}),e.jsx(ve,{to:"/groups",className:"absolute top-4 left-4 p-2.5 bg-black/20 backdrop-blur-md rounded-xl text-white hover:bg-black/30 transition-all duration-200 border border-white/10",children:e.jsx(we,{size:20})})]}),e.jsxs("div",{className:"p-6 sm:p-8 text-center -mt-10",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white text-2xl font-bold mx-auto shadow-2xl ring-4 ring-slate-800",children:e.jsx(ae,{size:32})}),e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mt-5 mb-2 text-white",children:i.name}),e.jsx("p",{className:"text-slate-400 mb-6 text-sm sm:text-base",children:i.description||"Join this community to start chatting!"}),e.jsx("div",{className:"flex items-center justify-center gap-4 text-sm text-slate-500 mb-8",children:e.jsxs("span",{className:"flex items-center gap-2 bg-slate-700/30 px-3 py-1.5 rounded-lg",children:[e.jsx(A,{className:"text-indigo-400"})," ",((be=i._count)==null?void 0:be.members)||0," members"]})}),e.jsx("button",{onClick:Ue,className:"w-full py-4 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white rounded-xl font-semibold hover:shadow-xl hover:shadow-indigo-500/25 transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]",children:"Join Group"})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-14 w-14 border-4 border-slate-700 border-t-indigo-500 mx-auto"}),e.jsx("div",{className:"absolute inset-0 animate-ping rounded-full h-14 w-14 border-4 border-indigo-500/20 mx-auto"})]}),e.jsx("p",{className:"text-slate-400 mt-4",children:"Loading group..."})]})})}export{bt as default};
