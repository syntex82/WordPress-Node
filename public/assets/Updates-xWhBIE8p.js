import{r as l,j as e}from"./vendor-react-D2QycniR.js";import{bU as d,S as n,bc as I,bV as g,ay as R,bW as te,af as ae,aB as E,bX as le,aM as f,aZ as w,v as y,ah as k,U as D,V as M,ae as z,bY as re,o as ie}from"./index-4Xu9g3kZ.js";import{f as ce}from"./vendor-utils-BWf5C302.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-socket-CA1CrNgP.js";function he(){var A,F;const[t,T]=l.useState(null),[C,V]=l.useState([]),[G,O]=l.useState(!0),[P,S]=l.useState(!1),[N,U]=l.useState(!1),[i,L]=l.useState(!1),[B,v]=l.useState([]),[H,m]=l.useState(!1),[W,h]=l.useState(!1),[r,$]=l.useState(null),[q,p]=l.useState(!1),[u,Y]=l.useState(null);l.useEffect(()=>{x(),b()},[]),l.useEffect(()=>{if(t!=null&&t.updateInProgress){const s=setInterval(x,2e3);return()=>clearInterval(s)}},[t==null?void 0:t.updateInProgress]);const x=async()=>{try{const s=await d.getStatus();T(s.data)}catch{}O(!1)},b=async()=>{try{const s=await d.getHistory(10);V(s.data)}catch{}},_=async()=>{S(!0);try{await d.checkForUpdates(),await x()}catch{}S(!1)},K=async s=>{Y(s);try{const a=await d.checkCompatibility(s);$(a.data),p(!0)}catch{}},X=async()=>{var s,a;if(u){U(!0),p(!1);try{await d.applyUpdate(u),await x(),await b(),alert("Update completed! Please restart the server to apply changes.")}catch(c){alert(((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.message)||"Update failed")}U(!1)}},Z=async s=>{var a,c;if(confirm("Are you sure you want to rollback this update? This will restore the previous version."))try{await d.rollback(s),await b(),alert("Rollback completed! Please restart the server.")}catch(j){alert(((c=(a=j.response)==null?void 0:a.data)==null?void 0:c.message)||"Rollback failed")}},J=async()=>{var s,a,c,j;m(!1),L(!0),v(["Starting update..."]);try{const o=await d.pullLatest();v(o.data.logs),h(!0),await x(),await b()}catch(o){const se=((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.logs)||[`Error: ${((j=(c=o.response)==null?void 0:c.data)==null?void 0:j.message)||o.message}`];v(se),h(!0)}L(!1)},Q=s=>{switch(s){case"COMPLETED":return e.jsx(E,{className:"text-emerald-400"});case"FAILED":return e.jsx(D,{className:"text-red-400"});case"ROLLED_BACK":return e.jsx(w,{className:"text-amber-400"});case"IN_PROGRESS":case"DOWNLOADING":case"APPLYING":case"MIGRATING":return e.jsx(n,{className:"text-blue-400 animate-spin"});default:return e.jsx(ie,{className:"text-slate-400"})}},ee=s=>{switch(s){case"COMPLETED":return"bg-emerald-500/20 text-emerald-400";case"FAILED":return"bg-red-500/20 text-red-400";case"ROLLED_BACK":return"bg-amber-500/20 text-amber-400";default:return"bg-blue-500/20 text-blue-400"}};return G?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(n,{className:"animate-spin text-violet-400",size:32})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(I,{size:24})}),"System Updates"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Manage CMS updates and version control"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>m(!0),disabled:i||N||(t==null?void 0:t.updateInProgress),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",title:"Pull latest code from GitHub main branch",children:[i?e.jsx(n,{className:"animate-spin"}):e.jsx(g,{}),"Pull Latest"]}),e.jsxs("button",{onClick:_,disabled:P||i,className:"px-4 py-2 bg-violet-600 hover:bg-violet-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",children:[P?e.jsx(n,{className:"animate-spin"}):e.jsx(R,{}),"Check for Releases"]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700/50 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-violet-500/20 rounded-xl",children:e.jsx(te,{className:"text-violet-400",size:28})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Current Version"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["v",(t==null?void 0:t.currentVersion)||"1.0.0"]})]})]}),(t==null?void 0:t.updateAvailable)&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-emerald-400",children:"New Version Available!"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:["v",t.latestVersion]})]}),e.jsxs("button",{onClick:()=>K(t.latestVersion),disabled:N||t.updateInProgress,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg flex items-center gap-2 disabled:opacity-50",children:[N?e.jsx(n,{className:"animate-spin"}):e.jsx(ae,{}),"Update Now"]})]})]}),((t==null?void 0:t.updateInProgress)||i)&&(t==null?void 0:t.currentProgress)&&e.jsxs("div",{className:"mt-6 p-4 bg-slate-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-300",children:t.currentProgress.message}),e.jsxs("span",{className:"text-violet-400",children:[t.currentProgress.progress,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${i?"bg-blue-500":"bg-violet-500"}`,style:{width:`${t.currentProgress.progress}%`}})})]}),i&&!(t!=null&&t.currentProgress)&&e.jsx("div",{className:"mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"animate-spin text-blue-400",size:20}),e.jsx("span",{className:"text-blue-400",children:"Pulling latest changes and rebuilding... This may take a few minutes."})]})}),!(t!=null&&t.updateAvailable)&&!(t!=null&&t.updateInProgress)&&!i&&e.jsxs("div",{className:"mt-4 p-3 bg-emerald-500/10 border border-emerald-500/30 rounded-lg flex items-center gap-2",children:[e.jsx(E,{className:"text-emerald-400"}),e.jsx("span",{className:"text-emerald-400",children:"You are running the latest version"})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700/50 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-700/50",children:e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(le,{className:"text-violet-400"}),"Update History"]})}),C.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500",children:[e.jsx(f,{size:48,className:"mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No update history yet"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Update"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700/50",children:C.map(s=>e.jsxs("tr",{className:"hover:bg-slate-700/20",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-slate-400",children:["v",s.fromVersion]}),e.jsx("span",{className:"text-slate-500",children:"→"}),e.jsxs("span",{className:"text-white font-medium",children:["v",s.toVersion]})]}),s.initiatedByUser&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["by ",s.initiatedByUser.name]})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs flex items-center gap-1 w-fit ${ee(s.status)}`,children:[Q(s.status),s.status]}),s.errorMessage&&e.jsx("p",{className:"text-xs text-red-400 mt-1 truncate max-w-xs",children:s.errorMessage})]}),e.jsx("td",{className:"px-6 py-4 text-slate-400 text-sm",children:ce(new Date(s.startedAt),{addSuffix:!0})}),e.jsx("td",{className:"px-6 py-4 text-right",children:s.status==="COMPLETED"&&!s.rolledBack&&e.jsx("button",{onClick:()=>Z(s.id),className:"text-slate-400 hover:text-amber-400 transition-colors",title:"Rollback",children:e.jsx(w,{size:16})})})]},s.id))})]})]}),q&&u&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white",children:["Update to v",u]}),e.jsx("button",{onClick:()=>p(!1),className:"text-slate-400 hover:text-white",children:e.jsx(y,{size:20})})]}),((A=r==null?void 0:r.warnings)==null?void 0:A.length)>0&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"text-amber-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 font-medium",children:"Warnings"}),e.jsx("ul",{className:"text-sm text-slate-400 mt-1 list-disc list-inside",children:r.warnings.map((s,a)=>e.jsx("li",{children:s},a))})]})]})}),((F=r==null?void 0:r.issues)==null?void 0:F.length)>0&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{className:"text-red-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-400 font-medium",children:"Compatibility Issues"}),e.jsx("ul",{className:"text-sm text-slate-400 mt-1 list-disc list-inside",children:r.issues.map((s,a)=>e.jsx("li",{children:s},a))})]})]})}),e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:"This update will:"}),e.jsxs("ul",{className:"text-sm text-slate-400 mt-2 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"text-emerald-400"})," Create a backup before updating"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-emerald-400"})," Run database migrations"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"text-emerald-400"})," Update application files"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"text-emerald-400"})," Allow rollback if needed"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:X,disabled:!(r!=null&&r.compatible),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg flex items-center gap-2 disabled:opacity-50",children:[e.jsx(I,{})," Apply Update"]})]})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(g,{className:"text-blue-400"}),"Pull Latest from GitHub"]}),e.jsx("button",{onClick:()=>m(!1),className:"text-slate-400 hover:text-white",children:e.jsx(y,{size:20})})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(k,{className:"text-blue-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-400 font-medium",children:"Development Update"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"This will pull the latest code from the main branch. Use this for quick bug fixes and development updates."})]})]})}),e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:"This update will:"}),e.jsxs("ul",{className:"text-sm text-slate-400 mt-2 space-y-1",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"text-emerald-400"})," Create a backup before updating"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"text-emerald-400"})," Pull latest code from GitHub"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"text-emerald-400"})," Install dependencies"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"text-emerald-400"})," Rebuild admin panel & backend"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"text-emerald-400"})," Apply database migrations"]})]})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-amber-400 text-sm flex items-center gap-2",children:[e.jsx(k,{}),"Server restart required after update completes"]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:J,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2",children:[e.jsx(g,{})," Pull & Update"]})]})]})}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 w-full max-w-2xl p-6 max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(re,{className:"text-blue-400"}),"Update Log"]}),e.jsx("button",{onClick:()=>h(!1),className:"text-slate-400 hover:text-white",children:e.jsx(y,{size:20})})]}),e.jsx("div",{className:"bg-slate-900 rounded-lg p-4 font-mono text-sm overflow-auto flex-1",children:B.map((s,a)=>e.jsx("div",{className:`${s.startsWith("✓")?"text-emerald-400":s.startsWith("✗")?"text-red-400":s.includes("Warning")?"text-amber-400":s.includes("═")||s.includes("Complete")?"text-green-400 font-bold":"text-slate-300"}`,children:s||" "},a))}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg",children:"Close"}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg flex items-center gap-2",children:[e.jsx(R,{})," Reload Page"]})]})]})})]})}export{he as default};
