import{r as a,j as e,L as le}from"./vendor-react-D2QycniR.js";import{as as Re,ab as ce,z as g,v as ie,f as Ne,X as ge,S as be,B as Ae,Y as ne,V as ke,u as Se,aa as $e,cg as Q,aV as fe,C as De,aK as Ve,aq as pe,ar as Oe,O as ze,ai as Ge,E as Ke,G as We,I as Ye,a2 as qe,J as Xe,K as _e,L as we,aX as Be}from"./index-DXwKa3Mi.js";import{M as Je}from"./MobileMediaRecorder-AX3OK7ei.js";import{P as ye}from"./CommentModal-vpSUZ_mT.js";import{f as je}from"./vendor-utils-BWf5C302.js";const ve={Smileys:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜™","ðŸ¥²","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜","ðŸ¤‘","ðŸ¤—","ðŸ¤­","ðŸ¤«","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ˜","ðŸ˜’","ðŸ™„","ðŸ˜¬","ðŸ¤¥","ðŸ˜Œ","ðŸ˜”","ðŸ˜ª","ðŸ¤¤","ðŸ˜´","ðŸ˜·"],Gestures:["ðŸ‘‹","ðŸ¤š","ðŸ–ï¸","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ–•","ðŸ‘‡","â˜ï¸","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²","ðŸ¤","ðŸ™","ðŸ’ª","ðŸ¦¾","ðŸ¦¿"],Hearts:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â£ï¸","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ","â™¥ï¸"],Objects:["ðŸŽ‰","ðŸŽŠ","ðŸŽˆ","ðŸŽ","ðŸ†","ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰","âš½","ðŸ€","ðŸˆ","âš¾","ðŸŽ¾","ðŸŽ®","ðŸŽ¯","ðŸŽ¨","ðŸŽ­","ðŸŽª","ðŸŽ¬","ðŸŽ¤","ðŸŽ§","ðŸŽ¸","ðŸŽ¹","ðŸŽº","ðŸŽ»","ðŸ“·","ðŸ“¹","ðŸ’»","ðŸ“±","âŒš","ðŸ’¡","ðŸ”¥","â­","ðŸŒŸ","âœ¨","ðŸ’«","ðŸŒˆ","â˜€ï¸","ðŸŒ™","âš¡","ðŸ’¥","ðŸ’¢","ðŸ’¦","ðŸ’¨"],Animals:["ðŸ¶","ðŸ±","ðŸ­","ðŸ¹","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯","ðŸ¦","ðŸ®","ðŸ·","ðŸ¸","ðŸµ","ðŸ”","ðŸ§","ðŸ¦","ðŸ¤","ðŸ¦†","ðŸ¦…","ðŸ¦‰","ðŸ¦‡","ðŸº","ðŸ—","ðŸ´","ðŸ¦„","ðŸ","ðŸ›","ðŸ¦‹","ðŸŒ","ðŸž"],Food:["ðŸŽ","ðŸ","ðŸŠ","ðŸ‹","ðŸŒ","ðŸ‰","ðŸ‡","ðŸ“","ðŸ«","ðŸˆ","ðŸ’","ðŸ‘","ðŸ¥­","ðŸ","ðŸ¥¥","ðŸ¥","ðŸ…","ðŸ¥‘","ðŸ†","ðŸ¥¦","ðŸ¥¬","ðŸŒ½","ðŸ¥•","ðŸ•","ðŸ”","ðŸŸ","ðŸŒ­","ðŸ¿","ðŸ§","ðŸ°","ðŸŽ‚","ðŸ©","ðŸª","ðŸ«","ðŸ¬","â˜•","ðŸµ","ðŸ§ƒ","ðŸº","ðŸ·","ðŸ¥¤"]};function Qe({onSelect:t,className:P=""}){const[o,f]=a.useState(!1),[x,$]=a.useState("Smileys"),N=a.useRef(null);a.useEffect(()=>{const d=p=>{N.current&&!N.current.contains(p.target)&&f(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const i=d=>{t(d),f(!1)};return e.jsxs("div",{ref:N,className:`relative ${P}`,children:[e.jsx("button",{type:"button",onClick:()=>f(!o),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-500 dark:text-gray-400 transition-colors",title:"Add emoji",children:e.jsx(Re,{className:"w-5 h-5"})}),o&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-72 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden",children:[e.jsx("div",{className:"flex overflow-x-auto border-b border-gray-200 dark:border-gray-700 p-1 gap-1 scrollbar-hide",children:Object.keys(ve).map(d=>e.jsx("button",{onClick:()=>$(d),className:`px-3 py-1.5 text-xs font-medium rounded-lg whitespace-nowrap transition-colors ${x===d?"bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:d},d))}),e.jsx("div",{className:"p-2 h-48 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-8 gap-1",children:ve[x].map((d,p)=>e.jsx("button",{onClick:()=>i(d),className:"w-8 h-8 flex items-center justify-center text-xl hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:d},p))})})]})]})}function Ze({isOpen:t,onClose:P,onSelect:o,multiple:f=!0,accept:x="all"}){const[$,N]=a.useState([]),[i,d]=a.useState(!1),[p,R]=a.useState(!1),[J,F]=a.useState(0),[w,T]=a.useState(new Set),[k,M]=a.useState(""),[A,y]=a.useState("library"),D=a.useRef(null);a.useEffect(()=>{t&&(V(),T(new Set))},[t]);const V=async()=>{d(!0);try{const n=x==="image"?"image":x==="video"?"video":void 0,b=await ce.getAll({limit:50,mimeType:n});N(b.data.data||[])}catch{g.error("Failed to load media")}finally{d(!1)}},E=async n=>{if(!(!n||n.length===0)){R(!0),F(0);try{const b=[];for(let j=0;j<n.length;j++){const G=n[j],K=await ce.upload(G,U=>{F(Math.round(j/n.length*100+U/n.length))});b.push({...K.data,path:K.data.url||K.data.path})}N(j=>[...b,...j]),g.success(`${n.length} file(s) uploaded`),y("library")}catch{g.error("Upload failed")}finally{R(!1),F(0)}}},O=n=>{const b=new Set(w);b.has(n)?b.delete(n):(f||b.clear(),b.add(n)),T(b)},q=()=>{const n=$.filter(b=>w.has(b.id));o(n),P()},z=$.filter(n=>n.originalName.toLowerCase().includes(k.toLowerCase())),X=()=>x==="image"?"image/*":x==="video"?"video/*":"image/*,video/*";return t?e.jsx("div",{className:"fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-0 sm:p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-t-2xl sm:rounded-2xl w-full sm:max-w-4xl h-[90vh] sm:h-auto sm:max-h-[85vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-slate-700 flex-shrink-0",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold text-white",children:"Media Library"}),e.jsx("button",{onClick:P,className:"p-2 hover:bg-slate-700 rounded-lg touch-manipulation min-w-[40px] min-h-[40px] flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"flex gap-2 p-3 sm:p-4 border-b border-slate-700 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>y("library"),className:`px-3 sm:px-4 py-2 rounded-lg font-medium transition touch-manipulation text-sm sm:text-base ${A==="library"?"bg-blue-600 text-white":"text-slate-400 hover:bg-slate-700"}`,children:[e.jsx(Ne,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),"Library"]}),e.jsxs("button",{onClick:()=>y("upload"),className:`px-3 sm:px-4 py-2 rounded-lg font-medium transition touch-manipulation text-sm sm:text-base ${A==="upload"?"bg-blue-600 text-white":"text-slate-400 hover:bg-slate-700"}`,children:[e.jsx(ge,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),"Upload"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4 min-h-0",children:A==="upload"?e.jsxs("div",{onClick:()=>{var n;return(n=D.current)==null?void 0:n.click()},onDragOver:n=>n.preventDefault(),onDrop:n=>{n.preventDefault(),E(n.dataTransfer.files)},className:"border-2 border-dashed border-slate-600 rounded-xl p-8 sm:p-12 text-center cursor-pointer hover:border-blue-500 transition touch-manipulation",children:[e.jsx("input",{ref:D,type:"file",accept:X(),multiple:f,onChange:n=>E(n.target.files),className:"hidden"}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsx(be,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto text-blue-500 animate-spin"}),e.jsxs("p",{className:"text-slate-400 text-sm sm:text-base",children:["Uploading... ",J,"%"]}),e.jsx("div",{className:"w-40 sm:w-48 mx-auto h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${J}%`}})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto text-slate-500 mb-3 sm:mb-4"}),e.jsx("p",{className:"text-slate-400 mb-2 text-sm sm:text-base",children:"Tap to select files"}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-500",children:"Images and videos"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-3 sm:mb-4",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",value:k,onChange:n=>M(n.target.value),placeholder:"Search media...",className:"w-full pl-10 pr-4 py-2 border border-slate-600 rounded-lg bg-slate-700 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base"})]}),i?e.jsx("div",{className:"flex items-center justify-center py-8 sm:py-12",children:e.jsx(be,{className:"w-6 h-6 sm:w-8 sm:h-8 text-blue-500 animate-spin"})}):z.length===0?e.jsx("div",{className:"text-center py-8 sm:py-12 text-slate-500 text-sm sm:text-base",children:"No media found"}):e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 sm:gap-3",children:z.map(n=>{var G;const b=(G=n.mimeType)==null?void 0:G.startsWith("video/"),j=w.has(n.id);return e.jsxs("div",{onClick:()=>O(n.id),className:`relative aspect-square rounded-lg overflow-hidden cursor-pointer border-2 transition touch-manipulation ${j?"border-blue-500 ring-2 ring-blue-500/30":"border-transparent hover:border-slate-500"}`,children:[b?e.jsx("div",{className:"w-full h-full bg-slate-700 flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 sm:w-8 sm:h-8 text-slate-400"})}):e.jsx("img",{src:n.path,alt:n.originalName,className:"w-full h-full object-cover"}),j&&e.jsx("div",{className:"absolute inset-0 bg-blue-500/30 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(ke,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})}),b&&e.jsx("div",{className:"absolute bottom-1 left-1 bg-black/70 text-white text-xs px-1 py-0.5 rounded",children:"Video"})]},n.id)})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2 sm:gap-0 p-3 sm:p-4 border-t border-slate-700 bg-slate-800/80 flex-shrink-0",children:[e.jsxs("span",{className:"text-xs sm:text-sm text-slate-400 text-center sm:text-left",children:[w.size," item",w.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx("button",{onClick:P,className:"flex-1 sm:flex-none px-4 py-2.5 sm:py-2 text-slate-400 hover:bg-slate-700 rounded-lg touch-manipulation text-sm sm:text-base",children:"Cancel"}),e.jsx("button",{onClick:q,disabled:w.size===0,className:"flex-1 sm:flex-none px-4 sm:px-6 py-2.5 sm:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation text-sm sm:text-base font-medium",children:"Insert"})]})]})]})}):null}function lt({onPostCreated:t}){var xe;const{resolvedTheme:P}=Se(),o=P==="dark",{user:f}=$e(),[x,$]=a.useState(""),[N,i]=a.useState(!0),[d,p]=a.useState([]),[R,J]=a.useState(!1),[F,w]=a.useState([]),T=a.useRef(null),k=a.useRef(null),[M,A]=a.useState(""),[y,D]=a.useState([]),[V,E]=a.useState(!1),[O,q]=a.useState(-1),[z,X]=a.useState(0),[n,b]=a.useState(!1),[j,G]=a.useState(!1),[K,U]=a.useState(!1),[ee,_]=a.useState(""),[W,re]=a.useState(!1),[r,I]=a.useState(0),[S,L]=a.useState(!1),[B,Y]=a.useState(!1),[te,se]=a.useState("video"),Z=a.useRef(null);a.useEffect(()=>{const s=l=>{Z.current&&!Z.current.contains(l.target)&&Y(!1)};if(B)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[B]),a.useEffect(()=>{if(!M||M.length<1){D([]),E(!1);return}const s=setTimeout(async()=>{b(!0);try{const l=await Q.searchUsersForMention(M);D(l.data),E(l.data.length>0),X(0)}catch{console.error("Error searching mentions")}finally{b(!1)}},300);return()=>clearTimeout(s)},[M]);const Ce=a.useCallback(s=>{const l=s.target.value,c=s.target.selectionStart;$(l);const m=l.slice(0,c),u=m.match(/@(\w*)$/);if(u){const v=u[1];A(v),q(m.length-u[0].length)}else A(""),E(!1)},[]),oe=a.useCallback(s=>{if(O<0)return;const l=x.slice(0,O),c=x.slice(O+M.length+1),m=`${l}@${s.username||s.name} ${c}`;$(m),E(!1),A(""),q(-1),setTimeout(()=>{if(k.current){const u=l.length+(s.username||s.name).length+2;k.current.focus(),k.current.setSelectionRange(u,u)}},0)},[x,M,O]),Me=a.useCallback(s=>{!V||y.length===0||(s.key==="ArrowDown"?(s.preventDefault(),X(l=>l<y.length-1?l+1:0)):s.key==="ArrowUp"?(s.preventDefault(),X(l=>l>0?l-1:y.length-1)):s.key==="Enter"&&V?(s.preventDefault(),oe(y[z])):s.key==="Escape"&&E(!1))},[V,y,z,oe]),Le=async s=>{const l=s.target.files;if(!l)return;const c=4-d.length,m=Array.from(l).slice(0,c);re(!0),I(0);try{for(let u=0;u<m.length;u++){const v=m[u],h=v.type.startsWith("video/"),C=v.type.startsWith("image/");if(!h&&!C){g.error("Only images and videos are supported");continue}const H=await ce.upload(v,ae=>{I(Math.round(u/m.length*100+ae/m.length))}),he=H.data.url||H.data.path;w(ae=>[...ae,he]);const Ue={type:h?"VIDEO":"IMAGE",url:he};p(ae=>[...ae,Ue])}}catch{g.error("Failed to upload media")}finally{re(!1),I(0)}T.current&&(T.current.value="")},Pe=s=>{var m;const l=((m=k.current)==null?void 0:m.selectionStart)||x.length,c=x.slice(0,l)+s+x.slice(l);$(c),setTimeout(()=>{if(k.current){const u=l+s.length;k.current.focus(),k.current.setSelectionRange(u,u)}},0)},Fe=s=>{var m;const l=4-d.length,c=s.slice(0,l);for(const u of c){const v=u.path||u.url,h=((m=u.mimeType)==null?void 0:m.startsWith("video/"))||/\.(mp4|webm|ogg|mov|avi|mkv|m4v)$/i.test(v);console.log("Media library item:",{url:v,mimeType:u.mimeType,isVideo:h}),w(C=>[...C,v]),p(C=>[...C,{type:h?"VIDEO":"IMAGE",url:v}])}},Te=s=>{if(d.length>=4){g.error("Maximum 4 media items allowed");return}const l="VIDEO";w(c=>[...c,s.url]),p(c=>[...c,{type:l,url:s.url,thumbnail:s.thumbnail}]),L(!1),g.success(`${s.type==="VIDEO"?"Video":"Audio"} added to post!`)},de=s=>{try{const l=new URL(s).hostname.toLowerCase();return l==="youtube.com"||l==="www.youtube.com"||l==="youtu.be"||l==="m.youtube.com"}catch{return!1}},me=s=>{try{const l=new URL(s).hostname.toLowerCase();return l==="vimeo.com"||l==="www.vimeo.com"||l==="player.vimeo.com"}catch{return!1}},ue=async()=>{if(!ee.trim())return;const s=ee.trim(),l=de(s),c=me(s),m=/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(s),u=/\.(mp4|webm|ogg|mov)$/i.test(s),v=l||c;if(d.length>=4){g.error("Maximum 4 media items allowed");return}if(m){w(h=>[...h,s]),p(h=>[...h,{type:"IMAGE",url:s}]),_(""),U(!1);return}if(u||v){w(h=>[...h,s]),p(h=>[...h,{type:"VIDEO",url:s}]),_(""),U(!1);return}try{const h=g.loading("Fetching link preview..."),C=await Q.fetchUrlPreview(s);g.dismiss(h),w(H=>[...H,s]),p(H=>[...H,{type:"LINK",url:s,thumbnail:C.data.image,linkTitle:C.data.title,linkDescription:C.data.description,linkSiteName:C.data.siteName}]),_(""),U(!1)}catch{g.error("Failed to fetch link preview"),w(h=>[...h,s]),p(h=>[...h,{type:"LINK",url:s}]),_(""),U(!1)}},Ee=s=>{URL.revokeObjectURL(F[s]),w(l=>l.filter((c,m)=>m!==s)),p(l=>l.filter((c,m)=>m!==s))},Ie=async()=>{var s,l;if(!x.trim()&&d.length===0){g.error("Please add some content or media");return}J(!0);try{const c={content:x.trim()||void 0,isPublic:N,media:d.length>0?d:void 0};console.log("Creating post with data:",c),await Q.createPost(c),g.success("Post created!"),$(""),p([]),w([]),t==null||t()}catch(c){console.error("Failed to create post:",c);const m=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||c.message||"Failed to create post";g.error(m)}finally{J(!1)}};return e.jsxs("div",{className:`backdrop-blur rounded-xl border p-3 sm:p-4 mb-4 sm:mb-6 ${o?"bg-slate-800/50 border-slate-700/50":"bg-white border-gray-200 shadow-sm"}`,children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[f!=null&&f.avatar?e.jsx("img",{src:f.avatar,alt:f.name,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm sm:text-lg flex-shrink-0",children:((xe=f==null?void 0:f.name)==null?void 0:xe.charAt(0))||"U"}),e.jsxs("div",{className:"flex-1 min-w-0 relative",children:[e.jsx("textarea",{ref:k,value:x,onChange:Ce,onKeyDown:Me,placeholder:"What's on your mind?",className:`w-full resize-none border-0 focus:ring-0 focus:outline-none bg-transparent text-sm sm:text-base ${o?"text-white placeholder-slate-400":"text-gray-900 placeholder-gray-400"}`,rows:2}),V&&e.jsx("div",{className:`absolute left-0 right-0 mt-1 rounded-lg shadow-lg border max-h-48 overflow-y-auto z-20 ${o?"bg-slate-700 border-slate-600":"bg-white border-gray-200"}`,children:n?e.jsx("div",{className:`px-3 py-2 text-sm ${o?"text-slate-400":"text-gray-500"}`,children:"Searching..."}):y.length===0?e.jsx("div",{className:`px-3 py-2 text-sm ${o?"text-slate-400":"text-gray-500"}`,children:"No users found"}):y.map((s,l)=>e.jsxs("button",{onClick:()=>oe(s),className:`w-full flex items-center gap-2 px-3 py-2 text-left ${o?"hover:bg-slate-600":"hover:bg-gray-100"} ${l===z?"bg-blue-600/30":""}`,children:[s.avatar?e.jsx("img",{src:s.avatar,alt:"",className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs sm:text-sm font-bold",children:s.name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`font-medium text-sm truncate ${o?"text-white":"text-gray-900"}`,children:s.name}),s.username&&e.jsxs("div",{className:`text-xs truncate ${o?"text-slate-400":"text-gray-500"}`,children:["@",s.username]})]})]},s.id))}),W&&e.jsx("div",{className:`mt-2 sm:mt-3 p-2 sm:p-3 rounded-lg ${o?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:`flex-1 h-1.5 sm:h-2 rounded-full overflow-hidden ${o?"bg-slate-700":"bg-gray-200"}`,children:e.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${r}%`}})}),e.jsxs("span",{className:"text-xs sm:text-sm text-blue-500 whitespace-nowrap",children:[r,"%"]})]})}),K&&e.jsxs("div",{className:"mt-2 sm:mt-3 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"url",value:ee,onChange:s=>_(s.target.value),placeholder:"Paste URL...",className:`flex-1 px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent ${o?"border-slate-600 bg-slate-700 text-white placeholder-slate-400":"border-gray-300 bg-white text-gray-900 placeholder-gray-400"}`,onKeyDown:s=>s.key==="Enter"&&ue()}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:ue,className:"flex-1 sm:flex-none px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Add"}),e.jsx("button",{onClick:()=>{U(!1),_("")},className:`p-2 rounded-lg ${o?"text-slate-400 hover:bg-slate-600":"text-gray-500 hover:bg-gray-100"}`,children:e.jsx(ie,{className:"w-5 h-5"})})]})]}),F.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 mt-2 sm:mt-3",children:F.map((s,l)=>{const c=d[l],m=(c==null?void 0:c.type)==="LINK",u=(c==null?void 0:c.type)==="VIDEO",v=de(s),h=me(s),C=v||h;return e.jsxs("div",{className:`relative ${m?"":"aspect-square"} rounded-lg overflow-hidden ${o?"bg-slate-700":"bg-gray-100"}`,children:[m?e.jsxs("div",{className:"p-2 sm:p-3",children:[c.thumbnail&&e.jsx("img",{src:c.thumbnail,alt:"",className:"w-full h-20 sm:h-24 object-cover rounded mb-2"}),e.jsx("div",{className:`text-xs font-medium truncate ${o?"text-slate-200":"text-gray-900"}`,children:c.linkTitle||new URL(s).hostname}),c.linkDescription&&e.jsx("div",{className:`text-xs mt-0.5 line-clamp-2 ${o?"text-slate-400":"text-gray-500"}`,children:c.linkDescription}),e.jsxs("div",{className:`text-xs mt-1 flex items-center gap-1 ${o?"text-slate-500":"text-gray-400"}`,children:[e.jsx(fe,{className:"w-3 h-3"}),c.linkSiteName||new URL(s).hostname]})]}):C?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-2 sm:p-4",children:[e.jsx(De,{className:"w-8 h-8 sm:w-10 sm:h-10 text-red-500 mb-1 sm:mb-2"}),e.jsx("span",{className:`text-xs text-center truncate w-full ${o?"text-slate-400":"text-gray-500"}`,children:v?"YouTube":"Vimeo"})]}):u?e.jsx("video",{src:s,className:"w-full h-full object-cover"}):e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>Ee(l),className:"absolute top-1 right-1 sm:top-2 sm:right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ie,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),u&&!C&&e.jsx("div",{className:"absolute bottom-1 left-1 sm:bottom-2 sm:left-2 bg-black/70 text-white text-xs px-1 sm:px-1.5 py-0.5 rounded",children:"Video"})]},l)})}),e.jsxs("div",{className:`flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-2 sm:gap-0 mt-3 sm:mt-4 pt-2 sm:pt-3 border-t ${o?"border-slate-700":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between sm:justify-start gap-0.5 sm:gap-1 flex-wrap",children:[e.jsx("input",{ref:T,type:"file",accept:"image/*,video/*",multiple:!0,onChange:Le,className:"hidden"}),e.jsx("button",{onClick:()=>{var s;return(s=T.current)==null?void 0:s.click()},disabled:d.length>=4||W,className:`p-1.5 sm:p-2 rounded-full disabled:opacity-50 transition-colors touch-manipulation ${o?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-500"}`,title:"Upload from device",children:e.jsx(Ne,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>{var s;return(s=T.current)==null?void 0:s.click()},disabled:d.length>=4||W,className:`p-1.5 sm:p-2 rounded-full disabled:opacity-50 transition-colors touch-manipulation hidden sm:block ${o?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-500"}`,title:"Upload video",children:e.jsx(ne,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:()=>G(!0),disabled:d.length>=4,className:`p-1.5 sm:p-2 rounded-full disabled:opacity-50 transition-colors touch-manipulation ${o?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-500"}`,title:"Choose from media library",children:e.jsx(Ve,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsxs("div",{className:"relative",ref:Z,children:[e.jsx("button",{onClick:()=>Y(!B),disabled:d.length>=4||W,className:`p-1.5 sm:p-2 rounded-full disabled:opacity-50 transition-colors touch-manipulation ${B?"text-purple-400 bg-purple-900/30":o?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-500"}`,title:"Record video, audio, or screen",children:e.jsx(pe,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),B&&e.jsxs("div",{className:`absolute bottom-full left-0 mb-2 py-2 rounded-xl shadow-xl border z-50 min-w-[160px] ${o?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}`,children:[e.jsxs("button",{onClick:()=>{se("video"),Y(!1),L(!0)},className:`w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors ${o?"hover:bg-slate-700 text-slate-200":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(ne,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Record Video"})]}),e.jsxs("button",{onClick:()=>{se("audio"),Y(!1),L(!0)},className:`w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors ${o?"hover:bg-slate-700 text-slate-200":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(pe,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Record Audio"})]}),e.jsxs("button",{onClick:()=>{se("screen"),Y(!1),L(!0)},className:`w-full flex items-center gap-3 px-4 py-2.5 text-left transition-colors ${o?"hover:bg-slate-700 text-slate-200":"hover:bg-gray-100 text-gray-700"}`,children:[e.jsx(Oe,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm font-medium",children:"Screen Recording"})]})]})]}),e.jsx("button",{onClick:()=>U(!K),disabled:d.length>=4,className:`p-1.5 sm:p-2 rounded-full disabled:opacity-50 transition-colors touch-manipulation ${K?"text-blue-400 bg-blue-900/30":o?"text-slate-400 hover:bg-slate-700":"text-gray-500 hover:bg-gray-100"}`,title:"Add URL",children:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx(Qe,{onSelect:Pe}),e.jsx("div",{className:`hidden sm:block w-px h-5 mx-1 ${o?"bg-slate-700":"bg-gray-200"}`}),e.jsxs("button",{onClick:()=>i(!N),className:`flex items-center gap-1 px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm transition-colors touch-manipulation ${N?"bg-green-900/30 text-green-400":o?"bg-slate-700 text-slate-400":"bg-gray-100 text-gray-500"}`,children:[N?e.jsx(ze,{className:"w-3 h-3 sm:w-4 sm:h-4"}):e.jsx(Ge,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:N?"Public":"Private"})]}),d.length>0&&e.jsxs("span",{className:`text-xs ml-1 sm:ml-2 ${o?"text-slate-500":"text-gray-400"}`,children:[d.length,"/4"]})]}),e.jsx("button",{onClick:Ie,disabled:R||W||!x.trim()&&d.length===0,className:"w-full sm:w-auto px-4 sm:px-6 py-2 bg-blue-600 text-white rounded-lg sm:rounded-full font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation text-sm sm:text-base",children:R?"Posting...":W?"Uploading...":"Post"})]})]})]}),e.jsx(Ze,{isOpen:j,onClose:()=>G(!1),onSelect:Fe,multiple:!0,accept:"all"}),e.jsx(Je,{isOpen:S,onClose:()=>L(!1),onMediaCaptured:Te,mode:te})]})}function rt({post:t,onDelete:P,onEdit:o,onCommentClick:f,onHashtagClick:x,onPostShared:$}){const{resolvedTheme:N}=Se(),i=N==="dark",{user:d}=$e(),[p,R]=a.useState(t.isLiked),[J,F]=a.useState(t.likesCount),[w,T]=a.useState(t.sharesCount),[k,M]=a.useState(!1),[A,y]=a.useState(!1),[D,V]=a.useState(""),[E,O]=a.useState(!1),[q,z]=a.useState(!1),[X,n]=a.useState(!1);a.useEffect(()=>{R(t.isLiked),F(t.likesCount),T(t.sharesCount)},[t.id,t.isLiked,t.likesCount,t.sharesCount]);const b=(d==null?void 0:d.id)===t.user.id,j=!!t.originalPost,G=`${window.location.origin}/post/${t.id}`,K=async()=>{try{await navigator.clipboard.writeText(G),n(!0),g.success("Link copied!"),setTimeout(()=>n(!1),2e3)}catch{g.error("Failed to copy link")}},U=async()=>{if(!E){O(!0);try{p?(await Q.unlikePost(t.id),R(!1),F(r=>Math.max(0,r-1))):(await Q.likePost(t.id),R(!0),F(r=>r+1))}catch{g.error("Failed to update like")}finally{O(!1)}}},ee=async()=>{var r,I;if(confirm("Are you sure you want to delete this post?"))try{await Q.deletePost(t.id),g.success("Post deleted"),P==null||P(t.id)}catch(S){console.error("Failed to delete post:",S);const L=((I=(r=S.response)==null?void 0:r.data)==null?void 0:I.message)||S.message||"Failed to delete post";g.error(L)}},_=async()=>{if(!q){z(!0);try{console.log("Sharing post:",t.id,"with comment:",D.trim()||"(none)");const r=await Q.sharePost(t.id,D.trim()||void 0);console.log("Share response:",r.data),T(I=>I+1),y(!1),V(""),g.success("Post shared!"),$==null||$(r.data)}catch(r){console.error("Failed to share post:",r),g.error("Failed to share post")}finally{z(!1)}}},W=a.useCallback(r=>r?r.split(/(#\w+|@\w+)/g).map((S,L)=>{var B;if(S.startsWith("#")){const Y=S.slice(1);return e.jsx("button",{onClick:()=>x==null?void 0:x(Y),className:`hover:underline font-medium ${i?"text-purple-400":"text-purple-600"}`,children:S},L)}if(S.startsWith("@")){const Y=S.slice(1),te=(B=t.mentions)==null?void 0:B.find(se=>{var Z;return((Z=se.username)==null?void 0:Z.toLowerCase())===Y.toLowerCase()});return te?e.jsx(le,{to:`/profile/${te.username||te.id}`,className:`hover:underline font-medium ${i?"text-blue-400":"text-blue-600"}`,children:S},L):e.jsx("span",{className:i?"text-blue-400":"text-blue-600",children:S},L)}return e.jsx(a.Fragment,{children:S},L)}):null,[t.mentions,x,i]),re=()=>!t.media||t.media.length===0?null:e.jsx("div",{className:"-mx-3 sm:mx-0 mt-3",children:e.jsx(ye,{media:t.media.map(r=>({id:r.id,type:r.type,url:r.url,thumbnail:r.thumbnail,altText:r.altText,width:r.width,height:r.height,duration:r.duration,linkTitle:r.linkTitle,linkDescription:r.linkDescription,linkSiteName:r.linkSiteName})),className:"sm:rounded-xl",immersive:!0})});return e.jsxs("div",{className:`rounded-none sm:rounded-xl shadow-none sm:shadow-sm p-3 sm:p-4 mb-0 sm:mb-4 ${i?"bg-slate-800":"bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(le,{to:`/admin/profile/${t.user.username||t.user.id}`,children:t.user.avatar?e.jsx("img",{src:t.user.avatar,alt:t.user.name,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-base sm:text-lg",children:t.user.name.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(le,{to:`/admin/profile/${t.user.username||t.user.id}`,className:`font-semibold hover:underline text-sm sm:text-base block truncate ${i?"text-white":"text-gray-900"}`,children:t.user.name}),t.user.headline&&e.jsx("p",{className:`text-xs sm:text-sm line-clamp-1 ${i?"text-slate-400":"text-gray-500"}`,children:t.user.headline}),e.jsx("p",{className:`text-xs ${i?"text-slate-500":"text-gray-400"}`,children:je(new Date(t.createdAt),{addSuffix:!0})})]})]}),b&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>M(!k),className:`p-2 rounded-full ${i?"hover:bg-slate-700":"hover:bg-gray-100"}`,children:e.jsx(Ke,{className:`w-5 h-5 ${i?"text-slate-400":"text-gray-500"}`})}),k&&e.jsxs("div",{className:`absolute right-0 mt-1 w-48 rounded-lg shadow-lg border z-10 ${i?"bg-slate-700 border-slate-600":"bg-white border-gray-200"}`,children:[!j&&o&&e.jsxs("button",{onClick:()=>{M(!1),o(t)},className:`w-full flex items-center gap-2 px-4 py-2 ${i?"text-slate-200 hover:bg-slate-600":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(We,{className:"w-4 h-4"}),"Edit Post"]}),e.jsxs("button",{onClick:()=>{M(!1),ee()},className:`w-full flex items-center gap-2 px-4 py-2 text-red-500 ${i?"hover:bg-slate-600":"hover:bg-gray-100"}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),"Delete Post"]})]})]})]}),j&&e.jsxs("div",{className:`mt-2 flex items-center gap-2 text-sm ${i?"text-slate-400":"text-gray-500"}`,children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Shared a post"})]}),t.shareComment&&e.jsx("p",{className:`mt-3 whitespace-pre-wrap ${i?"text-slate-200":"text-gray-800"}`,children:W(t.shareComment)}),j&&t.originalPost&&e.jsxs("div",{className:`mt-3 border rounded-xl p-4 ${i?"border-slate-700 bg-slate-900/50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(le,{to:`/profile/${t.originalPost.user.username||t.originalPost.user.id}`,children:t.originalPost.user.avatar?e.jsx("img",{src:t.originalPost.user.avatar,alt:t.originalPost.user.name,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm",children:t.originalPost.user.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx(le,{to:`/profile/${t.originalPost.user.username||t.originalPost.user.id}`,className:`font-semibold text-sm hover:underline ${i?"text-white":"text-gray-900"}`,children:t.originalPost.user.name}),e.jsx("p",{className:`text-xs ${i?"text-slate-500":"text-gray-400"}`,children:je(new Date(t.originalPost.createdAt),{addSuffix:!0})})]})]}),t.originalPost.content&&e.jsx("p",{className:`whitespace-pre-wrap text-sm ${i?"text-slate-200":"text-gray-800"}`,children:t.originalPost.content}),t.originalPost.media&&t.originalPost.media.length>0&&e.jsx("div",{className:"mt-3 -mx-2",children:e.jsx(ye,{media:t.originalPost.media.map(r=>({id:r.id,type:r.type,url:r.url,thumbnail:r.thumbnail,altText:r.altText,width:r.width,height:r.height,duration:r.duration})),className:"rounded-lg",immersive:!1})})]}),t.content&&!j&&e.jsx("p",{className:`mt-3 whitespace-pre-wrap ${i?"text-slate-200":"text-gray-800"}`,children:W(t.content)}),re(),e.jsxs("div",{className:`mt-4 flex items-center gap-6 pt-3 border-t ${i?"border-slate-700":"border-gray-200"}`,children:[e.jsxs("button",{onClick:U,disabled:E,className:`flex items-center gap-2 transition-colors ${p?"text-red-500":`${i?"text-slate-400":"text-gray-500"} hover:text-red-500`}`,children:[e.jsx(Xe,{className:`w-5 h-5 ${p?"fill-current":""}`}),e.jsx("span",{className:"text-sm",children:J})]}),e.jsxs("button",{onClick:()=>f==null?void 0:f(t.id,t),className:`flex items-center gap-2 transition-colors ${i?"text-slate-400":"text-gray-500"} hover:text-blue-500`,children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:t.commentsCount})]}),e.jsxs("button",{onClick:()=>y(!0),className:`flex items-center gap-2 transition-colors ${t.isShared?"text-green-500":`${i?"text-slate-400":"text-gray-500"} hover:text-green-500`}`,children:[e.jsx(we,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:w})]})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>y(!1),children:e.jsxs("div",{className:`rounded-xl shadow-xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto ${i?"bg-slate-800":"bg-white"}`,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:`text-lg font-semibold ${i?"text-white":"text-gray-900"}`,children:"Share Post"}),e.jsx("button",{onClick:()=>y(!1),className:`p-2 rounded-full ${i?"hover:bg-slate-700 text-slate-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:`border rounded-lg p-4 mb-4 ${i?"border-slate-700 bg-slate-900/50":"border-gray-200 bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.user.avatar?e.jsx("img",{src:t.user.avatar,alt:"",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold",children:t.user.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("span",{className:`font-medium block ${i?"text-white":"text-gray-900"}`,children:t.user.name}),t.user.headline&&e.jsx("span",{className:`text-xs ${i?"text-slate-400":"text-gray-500"}`,children:t.user.headline})]})]}),t.content&&e.jsx("p",{className:`text-sm mb-3 ${i?"text-slate-300":"text-gray-700"}`,children:t.content.length>200?`${t.content.slice(0,200)}...`:t.content}),t.media&&t.media.length>0&&e.jsx("div",{className:"flex gap-2 flex-wrap",children:t.media.slice(0,4).map((r,I)=>e.jsxs("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden bg-slate-700",children:[r.type==="VIDEO"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.thumbnail||r.url,alt:"",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40",children:e.jsx(ne,{className:"w-5 h-5 text-white"})})]}):e.jsx("img",{src:r.url,alt:r.altText||"",className:"w-full h-full object-cover"}),I===3&&t.media.length>4&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 text-white font-medium text-sm",children:["+",t.media.length-4]})]},r.id))})]}),e.jsxs("button",{onClick:K,className:`w-full mb-4 py-3 rounded-lg flex items-center justify-center gap-2 transition-colors ${i?"bg-slate-700 hover:bg-slate-600 text-slate-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[X?e.jsx(ke,{className:"w-4 h-4 text-green-500"}):e.jsx(Be,{className:"w-4 h-4"}),X?"Link Copied!":"Copy Link"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:`text-sm font-medium mb-2 block ${i?"text-slate-300":"text-gray-700"}`,children:"Share to your timeline"}),e.jsx("textarea",{value:D,onChange:r=>V(r.target.value),placeholder:"Add a comment to share with your followers...",className:`w-full p-3 border rounded-lg resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent ${i?"border-slate-700 bg-slate-900 text-white placeholder-slate-400":"border-gray-300 bg-white text-gray-900 placeholder-gray-400"}`,rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>y(!1),className:`px-4 py-2 rounded-lg ${i?"text-slate-400 hover:bg-slate-700":"text-gray-600 hover:bg-gray-100"}`,children:"Cancel"}),e.jsxs("button",{onClick:_,disabled:q,className:"px-5 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 flex items-center gap-2 font-medium transition-all",children:[e.jsx(we,{className:"w-4 h-4"}),q?"Sharing...":"Share to Timeline"]})]})]})})]})}export{lt as C,rt as P};
