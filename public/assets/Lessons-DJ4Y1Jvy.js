import{h as ne,a as de,r as l,j as e,L as V}from"./vendor-react-D2QycniR.js";import{c9 as u,aW as ce,M as ue,Y as w,A as y,G as Y,I as xe,c as me,P as he,V as pe,X as W,aV as be,z as r,aa as fe}from"./index-DAV1T9UC.js";import ge from"./RichTextEditor-tYjeviOU.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";import"./MediaPickerModal-BgsFM5I7.js";function ze(){var O,$;const{courseId:i}=ne(),G=de(),[k,H]=l.useState(null),[S,Z]=l.useState([]),[X,J]=l.useState(!0),[E,z]=l.useState(!1),[t,b]=l.useState(null),[A,M]=l.useState(!1),[q,C]=l.useState(0),[K,f]=l.useState(!1),[o,_]=l.useState(null),[g,I]=l.useState(""),[U,F]=l.useState("YOUTUBE"),[L,R]=l.useState(!1),[j,v]=l.useState(!1),[T,Q]=l.useState(null),D=l.useRef(null);l.useEffect(()=>{const s=a=>{if(E&&j)return a.preventDefault(),a.returnValue="",""};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[E,j]),l.useEffect(()=>{m()},[i]);const m=async()=>{try{const[s,a]=await Promise.all([u.getCourse(i),u.getLessons(i)]);H(s.data),Z(a.data)}catch(s){console.error("Failed to load data:",s)}finally{J(!1)}},ee=async()=>{var s,a,x;if(!((s=t==null?void 0:t.title)!=null&&s.trim())){r.error("Lesson title is required");return}R(!0);try{t.id?(await u.updateLesson(i,t.id,t),r.success("Lesson updated successfully!")):(await u.createLesson(i,t),r.success("Lesson created successfully!")),v(!1),z(!1),b(null),m()}catch(h){console.error("Failed to save lesson:",h);const c=((x=(a=h.response)==null?void 0:a.data)==null?void 0:x.message)||"Failed to save lesson";r.error(Array.isArray(c)?c.join(", "):c)}finally{R(!1)}},se=async s=>{if(confirm("Delete this lesson? This action cannot be undone."))try{await u.deleteLesson(i,s),r.success("Lesson deleted"),m()}catch(a){console.error("Failed to delete lesson:",a),r.error("Failed to delete lesson")}},P=s=>{b(s||{title:"",type:"VIDEO",content:"",isPreview:!1,isRequired:!0}),v(!1),z(!0)},d=l.useCallback(s=>{b(a=>a?{...a,...s}:null),v(!0)},[]),te=()=>{j&&!confirm("You have unsaved changes. Are you sure you want to close?")||(v(!1),z(!1),b(null))},ae=s=>{_(s),I(""),F("YOUTUBE"),f(!0)},le=async s=>{Q(s.id);try{const x=(await u.createQuiz(i,{title:s.title,description:s.content||"",isRequired:s.isRequired??!0,lessonId:s.id})).data;r.success("Quiz created! Redirecting to add questions..."),G(`/lms/courses/${i}/quizzes/${x.id}/questions`)}catch(a){console.error("Failed to create quiz:",a),r.error("Failed to create quiz"),Q(null)}},re=async s=>{var h;const a=(h=s.target.files)==null?void 0:h[0];if(!a||!o)return;if(!a.type.startsWith("video/")){r.error("Please select a video file");return}const x=500*1024*1024;if(a.size>x){r.error("Video must be less than 500MB");return}M(!0),C(0);try{const c=new FormData;c.append("video",a);const n=new XMLHttpRequest;n.upload.addEventListener("progress",p=>{if(p.lengthComputable){const N=Math.round(p.loaded/p.total*100);C(N)}}),await new Promise((p,N)=>{n.onload=()=>{n.status>=200&&n.status<300?p(JSON.parse(n.responseText)):N(new Error("Upload failed"))},n.onerror=()=>N(new Error("Upload failed"));const B=fe.getState().token;n.open("POST",`/api/lms/admin/courses/${i}/lessons/${o.id}/upload-video`),B&&n.setRequestHeader("Authorization",`Bearer ${B}`),n.send(c)}),r.success("Video uploaded successfully"),f(!1),m()}catch(c){console.error("Upload failed:",c),r.error("Failed to upload video")}finally{M(!1),C(0)}},ie=async()=>{if(!(!g||!o))try{await u.attachExternalVideo(i,o.id,{provider:U,url:g}),r.success("Video attached successfully"),f(!1),m()}catch(s){console.error("Failed to attach video:",s),r.error("Failed to attach video")}},oe=s=>({VIDEO:"ðŸŽ¬",ARTICLE:"ðŸ“„",QUIZ:"â“",ASSIGNMENT:"ðŸ“"})[s]||"ðŸ“„";return X?e.jsx("div",{className:"p-4 md:p-6 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-slate-700 border-t-blue-500"})}):e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(V,{to:"/lms/courses",className:"text-blue-400 hover:text-blue-300 text-sm transition-colors",children:"â† Back to Courses"}),e.jsxs("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent line-clamp-2",children:[k==null?void 0:k.title," - Lessons"]})]}),e.jsx("button",{onClick:()=>P(),className:"w-full sm:w-auto bg-gradient-to-r from-blue-600 to-blue-500 text-white px-4 py-2.5 rounded-xl hover:from-blue-700 hover:to-blue-600 shadow-lg shadow-blue-500/20 transition-all",children:"Add Lesson"})]}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50",children:S.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"No lessons yet. Add your first lesson!"}):e.jsx("ul",{className:"divide-y divide-slate-700/50",children:S.map(s=>{var a;return e.jsxs("li",{className:"p-3 md:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-3 hover:bg-slate-700/30 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 min-w-0",children:[e.jsx("span",{className:"text-slate-500 w-6 md:w-8 cursor-move hidden sm:block",children:e.jsx(ce,{className:"opacity-0 group-hover:opacity-100"})}),e.jsx("span",{className:"text-xl md:text-2xl",children:oe(s.type)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium flex flex-wrap items-center gap-2 text-white",children:[e.jsx("span",{className:"truncate",children:s.title}),s.isPreview&&e.jsxs("span",{className:"text-xs bg-green-500/20 text-green-400 px-2 py-0.5 rounded whitespace-nowrap",children:[e.jsx(ue,{className:"inline mr-1"}),"Preview"]})]}),e.jsxs("div",{className:"text-sm text-slate-400 flex flex-wrap items-center gap-2",children:[e.jsx("span",{children:s.type}),s.estimatedMinutes&&e.jsxs("span",{children:["â€¢ ",s.estimatedMinutes," min"]}),s.type==="VIDEO"&&e.jsxs("span",{className:`flex items-center gap-1 ${s.videoAsset?"text-green-400":"text-orange-400"}`,children:[e.jsx(w,{}),e.jsx("span",{className:"hidden sm:inline",children:s.videoAsset?"Video attached":"No video"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto sm:ml-0",children:[s.type==="VIDEO"&&e.jsx("button",{onClick:()=>ae(s),className:"p-2 text-purple-400 hover:bg-purple-500/20 rounded-xl transition-colors",title:"Manage Video",children:e.jsx(w,{})}),s.type==="QUIZ"&&((a=s.quiz)!=null&&a.id?e.jsx(V,{to:`/lms/courses/${i}/quizzes/${s.quiz.id}/questions`,className:"p-2 text-amber-400 hover:bg-amber-500/20 rounded-xl transition-colors",title:"Manage Questions",children:e.jsx(y,{})}):e.jsx("button",{onClick:()=>le(s),disabled:T===s.id,className:"p-2 text-amber-400 hover:bg-amber-500/20 rounded-xl transition-colors disabled:opacity-50",title:"Create Quiz & Add Questions",children:T===s.id?e.jsx("span",{className:"animate-spin",children:"â³"}):e.jsx(y,{})})),e.jsx("button",{onClick:()=>P(s),className:"p-2 text-blue-400 hover:bg-blue-500/20 rounded-xl transition-colors",title:"Edit Lesson",children:e.jsx(Y,{})}),e.jsx("button",{onClick:()=>se(s.id),className:"p-2 text-red-400 hover:bg-red-500/20 rounded-xl transition-colors",title:"Delete Lesson",children:e.jsx(xe,{})})]})]},s.id)})})}),E&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700/50 p-4 md:p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white",children:t.id?"Edit Lesson":"Add Lesson"}),j&&e.jsxs("span",{className:"flex items-center gap-1 text-amber-400 text-sm",children:[e.jsx("span",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"}),e.jsx("span",{className:"hidden sm:inline",children:"Unsaved changes"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-300",children:"Title *"}),e.jsx("input",{type:"text",value:t.title||"",onChange:s=>d({title:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter lesson title..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-300",children:"Type"}),e.jsxs("select",{value:t.type,onChange:s=>d({type:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"VIDEO",children:"Video"}),e.jsx("option",{value:"ARTICLE",children:"Article"}),e.jsx("option",{value:"QUIZ",children:"Quiz"}),e.jsx("option",{value:"ASSIGNMENT",children:"Assignment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-300",children:"Duration (minutes)"}),e.jsx("input",{type:"number",value:t.estimatedMinutes||"",onChange:s=>d({estimatedMinutes:parseInt(s.target.value)||void 0}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",min:"0",placeholder:"e.g., 15"})]})]}),t.type==="VIDEO"&&e.jsxs("div",{className:"bg-slate-700/30 rounded-xl p-4 border border-slate-600/50",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-300",children:"Video Content"}),e.jsx("p",{className:"text-slate-400 text-sm mb-3",children:"Save the lesson first, then use the video icon to upload or attach a video."}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-dashed border-slate-500/50 text-center",children:[e.jsx(w,{className:"mx-auto text-3xl text-purple-400 mb-2"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Video will be attached after saving"})]})]}),t.type==="ARTICLE"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-300",children:"Article Content"}),e.jsx(ge,{content:t.content||"",onChange:s=>d({content:s}),placeholder:"Write your article content here..."})]}),t.type==="QUIZ"&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-500/10 to-orange-500/10 rounded-xl p-4 border border-amber-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/20 rounded-lg",children:e.jsx(me,{className:"text-amber-400",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white",children:"Quiz Lesson"}),e.jsx("p",{className:"text-slate-400 text-sm",children:t.id?"Quiz is automatically created. Add questions after saving.":"A quiz will be auto-created when you save this lesson."})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-600/50",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-300",children:"Quiz Instructions (optional)"}),e.jsx("textarea",{value:t.content||"",onChange:s=>d({content:s.target.value}),rows:3,className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-amber-500/50 resize-none",placeholder:"Enter instructions for students before they start the quiz..."})]}),t.id&&((O=t.quiz)!=null&&O.id)?e.jsxs(V,{to:`/lms/courses/${i}/quizzes/${t.quiz.id}/questions`,className:"mt-3 inline-flex items-center gap-2 bg-gradient-to-r from-amber-600 to-orange-500 text-white px-4 py-2 rounded-xl hover:from-amber-700 hover:to-orange-600 transition-colors shadow-lg shadow-amber-500/20",children:[e.jsx(y,{size:14})," Manage Quiz Questions"]}):e.jsxs("p",{className:"text-amber-400/80 text-xs mt-3 flex items-center gap-1",children:[e.jsx(y,{size:12}),' Save lesson first, then click "Manage Questions" to add quiz questions']})]}),t.type==="ASSIGNMENT"&&e.jsxs("div",{className:"bg-gradient-to-br from-emerald-500/10 to-teal-500/10 rounded-xl p-4 border border-emerald-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:e.jsx(Y,{className:"text-emerald-400",size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white",children:"Assignment Lesson"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Students will submit their work for review"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-300",children:"Assignment Description"}),e.jsx("textarea",{value:t.content||"",onChange:s=>d({content:s.target.value}),rows:4,className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 resize-none",placeholder:"Describe what students need to do for this assignment..."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-3 border border-slate-600/50",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-emerald-500"}),"Allow file uploads"]})}),e.jsx("div",{className:"bg-slate-800/50 rounded-xl p-3 border border-slate-600/50",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-emerald-500"}),"Text submission"]})})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6 pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:t.isPreview,onChange:s=>d({isPreview:s.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500/50"}),e.jsx("span",{className:"text-sm",children:"Free Preview"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:t.isRequired,onChange:s=>d({isRequired:s.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500/50"}),e.jsx("span",{className:"text-sm",children:"Required for completion"})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 mt-6 pt-4 border-t border-slate-700/50",children:[e.jsx("button",{onClick:te,className:"w-full sm:w-auto px-4 py-2.5 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-colors",disabled:L,children:"Cancel"}),e.jsxs("button",{onClick:ee,disabled:L||!(($=t.title)!=null&&$.trim()),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-xl hover:from-blue-700 hover:to-blue-600 shadow-lg shadow-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx(he,{}),L?"Saving...":"Save Lesson"]})]})]})}),K&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700/50 p-4 md:p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2 text-white",children:[e.jsx(w,{className:"text-purple-400"})," Manage Video - ",o.title]}),o.videoAsset&&e.jsxs("div",{className:"mb-4 p-3 bg-green-500/10 border border-green-500/30 rounded-xl",children:[e.jsxs("p",{className:"text-green-400 flex items-center gap-2",children:[e.jsx(pe,{})," Video attached: ",o.videoAsset.provider||"Uploaded"]}),o.videoAsset.url&&e.jsx("p",{className:"text-sm text-slate-400 truncate",children:o.videoAsset.url})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center gap-2 text-slate-300",children:[e.jsx(W,{})," Upload Video File"]}),e.jsx("input",{ref:D,type:"file",accept:"video/*",onChange:re,className:"hidden"}),e.jsx("button",{onClick:()=>{var s;return(s=D.current)==null?void 0:s.click()},disabled:A,className:"w-full p-4 border-2 border-dashed border-slate-600/50 rounded-xl hover:border-purple-500 hover:bg-purple-500/10 transition-colors disabled:opacity-50",children:A?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-purple-400",children:["Uploading... ",q,"%"]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all",style:{width:`${q}%`}})})]}):e.jsxs("div",{className:"text-slate-400",children:[e.jsx(W,{className:"mx-auto text-2xl mb-2"}),e.jsx("p",{children:"Click to upload video (max 500MB)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"MP4, WebM, MOV"})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"font-medium mb-2 flex items-center gap-2 text-slate-300",children:[e.jsx(be,{})," Or Link External Video"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("select",{value:U,onChange:s=>F(s.target.value),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50",children:[e.jsx("option",{value:"YOUTUBE",children:"YouTube"}),e.jsx("option",{value:"VIMEO",children:"Vimeo"}),e.jsx("option",{value:"WISTIA",children:"Wistia"}),e.jsx("option",{value:"BUNNY",children:"Bunny.net"}),e.jsx("option",{value:"OTHER",children:"Other URL"})]}),e.jsx("input",{type:"url",value:g,onChange:s=>I(s.target.value),placeholder:"Paste video URL here...",className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500/50"}),e.jsx("button",{onClick:ie,disabled:!g,className:"w-full bg-gradient-to-r from-purple-600 to-purple-500 text-white py-2 rounded-xl hover:from-purple-700 hover:to-purple-600 shadow-lg shadow-purple-500/20 disabled:opacity-50 transition-all",children:"Attach External Video"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-colors",children:"Close"})})]})})]})}export{ze as default};
