import{h as Y,r as n,j as e,L as U}from"./vendor-react-D2QycniR.js";import{cf as N,z as g,bA as _,v as B,o as J,N as K,bq as O,V}from"./index-4Xu9g3kZ.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";function q(){var A;const{courseId:t,quizId:d}=Y(),[a,u]=n.useState(null),[r,b]=n.useState(null),[o,j]=n.useState([]),[h,y]=n.useState({}),[c,w]=n.useState(0),[x,v]=n.useState(null),[T,L]=n.useState(!0),[p,S]=n.useState(!1),[m,C]=n.useState(null),[P,z]=n.useState(!1);n.useEffect(()=>{Q()},[d]),n.useEffect(()=>{if(x===null||x<=0)return;const l=setInterval(()=>{v(s=>s&&s<=1?(k(),0):s?s-1:null)},1e3);return()=>clearInterval(l)},[x]);const Q=async()=>{var l,s;try{const{data:i}=await N.getQuiz(t,d);u(i)}catch(i){g.error(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to load quiz")}finally{L(!1)}},$=async()=>{var l,s;try{const{data:i}=await N.startQuiz(t,d);b(i.attempt),j(i.questions),v(i.timeLimitSeconds||null),z(!0)}catch(i){g.error(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to start quiz")}},k=n.useCallback(async()=>{var l,s;if(!(!r||p)){S(!0);try{const i=Object.entries(h).map(([R,E])=>({questionId:R,answer:E})),{data:F}=await N.submitQuiz(t,d,r.id,i);C(F),g.success(F.passed?"Congratulations! You passed!":"Quiz submitted")}catch(i){g.error(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to submit quiz")}finally{S(!1)}}},[r,h,t,d,p]),M=(l,s)=>y(i=>({...i,[l]:s})),I=l=>`${Math.floor(l/60)}:${(l%60).toString().padStart(2,"0")}`;if(T)return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-slate-700 border-t-blue-500"})});if(!a)return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center text-slate-400",children:"Quiz not found"});if(m)return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl md:rounded-2xl border border-slate-700/50 shadow-2xl p-4 md:p-8 max-w-lg w-full text-center",children:[e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 mx-auto rounded-full flex items-center justify-center mb-4 ${m.passed?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:m.passed?e.jsx(_,{className:"text-3xl md:text-4xl"}):e.jsx(B,{className:"text-3xl md:text-4xl"})}),e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white mb-2",children:m.passed?"Congratulations!":"Keep Trying!"}),e.jsx("p",{className:"text-slate-400 mb-4 md:mb-6 text-sm md:text-base",children:m.passed?"You passed the quiz!":"You did not pass this time."}),e.jsxs("div",{className:"text-4xl md:text-5xl font-bold text-white mb-2",children:[m.scorePercent.toFixed(0),"%"]}),e.jsxs("p",{className:"text-slate-500 mb-4 md:mb-6 text-sm md:text-base",children:[m.scorePoints," / ",m.maxPoints," points (Passing: ",m.passingScore,"%)"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 md:gap-4 justify-center",children:[e.jsx(U,{to:`/lms/learn/${t}`,className:"px-4 md:px-6 py-2.5 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 transition-colors text-sm md:text-base",children:"Back to Course"}),!m.passed&&a.attemptsRemaining!==0&&e.jsx("button",{onClick:()=>{C(null),z(!1),y({}),Q()},className:"px-4 md:px-6 py-2.5 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-xl hover:from-blue-700 hover:to-blue-600 transition-colors shadow-lg shadow-blue-500/20 text-sm md:text-base",children:"Try Again"})]})]})});if(!P)return e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl md:rounded-2xl border border-slate-700/50 shadow-2xl p-4 md:p-8 max-w-lg w-full",children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold text-white mb-2",children:a.title}),a.description&&e.jsx("p",{className:"text-slate-400 mb-4 md:mb-6 text-sm md:text-base",children:a.description}),e.jsxs("div",{className:"space-y-2 md:space-y-3 mb-4 md:mb-6 text-xs md:text-sm text-slate-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Questions:"}),e.jsx("span",{className:"font-medium text-white",children:((A=a.questions)==null?void 0:A.length)||0})]}),a.timeLimitSeconds&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Time Limit:"}),e.jsxs("span",{className:"font-medium text-white",children:[Math.floor(a.timeLimitSeconds/60)," min"]})]}),a.passingScorePercent&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Passing Score:"}),e.jsxs("span",{className:"font-medium text-white",children:[a.passingScorePercent,"%"]})]}),a.attemptsAllowed&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Attempts:"}),e.jsxs("span",{className:"font-medium text-white",children:[a.attemptsUsed||0," / ",a.attemptsAllowed]})]})]}),a.attemptsRemaining===0?e.jsx("p",{className:"text-red-400 text-center text-sm md:text-base",children:"You have used all attempts for this quiz."}):e.jsx("button",{onClick:$,className:"w-full bg-gradient-to-r from-blue-600 to-blue-500 text-white py-2.5 md:py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-blue-600 transition-colors shadow-lg shadow-blue-500/20 text-sm md:text-base",children:"Start Quiz"})]})});const f=o[c];return e.jsxs("div",{className:"min-h-screen bg-slate-900",children:[e.jsxs("header",{className:"bg-slate-800 border-b border-slate-700/50 sticky top-0 z-10",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-2 md:py-3 flex items-center justify-between gap-2",children:[e.jsx("h1",{className:"font-bold truncate text-white text-sm md:text-base",children:a.title}),x!==null&&e.jsxs("div",{className:`flex items-center gap-1 md:gap-2 px-2 md:px-3 py-1 rounded-full text-xs md:text-sm ${x<60?"bg-red-500/20 text-red-400":"bg-slate-700 text-slate-300"}`,children:[e.jsx(J,{})," ",I(x)]})]}),e.jsx("div",{className:"h-1 bg-slate-700",children:e.jsx("div",{className:"h-1 bg-blue-500 transition-all",style:{width:`${(c+1)/o.length*100}%`}})})]}),e.jsxs("main",{className:"max-w-3xl mx-auto p-4 md:p-6",children:[e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4 md:p-6 mb-4 md:mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4",children:[e.jsxs("span",{className:"text-xs md:text-sm text-slate-400",children:["Question ",c+1," of ",o.length]}),e.jsxs("span",{className:"text-xs md:text-sm text-slate-400",children:[f.points," pt",f.points!==1?"s":""]})]}),e.jsx("h2",{className:"text-base md:text-xl font-medium text-white mb-4 md:mb-6",children:f.prompt}),X(f,h,M)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-3",children:[e.jsxs("button",{onClick:()=>w(l=>Math.max(0,l-1)),disabled:c===0,className:"flex items-center justify-center gap-2 px-4 py-2.5 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 disabled:opacity-50 transition-colors text-sm",children:[e.jsx(K,{})," Previous"]}),e.jsx("div",{className:"flex gap-1 justify-center flex-wrap",children:o.map((l,s)=>e.jsx("button",{onClick:()=>w(s),className:`w-7 h-7 md:w-8 md:h-8 rounded-full text-xs md:text-sm transition-colors ${s===c?"bg-blue-500 text-white":h[o[s].id]!==void 0?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-400"}`,children:s+1},s))}),c<o.length-1?e.jsxs("button",{onClick:()=>w(l=>l+1),className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-xl hover:from-blue-700 hover:to-blue-600 transition-colors shadow-lg shadow-blue-500/20 text-sm",children:["Next ",e.jsx(O,{})]}):e.jsx("button",{onClick:k,disabled:p,className:"flex items-center justify-center gap-2 px-4 md:px-6 py-2.5 bg-gradient-to-r from-green-600 to-green-500 text-white rounded-xl hover:from-green-700 hover:to-green-600 disabled:opacity-50 transition-colors shadow-lg shadow-green-500/20 text-sm",children:p?"Submitting...":"Submit Quiz"})]})]})]})}function X(t,d,a){var u;return t.type==="MCQ"||t.type==="MCQ_MULTI"?e.jsx("div",{className:"space-y-3",children:(u=t.optionsJson)==null?void 0:u.map((r,b)=>{const o=t.type==="MCQ"?d[t.id]===r:(d[t.id]||[]).includes(r);return e.jsxs("button",{onClick:()=>t.type==="MCQ"?a(t.id,r):a(t.id,o?(d[t.id]||[]).filter(j=>j!==r):[...d[t.id]||[],r]),className:`w-full text-left p-4 rounded-xl border-2 transition-colors ${o?"border-blue-500 bg-blue-500/10 text-white":"border-slate-600/50 text-slate-300 hover:border-slate-500"}`,children:[e.jsx("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full mr-3 text-sm ${o?"bg-blue-500 text-white":"bg-slate-700 text-slate-400"}`,children:t.type==="MCQ"?String.fromCharCode(65+b):o?e.jsx(V,{}):""}),r]},b)})}):t.type==="TRUE_FALSE"?e.jsx("div",{className:"flex gap-4",children:["True","False"].map(r=>e.jsx("button",{onClick:()=>a(t.id,r==="True"),className:`flex-1 p-4 rounded-xl border-2 font-medium transition-colors ${d[t.id]===(r==="True")?"border-blue-500 bg-blue-500/10 text-white":"border-slate-600/50 text-slate-300 hover:border-slate-500"}`,children:r},r))}):e.jsx("textarea",{value:d[t.id]||"",onChange:r=>a(t.id,r.target.value),placeholder:"Type your answer...",rows:t.type==="ESSAY"?6:2,className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl p-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})}export{q as default};
