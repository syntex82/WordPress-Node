import{r as l,j as e}from"./vendor-react-D2QycniR.js";import{x as re,bC as n,ac as E,ae as f,S as u,ay as A,j as I,bm as $,aB as L,U as k,aZ as w,af as ie,I as ce,v as O,f as S,g as M,aM as C,V as U,o as ne}from"./index-JNkgy8O1.js";import{f as G}from"./vendor-utils-BWf5C302.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-socket-CA1CrNgP.js";function pe(){const s=re(),[P,H]=l.useState([]),[o,_]=l.useState(null),[Q,D]=l.useState(!0),[m,d]=l.useState(!1),[B,T]=l.useState(!1),[q,b]=l.useState(!1),[K,j]=l.useState(!1),[i,g]=l.useState(null),[c,z]=l.useState({restoreDatabase:!0,restoreMedia:!0,restoreThemes:!0,restorePlugins:!0}),[N,V]=l.useState(1),[F,W]=l.useState(1),[r,y]=l.useState({name:"",description:"",type:"FULL",includesDatabase:!0,includesMedia:!0,includesThemes:!0,includesPlugins:!0});l.useEffect(()=>{x(),p()},[N]);const x=async()=>{D(!0);try{const t=await n.getAll({page:N,limit:10});H(t.data.data),W(t.data.meta.totalPages)}catch{}D(!1)},p=async()=>{try{const t=await n.getStats();_(t.data)}catch{}},X=async()=>{d(!0);try{await n.quickBackup(),x(),p()}catch{}d(!1)},Y=async()=>{d(!0);try{await n.databaseBackup(),x(),p()}catch{}d(!1)},Z=async()=>{if(r.name.trim()){d(!0);try{await n.create(r),b(!1),y({name:"",description:"",type:"FULL",includesDatabase:!0,includesMedia:!0,includesThemes:!0,includesPlugins:!0}),x(),p()}catch{}d(!1)}},J=async t=>{if(confirm("Are you sure you want to delete this backup?"))try{await n.delete(t),x(),p()}catch{}},ee=t=>{g(t),z({restoreDatabase:t.includesDatabase,restoreMedia:t.includesMedia,restoreThemes:t.includesThemes,restorePlugins:t.includesPlugins}),j(!0)},se=async()=>{var t,a;if(i){T(!0);try{await n.restore(i.id,c),alert("Backup restored successfully! You may need to refresh the page to see changes."),j(!1),g(null)}catch(h){alert(((a=(t=h.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to restore backup")}T(!1)}},R=t=>{if(!t)return"-";const a=["B","KB","MB","GB"];let h=t,v=0;for(;h>=1024&&v<a.length-1;)h/=1024,v++;return`${h.toFixed(1)} ${a[v]}`},te=t=>{switch(t){case"COMPLETED":return e.jsx(L,{className:"text-emerald-400"});case"FAILED":return e.jsx(k,{className:"text-red-400"});case"IN_PROGRESS":return e.jsx(u,{className:"text-blue-400 animate-spin"});default:return e.jsx(ne,{className:"text-amber-400"})}},ae=t=>{switch(t){case"COMPLETED":return s.isDark?"bg-emerald-500/20 text-emerald-400":"bg-emerald-100 text-emerald-700";case"FAILED":return s.isDark?"bg-red-500/20 text-red-400":"bg-red-100 text-red-700";case"IN_PROGRESS":return s.isDark?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-700";default:return s.isDark?"bg-amber-500/20 text-amber-400":"bg-amber-100 text-amber-700"}},le=t=>{switch(t){case"DATABASE":return e.jsx(f,{className:"text-blue-400"});case"MEDIA":return e.jsx(S,{className:"text-purple-400"});case"THEMES":return e.jsx(M,{className:"text-pink-400"});case"PLUGINS":return e.jsx(C,{className:"text-amber-400"});default:return e.jsx($,{className:"text-violet-400"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`text-3xl font-bold ${s.textPrimary} flex items-center gap-3`,children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl text-white",children:e.jsx(E,{size:24})}),"Backups"]}),e.jsx("p",{className:`${s.textMuted} mt-1`,children:"Manage system backups and restore points"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Y,disabled:m,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",children:[e.jsx(f,{size:16}),"Database Only"]}),e.jsxs("button",{onClick:X,disabled:m,className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",children:[m?e.jsx(u,{className:"animate-spin",size:16}):e.jsx(A,{size:16}),"Quick Backup"]}),e.jsxs("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 text-white rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(I,{size:16}),"Custom Backup"]})]})]}),o&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Total Backups",value:o.total,icon:$,color:"violet"},{label:"Completed",value:o.completed,icon:L,color:"emerald"},{label:"Failed",value:o.failed,icon:k,color:"red"},{label:"In Progress",value:o.inProgress,icon:u,color:"blue"},{label:"Total Size",value:R(o.totalSize),icon:E,color:"purple"}].map((t,a)=>e.jsx("div",{className:`${s.bgCard} rounded-xl p-4 ${s.border} border`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${t.color}-500/20`,children:e.jsx(t.icon,{className:`text-${t.color}-400`,size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-2xl font-bold ${s.textPrimary}`,children:t.value}),e.jsx("p",{className:`text-sm ${s.textMuted}`,children:t.label})]})]})},a))}),e.jsxs("div",{className:`${s.bgCard} rounded-xl ${s.border} border overflow-hidden`,children:[e.jsxs("div",{className:`px-6 py-4 ${s.border} border-b flex items-center justify-between`,children:[e.jsx("h2",{className:`text-lg font-semibold ${s.textPrimary}`,children:"Backup History"}),e.jsx("button",{onClick:x,className:`${s.textMuted} hover:${s.textPrimary} transition-colors`,children:e.jsx(A,{size:18})})]}),Q?e.jsx("div",{className:"p-8 text-center",children:e.jsx(u,{className:"animate-spin text-violet-400 mx-auto",size:32})}):P.length===0?e.jsxs("div",{className:`p-8 text-center ${s.textMuted}`,children:[e.jsx($,{size:48,className:"mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No backups yet. Create your first backup!"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:s.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${s.textMuted} uppercase`,children:"Backup"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${s.textMuted} uppercase`,children:"Type"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${s.textMuted} uppercase`,children:"Status"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${s.textMuted} uppercase`,children:"Size"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium ${s.textMuted} uppercase`,children:"Created"}),e.jsx("th",{className:`px-6 py-3 text-right text-xs font-medium ${s.textMuted} uppercase`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${s.border}`,children:P.map(t=>e.jsxs("tr",{className:s.tableRow,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[le(t.type),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${s.textPrimary}`,children:t.name}),t.description&&e.jsx("p",{className:`text-sm ${s.textMuted}`,children:t.description})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 ${s.bgTertiary} ${s.textSecondary} rounded text-xs`,children:t.type})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`px-2 py-1 rounded text-xs flex items-center gap-1 w-fit ${ae(t.status)}`,children:[te(t.status),t.status]})}),e.jsx("td",{className:`px-6 py-4 ${s.textSecondary}`,children:R(t.fileSize)}),e.jsx("td",{className:`px-6 py-4 ${s.textMuted} text-sm`,children:G(new Date(t.createdAt),{addSuffix:!0})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.status==="COMPLETED"&&t.filePath&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ee(t),className:`p-2 ${s.textMuted} hover:text-violet-400 transition-colors`,title:"Restore",children:e.jsx(w,{size:16})}),e.jsx("a",{href:n.getDownloadUrl(t.id),className:`p-2 ${s.textMuted} hover:text-emerald-400 transition-colors`,title:"Download",children:e.jsx(ie,{size:16})})]}),e.jsx("button",{onClick:()=>J(t.id),className:`p-2 ${s.textMuted} hover:text-red-400 transition-colors`,title:"Delete",children:e.jsx(ce,{size:16})})]})})]},t.id))})]}),F>1&&e.jsx("div",{className:`px-6 py-4 border-t ${s.border} flex items-center justify-center gap-2`,children:Array.from({length:F},(t,a)=>e.jsx("button",{onClick:()=>V(a+1),className:`px-3 py-1 rounded ${N===a+1?"bg-violet-600 text-white":`${s.bgTertiary} ${s.textSecondary} hover:opacity-80`}`,children:a+1},a))})]}),q&&e.jsx("div",{className:s.overlay+" fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:`${s.modal} rounded-xl w-full max-w-lg p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:`text-xl font-bold ${s.textPrimary}`,children:"Create Custom Backup"}),e.jsx("button",{onClick:()=>b(!1),className:`${s.textMuted} hover:${s.textPrimary}`,children:e.jsx(O,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s.textSecondary} mb-1`,children:"Backup Name *"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>y({...r,name:t.target.value}),className:`w-full px-4 py-2 ${s.input} rounded-lg`,placeholder:"My Backup"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s.textSecondary} mb-1`,children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>y({...r,description:t.target.value}),className:`w-full px-4 py-2 ${s.input} rounded-lg`,rows:2,placeholder:"Optional description..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium ${s.textSecondary} mb-2`,children:"Include in Backup"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{key:"includesDatabase",label:"Database",icon:f},{key:"includesMedia",label:"Media Files",icon:S},{key:"includesThemes",label:"Themes",icon:M},{key:"includesPlugins",label:"Plugins",icon:C}].map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${r[t.key]?`bg-violet-500/20 border-violet-500/50 ${s.textPrimary}`:`${s.bgTertiary} ${s.border} ${s.textMuted}`}`,children:[e.jsx("input",{type:"checkbox",checked:r[t.key],onChange:a=>y({...r,[t.key]:a.target.checked}),className:"sr-only"}),e.jsx(t.icon,{size:18}),e.jsx("span",{children:t.label}),r[t.key]&&e.jsx(U,{className:"ml-auto text-violet-400"})]},t.key))})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>b(!1),className:s.buttonSecondary+" px-4 py-2 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:Z,disabled:!r.name.trim()||m,className:"px-4 py-2 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",children:[m?e.jsx(u,{className:"animate-spin",size:16}):e.jsx(I,{size:16}),"Create Backup"]})]})]})}),K&&i&&e.jsx("div",{className:s.overlay+" fixed inset-0 flex items-center justify-center z-50",children:e.jsxs("div",{className:`${s.modal} rounded-xl w-full max-w-lg p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:`text-xl font-bold ${s.textPrimary} flex items-center gap-2`,children:[e.jsx(w,{className:"text-violet-400"}),"Restore Backup"]}),e.jsx("button",{onClick:()=>{j(!1),g(null)},className:`${s.textMuted} hover:${s.textPrimary}`,children:e.jsx(O,{size:20})})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"text-amber-400 mt-0.5",size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 font-medium",children:"Warning"}),e.jsx("p",{className:`text-sm ${s.textMuted} mt-1`,children:"Restoring a backup will overwrite existing data. This action cannot be undone. Make sure you have a current backup before proceeding."})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:`${s.textSecondary} mb-2`,children:"Restoring from:"}),e.jsxs("div",{className:`${s.bgTertiary} rounded-lg p-3`,children:[e.jsx("p",{className:`${s.textPrimary} font-medium`,children:i.name}),e.jsxs("p",{className:`text-sm ${s.textMuted}`,children:["Created ",G(new Date(i.createdAt),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:`block text-sm font-medium ${s.textSecondary} mb-2`,children:"Select what to restore:"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{key:"restoreDatabase",label:"Database",icon:f,available:i.includesDatabase},{key:"restoreMedia",label:"Media Files",icon:S,available:i.includesMedia},{key:"restoreThemes",label:"Themes",icon:M,available:i.includesThemes},{key:"restorePlugins",label:"Plugins",icon:C,available:i.includesPlugins}].map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${t.available?c[t.key]?`bg-violet-500/20 border-violet-500/50 ${s.textPrimary}`:`${s.bgTertiary} ${s.border} ${s.textMuted}`:`${s.bgSecondary} ${s.border} ${s.textSubtle} cursor-not-allowed`}`,children:[e.jsx("input",{type:"checkbox",checked:t.available&&c[t.key],disabled:!t.available,onChange:a=>z({...c,[t.key]:a.target.checked}),className:"sr-only"}),e.jsx(t.icon,{size:18}),e.jsx("span",{children:t.label}),t.available&&c[t.key]&&e.jsx(U,{className:"ml-auto text-violet-400"}),!t.available&&e.jsx("span",{className:`ml-auto text-xs ${s.textSubtle}`,children:"N/A"})]},t.key))})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{j(!1),g(null)},className:s.buttonSecondary+" px-4 py-2 rounded-lg",children:"Cancel"}),e.jsxs("button",{onClick:se,disabled:B||!c.restoreDatabase&&!c.restoreMedia&&!c.restoreThemes&&!c.restorePlugins,className:"px-4 py-2 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-700 hover:to-purple-700 text-white rounded-lg flex items-center gap-2 transition-colors disabled:opacity-50",children:[B?e.jsx(u,{className:"animate-spin",size:16}):e.jsx(w,{size:16}),"Restore Backup"]})]})]})})]})}export{pe as default};
