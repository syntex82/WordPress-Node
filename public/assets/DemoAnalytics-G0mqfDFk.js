import{r as d,j as e}from"./vendor-react-D2QycniR.js";import{x as N,bZ as p,z as n,af as ce,ay as xe,b as me,bF as ue,o as pe,d as he,bM as je,m as be,B as ge,bb as fe,a5 as q,a6 as H,b_ as V,I as _,V as ve,v as ye,M as Ne,aA as $e,am as we,bG as Se,b$ as Fe}from"./index-4Xu9g3kZ.js";import{L as ke}from"./LoadingSpinner-BUnjBwPP.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";const B={active:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",expired:"bg-red-500/20 text-red-400 border-red-500/30",converted:"bg-purple-500/20 text-purple-400 border-purple-500/30",paused:"bg-amber-500/20 text-amber-400 border-amber-500/30",terminated:"bg-slate-500/20 text-slate-400 border-slate-500/30"},Ce=t=>t>=70?"text-emerald-400":t>=40?"text-amber-400":"text-red-400";function Ee(){const t=N(),[m,o]=d.useState(!0),[a,u]=d.useState(null),[r,i]=d.useState([]),[j,f]=d.useState(0),[b,k]=d.useState(1),[w,G]=d.useState(1),[z,I]=d.useState([]),[h,S]=d.useState(new Set),[U,R]=d.useState(null),[K,X]=d.useState([]),[Y,T]=d.useState(!1),[c,D]=d.useState({status:"all",segment:"all",search:"",sortBy:"createdAt",sortOrder:"desc",page:1,limit:20}),[L,Z]=d.useState(!1),g=d.useCallback(async()=>{var s,l;try{o(!0);const[x,v,de]=await Promise.all([p.getMetrics(),p.getUsers({...c,page:b}),p.getMarketingLists()]);u(x.data),i(v.data.users),f(v.data.total),G(v.data.totalPages),I(de.data)}catch(x){n.error(((l=(s=x.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to load demo analytics")}finally{o(!1)}},[c,b]);d.useEffect(()=>{g()},[g]);const J=s=>{D(l=>({...l,search:s.target.value})),k(1)},E=(s,l)=>{D(x=>({...x,[s]:l})),k(1)},C=s=>{D(l=>({...l,sortBy:s,sortOrder:l.sortBy===s&&l.sortOrder==="desc"?"asc":"desc"}))},Q=s=>{S(l=>{const x=new Set(l);return x.has(s)?x.delete(s):x.add(s),x})},W=()=>{h.size===r.length?S(new Set):S(new Set(r.map(s=>s.id)))},ee=async s=>{if(U===s){R(null);return}R(s),T(!0);try{const l=await p.getUserSessions(s);X(l.data)}catch{n.error("Failed to load sessions")}finally{T(!1)}},se=async(s,l=24)=>{try{await p.extendDemo(s,l),n.success(`Demo extended by ${l} hours`),g()}catch{n.error("Failed to extend demo")}},te=async s=>{try{const l=await p.resetAccess(s);n.success("Access token reset"),navigator.clipboard.writeText(l.data.newToken),n.success("New token copied to clipboard")}catch{n.error("Failed to reset access")}},ae=async s=>{try{await p.addToMailingList(s),n.success("Added to mailing list"),g()}catch{n.error("Failed to add to list")}},re=async s=>{try{await p.removeFromMailingList(s),n.success("Removed from mailing list"),g()}catch{n.error("Failed to remove from list")}},le=async()=>{if(h.size===0){n.error("No users selected");return}try{const s=await p.bulkAddToMailingList(Array.from(h));n.success(`Added ${s.data.added} users to mailing list`),S(new Set),g()}catch{n.error("Failed to add users to list")}},ne=async()=>{try{const s=await p.exportUsers({status:c.status,segment:c.segment}),l=new Blob([s.data],{type:"text/csv"}),x=window.URL.createObjectURL(l),v=document.createElement("a");v.href=x,v.download="demo-users.csv",v.click(),window.URL.revokeObjectURL(x),n.success("Export downloaded")}catch{n.error("Failed to export")}},ie=async s=>{if(window.confirm("Are you sure you want to delete this demo user? This action cannot be undone."))try{await p.deleteUser(s),n.success("Demo user deleted"),g()}catch{n.error("Failed to delete user")}},oe=async()=>{if(h.size===0){n.error("No users selected");return}if(window.confirm(`Are you sure you want to delete ${h.size} demo user(s)? This action cannot be undone.`))try{const s=await p.bulkDeleteUsers(Array.from(h));n.success(`Deleted ${s.data.deleted} users`),S(new Set),g()}catch{n.error("Failed to delete users")}},P=s=>{if(s<60)return`${s}m`;const l=Math.floor(s/60),x=s%60;return`${l}h ${x}m`},O=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return m&&!a?e.jsx(ke,{}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${t.titleGradient}`,children:"Demo Analytics"}),e.jsx("p",{className:`mt-1 ${t.textMuted}`,children:"Track demo performance and manage users"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:ne,className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${t.border} ${t.textSecondary} hover:bg-slate-700/50`,children:[e.jsx(ce,{size:18}),"Export CSV"]}),e.jsx("button",{onClick:g,className:`p-2 rounded-lg border transition-colors ${t.border} ${t.icon} ${t.iconHover}`,children:e.jsx(xe,{size:20})})]})]}),a&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx($,{icon:e.jsx(me,{}),label:"Total Demos",value:a.totalDemos,color:"blue"}),e.jsx($,{icon:e.jsx(ue,{}),label:"Active",value:a.activeDemos,color:"green"}),e.jsx($,{icon:e.jsx(pe,{}),label:"Expired",value:a.expiredDemos,color:"red"}),e.jsx($,{icon:e.jsx(he,{}),label:"Conversions",value:a.conversions,color:"purple"}),e.jsx($,{icon:e.jsx(je,{}),label:"Conv. Rate",value:`${a.conversionRate}%`,color:"emerald"}),e.jsx($,{icon:e.jsx(be,{}),label:"Inquiries",value:a.inquiries,color:"amber"})]}),a&&e.jsxs("div",{className:`backdrop-blur rounded-xl border p-6 mb-6 ${t.card}`,children:[e.jsx("h3",{className:`text-lg font-semibold mb-4 ${t.textPrimary}`,children:"Conversion Funnel"}),e.jsxs("div",{className:"flex items-center justify-between gap-2 overflow-x-auto",children:[e.jsx(F,{label:"Demos Started",value:a.totalDemos}),e.jsx(M,{}),e.jsx(F,{label:"Upgrade Views",value:a.pageViews}),e.jsx(M,{}),e.jsx(F,{label:"CTA Clicks",value:a.ctaClicks}),e.jsx(M,{}),e.jsx(F,{label:"Inquiries",value:a.inquiries}),e.jsx(M,{}),e.jsx(F,{label:"Converted",value:a.conversions,highlight:!0})]})]}),e.jsxs("div",{className:`backdrop-blur rounded-xl border p-4 mb-6 ${t.card}`,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:`absolute left-3 top-1/2 -translate-y-1/2 ${t.textMuted}`}),e.jsx("input",{type:"text",placeholder:"Search by email, name, or company...",value:c.search,onChange:J,className:`w-full pl-10 pr-4 py-2 rounded-lg border ${t.input}`})]})}),e.jsxs("button",{onClick:()=>Z(!L),className:`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${t.border} ${t.textSecondary}`,children:[e.jsx(fe,{size:18}),"Filters",L?e.jsx(q,{}):e.jsx(H,{})]}),h.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 transition-colors",children:[e.jsx(V,{size:18}),"Add ",h.size," to List"]}),e.jsxs("button",{onClick:oe,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors",children:[e.jsx(_,{size:18}),"Delete ",h.size]})]})]}),L&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4 pt-4 border-t border-slate-700/50",children:[e.jsxs("select",{value:c.status,onChange:s=>E("status",s.target.value),className:`px-3 py-2 rounded-lg border ${t.select}`,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]}),e.jsxs("select",{value:c.segment,onChange:s=>E("segment",s.target.value),className:`px-3 py-2 rounded-lg border ${t.select}`,children:[e.jsx("option",{value:"all",children:"All Segments"}),e.jsx("option",{value:"high_engagement",children:"High Engagement"}),e.jsx("option",{value:"low_engagement",children:"Low Engagement"}),e.jsx("option",{value:"upgrade_requested",children:"Upgrade Requested"})]})]})]}),e.jsxs("div",{className:`backdrop-blur rounded-xl border overflow-hidden ${t.card}`,children:[e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:t.tableHeader,children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:h.size===r.length&&r.length>0,onChange:W,className:"rounded border-slate-600"})}),e.jsx(A,{field:"createdAt",label:"User",current:c.sortBy,order:c.sortOrder,onSort:C}),e.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium uppercase ${t.textMuted}`,children:"Status"}),e.jsx(A,{field:"engagementScore",label:"Engagement",current:c.sortBy,order:c.sortOrder,onSort:C}),e.jsx(A,{field:"sessionCount",label:"Sessions",current:c.sortBy,order:c.sortOrder,onSort:C}),e.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium uppercase ${t.textMuted}`,children:"Time Spent"}),e.jsx(A,{field:"lastAccessedAt",label:"Last Active",current:c.sortBy,order:c.sortOrder,onSort:C}),e.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium uppercase ${t.textMuted}`,children:"Mailing"}),e.jsx("th",{className:`px-4 py-3 text-right text-xs font-medium uppercase ${t.textMuted}`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${t.border}`,children:r.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:`${t.tableRow} ${U===s.id?"bg-slate-800/50":""}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:h.has(s.id),onChange:()=>Q(s.id),className:"rounded border-slate-600"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${t.textPrimary}`,children:s.name||"Unknown"}),e.jsx("p",{className:`text-sm ${t.textMuted}`,children:s.email}),s.company&&e.jsx("p",{className:`text-xs ${t.textMuted}`,children:s.company})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${B[s.status]||B.expired}`,children:s.status})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.engagementScore>=70?"bg-emerald-500":s.engagementScore>=40?"bg-amber-500":"bg-red-500"}`,style:{width:`${s.engagementScore}%`}})}),e.jsx("span",{className:`text-sm font-medium ${Ce(s.engagementScore)}`,children:s.engagementScore})]})}),e.jsx("td",{className:`px-4 py-3 ${t.textSecondary}`,children:s.sessionCount}),e.jsx("td",{className:`px-4 py-3 ${t.textSecondary}`,children:P(s.totalTimeSpent)}),e.jsx("td",{className:`px-4 py-3 ${t.textMuted}`,children:O(s.lastAccessedAt)}),e.jsx("td",{className:"px-4 py-3",children:s.isOnMailingList?e.jsx("span",{className:"text-emerald-400",children:e.jsx(ve,{})}):e.jsx("span",{className:"text-slate-500",children:e.jsx(ye,{})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>ee(s.id),className:`p-1.5 rounded-lg transition-colors ${t.iconHover}`,title:"View details",children:e.jsx(Ne,{size:16})}),e.jsx(Me,{user:s,onExtend:()=>se(s.id),onResetAccess:()=>te(s.id),onAddToList:()=>ae(s.id),onRemoveFromList:()=>re(s.id),onDelete:()=>ie(s.id)})]})})]},s.id),U===s.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-4 py-4 bg-slate-800/30",children:e.jsx(Ae,{user:s,sessions:K,loading:Y,formatDuration:P,formatDate:O})})},`${s.id}-expanded`)]}))})]}),w>1&&e.jsxs("div",{className:`flex items-center justify-between px-4 py-3 border-t ${t.border}`,children:[e.jsxs("p",{className:t.textMuted,children:["Showing ",(b-1)*20+1," to ",Math.min(b*20,j)," of ",j," users"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k(s=>Math.max(1,s-1)),disabled:b===1,className:`px-3 py-1 rounded-lg border transition-colors ${t.border} ${b===1?"opacity-50 cursor-not-allowed":t.iconHover}`,children:"Previous"}),e.jsxs("span",{className:t.textSecondary,children:["Page ",b," of ",w]}),e.jsx("button",{onClick:()=>k(s=>Math.min(w,s+1)),disabled:b===w,className:`px-3 py-1 rounded-lg border transition-colors ${t.border} ${b===w?"opacity-50 cursor-not-allowed":t.iconHover}`,children:"Next"})]})]})]}),z.length>0&&e.jsxs("div",{className:`backdrop-blur rounded-xl border p-6 mt-6 ${t.card}`,children:[e.jsx("h3",{className:`text-lg font-semibold mb-4 ${t.textPrimary}`,children:"Marketing Lists"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:z.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${t.border} ${t.isDark?"bg-slate-800/50":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:`font-medium ${t.textPrimary}`,children:s.name}),e.jsxs("span",{className:`text-sm ${t.textMuted}`,children:[s.subscriberCount," subscribers"]})]}),s.description&&e.jsx("p",{className:`text-sm ${t.textMuted}`,children:s.description})]},s.id))})]})]})}function $({icon:t,label:m,value:o,color:a}){const u=N(),r={blue:"bg-blue-500/20 text-blue-400",green:"bg-emerald-500/20 text-emerald-400",red:"bg-red-500/20 text-red-400",purple:"bg-purple-500/20 text-purple-400",emerald:"bg-emerald-500/20 text-emerald-400",amber:"bg-amber-500/20 text-amber-400"};return e.jsx("div",{className:`backdrop-blur rounded-xl border p-4 ${u.card}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${r[a]}`,children:t}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs ${u.textMuted}`,children:m}),e.jsx("p",{className:`text-xl font-bold ${u.textPrimary}`,children:o})]})]})})}function F({label:t,value:m,highlight:o}){const a=N();return e.jsxs("div",{className:`text-center px-4 py-3 rounded-lg ${o?"bg-purple-500/20 border border-purple-500/30":""}`,children:[e.jsx("p",{className:`text-2xl font-bold ${o?"text-purple-400":a.textPrimary}`,children:m}),e.jsx("p",{className:`text-xs ${a.textMuted}`,children:t})]})}function M(){return e.jsx("span",{className:"text-slate-500 text-xl",children:"→"})}function A({field:t,label:m,current:o,order:a,onSort:u}){const r=N(),i=o===t;return e.jsx("th",{onClick:()=>u(t),className:`px-4 py-3 text-left text-xs font-medium uppercase cursor-pointer hover:text-blue-400 transition-colors ${i?"text-blue-400":r.textMuted}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[m,i&&(a==="asc"?e.jsx(q,{size:14}):e.jsx(H,{size:14}))]})})}function Me({user:t,onExtend:m,onResetAccess:o,onAddToList:a,onRemoveFromList:u,onDelete:r}){const[i,j]=d.useState(!1),f=N();return e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>j(!i),className:`p-1.5 rounded-lg transition-colors ${f.iconHover}`,children:e.jsx($e,{size:16})}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(!1)}),e.jsxs("div",{className:`absolute right-0 top-full mt-1 w-48 rounded-lg border shadow-xl z-20 ${f.card} ${f.border}`,children:[e.jsxs("button",{onClick:()=>{m(),j(!1)},className:`w-full flex items-center gap-2 px-4 py-2 text-left text-sm hover:bg-slate-700/50 transition-colors ${f.textSecondary}`,children:[e.jsx(we,{size:16}),"Extend 24 hours"]}),e.jsxs("button",{onClick:()=>{o(),j(!1)},className:`w-full flex items-center gap-2 px-4 py-2 text-left text-sm hover:bg-slate-700/50 transition-colors ${f.textSecondary}`,children:[e.jsx(Se,{size:16}),"Reset Access Token"]}),t.isOnMailingList?e.jsxs("button",{onClick:()=>{u(),j(!1)},className:"w-full flex items-center gap-2 px-4 py-2 text-left text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:[e.jsx(Fe,{size:16}),"Remove from List"]}):e.jsxs("button",{onClick:()=>{a(),j(!1)},className:"w-full flex items-center gap-2 px-4 py-2 text-left text-sm text-emerald-400 hover:bg-emerald-500/10 transition-colors",children:[e.jsx(V,{size:16}),"Add to Mailing List"]}),e.jsx("div",{className:`border-t ${f.border} my-1`}),e.jsxs("button",{onClick:()=>{r(),j(!1)},className:"w-full flex items-center gap-2 px-4 py-2 text-left text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:[e.jsx(_,{size:16}),"Delete Demo"]})]})]})]})}function Ae({user:t,sessions:m,loading:o,formatDuration:a,formatDate:u}){const r=N();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold mb-3 ${r.textPrimary}`,children:"User Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{label:"Email",value:t.email}),e.jsx(y,{label:"Name",value:t.name||"-"}),e.jsx(y,{label:"Company",value:t.company||"-"}),e.jsx(y,{label:"Phone",value:t.phone||"-"}),e.jsx(y,{label:"Created",value:u(t.createdAt)}),e.jsx(y,{label:"Expires",value:u(t.expiresAt)}),e.jsx(y,{label:"Upgrade Requested",value:t.upgradeRequested?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold mb-3 ${r.textPrimary}`,children:"Top Features Used"}),t.topFeatures.length===0?e.jsx("p",{className:r.textMuted,children:"No feature usage recorded"}):e.jsx("div",{className:"space-y-2",children:t.topFeatures.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:r.textSecondary,children:i.feature}),e.jsxs("span",{className:`text-sm ${r.textMuted}`,children:[i.count," uses"]})]},i.feature))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-semibold mb-3 ${r.textPrimary}`,children:"Recent Sessions"}),o?e.jsx("p",{className:r.textMuted,children:"Loading sessions..."}):m.length===0?e.jsx("p",{className:r.textMuted,children:"No sessions recorded"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:m.slice(0,5).map(i=>e.jsxs("div",{className:`p-2 rounded-lg ${r.isDark?"bg-slate-700/50":"bg-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm ${r.textSecondary}`,children:new Date(i.startedAt).toLocaleDateString()}),e.jsx("span",{className:`text-xs ${r.textMuted}`,children:i.duration?a(Math.round(i.duration/60)):"Active"})]}),e.jsxs("div",{className:`text-xs ${r.textMuted}`,children:[i.pagesViewed," pages • ",i.actionsCount," actions"]})]},i.id))})]})]})}function y({label:t,value:m}){const o=N();return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm ${o.textMuted}`,children:t}),e.jsx("span",{className:`text-sm ${o.textSecondary}`,children:m})]})}export{Ee as default};
