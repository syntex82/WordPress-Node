import{h as Z,r as c,j as e,L as H}from"./vendor-react-D2QycniR.js";import{c9 as x,z as d,cd as K,j as S,a6 as W,a8 as X,aK as E,G as y,I as C,aW as Y,v as P,ce as $,c as J,F as D,Y as _}from"./index-DAV1T9UC.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";function ie(){const{courseId:n}=Z(),[N,R]=c.useState(null),[g,k]=c.useState([]),[w,A]=c.useState([]),[T,z]=c.useState(!0),[q,j]=c.useState(!1),[i,h]=c.useState(null),[V,m]=c.useState(!1),[t,o]=c.useState(null),[f,v]=c.useState(!1);c.useEffect(()=>{p()},[n]);const p=async()=>{try{const[s,l,r]=await Promise.all([x.getCourse(n),x.getModules(n),x.getLessons(n)]);R(s.data);const a=l.data.map(b=>({...b,isExpanded:!0}));k(a);const u=new Set(a.flatMap(b=>{var I;return((I=b.lessons)==null?void 0:I.map(B=>B.id))||[]}));A(r.data.filter(b=>!b.moduleId&&!u.has(b.id)))}catch{d.error("Failed to load curriculum")}finally{z(!1)}},O=s=>k(l=>l.map(r=>r.id===s?{...r,isExpanded:!r.isExpanded}:r)),U=async()=>{var s,l,r;if(!((s=i==null?void 0:i.title)!=null&&s.trim())){d.error("Module title required");return}v(!0);try{i.id?await x.updateModule(n,i.id,i):await x.createModule(n,i),d.success(i.id?"Module updated!":"Module created!"),j(!1),h(null),p()}catch(a){d.error(((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to save module")}finally{v(!1)}},G=async s=>{if(confirm("Delete module? Lessons become unassigned."))try{await x.deleteModule(n,s),d.success("Deleted"),p()}catch{d.error("Failed")}},Q=async()=>{var s,l,r;if(!((s=t==null?void 0:t.title)!=null&&s.trim())){d.error("Lesson title required");return}v(!0);try{const a={...t,moduleId:t.targetModuleId||void 0};delete a.targetModuleId,t.id?await x.updateLesson(n,t.id,a):await x.createLesson(n,a),d.success(t.id?"Lesson updated!":"Lesson created!"),m(!1),o(null),p()}catch(a){d.error(((r=(l=a.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to save lesson")}finally{v(!1)}},M=async s=>{if(confirm("Delete lesson?"))try{await x.deleteLesson(n,s),d.success("Deleted"),p()}catch{d.error("Failed")}},L=async(s,l)=>{try{await x.moveLessonToModule(n,s,l),d.success("Moved!"),p()}catch{d.error("Failed")}},F=s=>({VIDEO:e.jsx(_,{className:"text-purple-400"}),ARTICLE:e.jsx(D,{className:"text-blue-400"}),QUIZ:e.jsx(J,{className:"text-amber-400"}),ASSIGNMENT:e.jsx($,{className:"text-green-400"})})[s]||e.jsx(D,{});return T?e.jsx("div",{className:"p-4 md:p-6 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-4 border-slate-700 border-t-blue-500"})}):e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(H,{to:"/lms/courses",className:"text-blue-400 hover:text-blue-300 text-sm",children:"â† Back to Courses"}),e.jsxs("h1",{className:"text-xl md:text-2xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent line-clamp-2",children:["Curriculum: ",N==null?void 0:N.title]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>{h({title:"",description:"",isPublished:!0}),j(!0)},className:"flex items-center justify-center gap-2 bg-gradient-to-r from-emerald-600 to-emerald-500 text-white px-4 py-2.5 rounded-xl text-sm",children:[e.jsx(K,{})," ",e.jsx("span",{className:"hidden sm:inline",children:"Add"})," Module"]}),e.jsxs("button",{onClick:()=>{o({title:"",type:"VIDEO",isPreview:!1,isRequired:!0}),m(!0)},className:"flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white px-4 py-2.5 rounded-xl text-sm",children:[e.jsx(S,{})," ",e.jsx("span",{className:"hidden sm:inline",children:"Add"})," Lesson"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[g.map(s=>{var l,r;return e.jsxs("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700/50 overflow-hidden",children:[e.jsxs("div",{className:"p-3 md:p-4 flex flex-col sm:flex-row sm:items-center justify-between gap-3 bg-slate-800/80 border-b border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 flex-1 cursor-pointer min-w-0",onClick:()=>O(s.id),children:[s.isExpanded?e.jsx(W,{className:"flex-shrink-0"}):e.jsx(X,{className:"flex-shrink-0"}),e.jsx(E,{className:"text-emerald-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white truncate",children:s.title}),e.jsxs("p",{className:"text-xs text-slate-400",children:[((l=s.lessons)==null?void 0:l.length)||0," lessons"]})]})]}),e.jsxs("div",{className:"flex gap-1 items-center ml-auto sm:ml-0",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded whitespace-nowrap ${s.isPublished?"bg-green-500/20 text-green-400":"bg-slate-600/50 text-slate-400"}`,children:s.isPublished?"Published":"Draft"}),e.jsx("button",{onClick:()=>{h(s),j(!0)},className:"p-2 hover:text-blue-400",children:e.jsx(y,{})}),e.jsx("button",{onClick:()=>G(s.id),className:"p-2 hover:text-red-400",children:e.jsx(C,{})})]})]}),s.isExpanded&&e.jsxs("div",{className:"divide-y divide-slate-700/30",children:[(r=s.lessons)!=null&&r.length?s.lessons.map(a=>e.jsxs("div",{className:"p-3 pl-6 md:pl-12 flex flex-col sm:flex-row justify-between gap-2 hover:bg-slate-700/20 group",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0",children:[e.jsx(Y,{className:"text-slate-600 opacity-0 group-hover:opacity-100 hidden sm:block flex-shrink-0"}),F(a.type),e.jsx("span",{className:"text-white truncate",children:a.title}),a.isPreview&&e.jsx("span",{className:"text-xs bg-green-500/20 text-green-400 px-1 rounded whitespace-nowrap",children:"Preview"})]}),e.jsxs("div",{className:"flex gap-1 sm:opacity-0 group-hover:opacity-100 ml-auto sm:ml-0",children:[e.jsxs("select",{onChange:u=>L(a.id,u.target.value||null),className:"text-xs bg-slate-700 border border-slate-600 rounded px-2 py-1 max-w-[100px] sm:max-w-none",children:[e.jsx("option",{value:"",children:"Move..."}),e.jsx("option",{value:"",children:"Unassigned"}),g.filter(u=>u.id!==s.id).map(u=>e.jsx("option",{value:u.id,children:u.title},u.id))]}),e.jsx("button",{onClick:()=>{o({...a,targetModuleId:a.moduleId}),m(!0)},className:"p-1 hover:text-blue-400",children:e.jsx(y,{size:14})}),e.jsx("button",{onClick:()=>M(a.id),className:"p-1 hover:text-red-400",children:e.jsx(C,{size:14})})]})]},a.id)):e.jsx("div",{className:"p-4 text-center text-slate-500 text-sm",children:"No lessons"}),e.jsxs("button",{onClick:()=>{o({title:"",type:"VIDEO",isPreview:!1,isRequired:!0,targetModuleId:s.id}),m(!0)},className:"w-full p-3 pl-6 md:pl-12 text-slate-500 hover:text-blue-400 flex items-center gap-2 text-sm",children:[e.jsx(S,{})," Add lesson"]})]})]},s.id)}),w.length>0&&e.jsxs("div",{className:"bg-slate-800/30 rounded-xl border border-dashed border-slate-600/50 overflow-hidden",children:[e.jsxs("div",{className:"p-3 md:p-4 flex items-center gap-3 bg-slate-800/50 border-b border-slate-700/30",children:[e.jsx(E,{className:"text-slate-500"}),e.jsx("h3",{className:"font-medium text-slate-400",children:"Unassigned Lessons"}),e.jsx("span",{className:"text-xs text-slate-500",children:w.length})]}),e.jsx("div",{className:"divide-y divide-slate-700/20",children:w.map(s=>e.jsxs("div",{className:"p-3 pl-6 md:pl-12 flex flex-col sm:flex-row justify-between gap-2 hover:bg-slate-700/20 group",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0",children:[F(s.type),e.jsx("span",{className:"text-slate-300 truncate",children:s.title})]}),e.jsxs("div",{className:"flex gap-1 sm:opacity-0 group-hover:opacity-100 ml-auto sm:ml-0",children:[e.jsxs("select",{onChange:l=>l.target.value&&L(s.id,l.target.value),className:"text-xs bg-slate-700 border border-slate-600 rounded px-2 py-1 max-w-[100px] sm:max-w-none",children:[e.jsx("option",{value:"",children:"Move to..."}),g.map(l=>e.jsx("option",{value:l.id,children:l.title},l.id))]}),e.jsx("button",{onClick:()=>{o({...s}),m(!0)},className:"p-1 hover:text-blue-400",children:e.jsx(y,{size:14})}),e.jsx("button",{onClick:()=>M(s.id),className:"p-1 hover:text-red-400",children:e.jsx(C,{size:14})})]})]},s.id))})]})]}),q&&i&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl w-full max-w-md border border-slate-700 shadow-2xl",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:i.id?"Edit Module":"New Module"}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-slate-700 rounded-lg",children:e.jsx(P,{})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Title"}),e.jsx("input",{value:i.title||"",onChange:s=>h({...i,title:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Description"}),e.jsx("textarea",{value:i.description||"",onChange:s=>h({...i,description:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white h-20"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:i.isPublished??!0,onChange:s=>h({...i,isPublished:s.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-slate-300",children:"Published"})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-700 flex flex-col-reverse sm:flex-row justify-end gap-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"w-full sm:w-auto px-4 py-2.5 text-slate-400 hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:U,disabled:f,className:"w-full sm:w-auto px-4 py-2.5 bg-emerald-600 text-white rounded-lg disabled:opacity-50",children:f?"Saving...":"Save Module"})]})]})}),V&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl w-full max-w-lg border border-slate-700 shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:t.id?"Edit Lesson":"New Lesson"}),e.jsx("button",{onClick:()=>m(!1),className:"p-2 hover:bg-slate-700 rounded-lg",children:e.jsx(P,{})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Title"}),e.jsx("input",{value:t.title||"",onChange:s=>o({...t,title:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Type"}),e.jsxs("select",{value:t.type||"VIDEO",onChange:s=>o({...t,type:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"VIDEO",children:"Video"}),e.jsx("option",{value:"ARTICLE",children:"Article"}),e.jsx("option",{value:"QUIZ",children:"Quiz"}),e.jsx("option",{value:"ASSIGNMENT",children:"Assignment"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Module"}),e.jsxs("select",{value:t.targetModuleId||"",onChange:s=>o({...t,targetModuleId:s.target.value||void 0}),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"No module (unassigned)"}),g.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-400 mb-1",children:"Content"}),e.jsx("textarea",{value:t.content||"",onChange:s=>o({...t,content:s.target.value}),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white h-24"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.isPreview??!1,onChange:s=>o({...t,isPreview:s.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-slate-300",children:"Free Preview"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:t.isRequired??!0,onChange:s=>o({...t,isRequired:s.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-slate-300",children:"Required"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-700 flex flex-col-reverse sm:flex-row justify-end gap-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"w-full sm:w-auto px-4 py-2.5 text-slate-400 hover:text-white",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:f,className:"w-full sm:w-auto px-4 py-2.5 bg-blue-600 text-white rounded-lg disabled:opacity-50",children:f?"Saving...":"Save Lesson"})]})]})})]})}export{ie as default};
