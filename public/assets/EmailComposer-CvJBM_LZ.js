import{r as i,j as e}from"./vendor-react-D2QycniR.js";import{cr as c,r as F,z as l,V as R,U as P,m as A,M as D,b as M,at as g,v as z}from"./index-Bwazbld5.js";import{L as H}from"./LoadingSpinner-BUnjBwPP.js";import{a as L}from"./sanitize-B6KaGUlq.js";import"./vendor-editor-Cn7QR8gj.js";import"./vendor-utils-BWf5C302.js";import"./vendor-socket-CA1CrNgP.js";function J(){const[x,j]=i.useState([]),[m,v]=i.useState([]),[w,y]=i.useState(!0),[p,d]=i.useState(!1),[N,h]=i.useState(!1),[S,T]=i.useState(""),[n,b]=i.useState(null),[s,o]=i.useState({templateId:"",recipientType:"specific",role:"VIEWER",selectedUsers:[],subject:"",testEmail:""});i.useEffect(()=>{E(),I()},[]);const E=async()=>{try{const[t,r]=await Promise.all([c.getTemplates({limit:100}),F.getAll()]);j(t.data.data||[]),v(r.data.users||[])}catch{l.error("Failed to load data")}finally{y(!1)}},I=async()=>{try{const t=await c.verifyConnection();b(t.data.connected)}catch{b(!1)}},C=async()=>{if(!s.templateId){l.error("Please select a template");return}try{const t=await c.previewTemplate(s.templateId,{user:{name:"John Doe",firstName:"John",email:"john@example.com"},site:{name:"My Website",url:window.location.origin},year:new Date().getFullYear()});T(t.data.html),h(!0)}catch{l.error("Failed to preview template")}},k=async()=>{var t,r;if(!s.templateId||!s.testEmail){l.error("Please select a template and enter a test email");return}d(!0);try{await c.sendTestEmail({templateId:s.templateId,to:s.testEmail,variables:{site:{name:"My Website",url:window.location.origin},year:new Date().getFullYear()}}),l.success("Test email sent!")}catch(a){l.error(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to send test email")}finally{d(!1)}},U=async()=>{var t,r;if(!s.templateId){l.error("Please select a template");return}if(s.recipientType==="specific"&&s.selectedUsers.length===0){l.error("Please select at least one recipient");return}d(!0);try{const a=await c.sendBulkEmail({templateId:s.templateId,subject:s.subject||void 0,recipientType:s.recipientType,role:s.recipientType==="role"?s.role:void 0,userIds:s.recipientType==="specific"?s.selectedUsers:void 0,variables:{site:{name:"My Website",url:window.location.origin},year:new Date().getFullYear()}});l.success(`Sent ${a.data.successful}/${a.data.totalRecipients} emails`),a.data.failed>0&&l.error(`${a.data.failed} emails failed`)}catch(a){l.error(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to send emails")}finally{d(!1)}},u=()=>s.recipientType==="all"?m.length:s.recipientType==="role"?m.filter(t=>t.role===s.role).length:s.selectedUsers.length,f=x.find(t=>t.id===s.templateId);return w?e.jsx(H,{}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent",children:"Email Composer"}),e.jsx("p",{className:"text-slate-400",children:"Send emails to your users"})]}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm ${n===!0?"bg-green-500/20 text-green-400":n===!1?"bg-red-500/20 text-red-400":"bg-slate-700/50 text-slate-400"}`,children:[n===!0?e.jsx(R,{}):n===!1?e.jsx(P,{}):null,n===!0?"SMTP Connected":n===!1?"SMTP Not Connected":"Checking..."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(A,{className:"text-blue-400"})," Select Template"]}),e.jsxs("select",{value:s.templateId,onChange:t=>o({...s,templateId:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[e.jsx("option",{value:"",children:"Choose a template..."}),x.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.type.replace("_"," "),")"]},t.id))]}),f&&e.jsxs("div",{className:"mt-3 p-3 bg-slate-700/30 rounded-xl border border-slate-600/50",children:[e.jsxs("p",{className:"text-sm text-slate-300",children:[e.jsx("strong",{className:"text-white",children:"Subject:"})," ",f.subject]}),e.jsxs("button",{onClick:C,className:"mt-2 text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1 transition-colors",children:[e.jsx(D,{})," Preview Template"]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(M,{className:"text-purple-400"})," Recipients"]}),e.jsx("div",{className:"flex gap-4 mb-4",children:["all","role","specific"].map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-slate-300 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"recipientType",checked:s.recipientType===t,onChange:()=>o({...s,recipientType:t,selectedUsers:[]}),className:"text-blue-500 focus:ring-blue-500/50"}),e.jsx("span",{className:"capitalize",children:t==="all"?"All Users":t==="role"?"By Role":"Select Users"})]},t))}),s.recipientType==="role"&&e.jsxs("select",{value:s.role,onChange:t=>o({...s,role:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 mb-4",children:[e.jsx("option",{value:"SUPER_ADMIN",children:"Super Admin"}),e.jsx("option",{value:"ADMIN",children:"Admin"}),e.jsx("option",{value:"EDITOR",children:"Editor"}),e.jsx("option",{value:"AUTHOR",children:"Author"}),e.jsx("option",{value:"INSTRUCTOR",children:"Instructor"}),e.jsx("option",{value:"STUDENT",children:"Student"}),e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"VIEWER",children:"Viewer"})]}),s.recipientType==="specific"&&e.jsx("div",{className:"max-h-48 overflow-y-auto border border-slate-600/50 rounded-xl p-2 bg-slate-700/30",children:m.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-slate-600/30 rounded-lg cursor-pointer text-slate-300",children:[e.jsx("input",{type:"checkbox",checked:s.selectedUsers.includes(t.id),onChange:r=>{o({...s,selectedUsers:r.target.checked?[...s.selectedUsers,t.id]:s.selectedUsers.filter(a=>a!==t.id)})},className:"rounded border-slate-600 bg-slate-700 text-blue-500 focus:ring-blue-500/50"}),e.jsx("span",{className:"text-white",children:t.name}),e.jsxs("span",{className:"text-slate-500 text-sm",children:["(",t.email,")"]})]},t.id))}),e.jsxs("p",{className:"mt-3 text-sm text-slate-400",children:[e.jsx("strong",{className:"text-white",children:u()})," recipient(s) selected"]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-slate-300",children:"Subject Override (optional)"}),e.jsx("input",{type:"text",value:s.subject,onChange:t=>o({...s,subject:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Leave empty to use template subject"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4",children:[e.jsx("h3",{className:"font-semibold mb-4 text-white",children:"Send Test Email"}),e.jsx("input",{type:"email",value:s.testEmail,onChange:t=>o({...s,testEmail:t.target.value}),className:"w-full bg-slate-700/50 border border-slate-600/50 rounded-xl px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 mb-3",placeholder:"test@example.com"}),e.jsxs("button",{onClick:k,disabled:p||!s.templateId,className:"w-full flex items-center justify-center gap-2 px-4 py-2 border border-slate-600/50 rounded-xl text-slate-300 hover:bg-slate-700/50 disabled:opacity-50 transition-colors",children:[e.jsx(g,{})," Send Test"]})]}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur rounded-xl border border-slate-700/50 p-4",children:[e.jsx("h3",{className:"font-semibold mb-4 text-white",children:"Send to Recipients"}),e.jsxs("p",{className:"text-sm text-slate-400 mb-4",children:["This will send emails to ",e.jsx("strong",{className:"text-white",children:u()})," user(s)."]}),e.jsx("button",{onClick:U,disabled:p||!s.templateId||u()===0,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white px-4 py-2 rounded-xl hover:from-blue-700 hover:to-blue-600 shadow-lg shadow-blue-500/20 disabled:opacity-50 transition-all",children:p?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx(g,{})," Send Emails"]})})]})]})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-2xl border border-slate-700/50 w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-700/50",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Email Preview"}),e.jsx("button",{onClick:()=>h(!1),className:"p-2 hover:bg-slate-700/50 rounded-xl text-slate-400 hover:text-white transition-colors",children:e.jsx(z,{})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 bg-slate-900/50",children:e.jsx("div",{className:"bg-white rounded-xl shadow max-w-xl mx-auto",dangerouslySetInnerHTML:{__html:L(S)}})})]})})]})}export{J as default};
